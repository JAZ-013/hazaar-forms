function _hz_icon(e,t,n){if(n||(n=hzIcons),!(e in n))return null;let a=n[e],i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("class","forms-icon"),i.setAttribute("viewBox","0 0 "+a[0]+" "+a[1]);let l=document.createElementNS("http://www.w3.org/2000/svg","path");return l.setAttribute("fill","currentColor"),l.setAttribute("d",a[2]),i.appendChild(l),t&&i.setAttribute("title",t),$(i)}var ud=void 0;"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){"use strict";if(null===e)throw new TypeError("Cannot convert undefined or null to object");let n=Object(e);for(let e=1;e<arguments.length;e++){let t=arguments[e];if(null!==t)for(let e in t)Object.prototype.hasOwnProperty.call(t,e)&&(n[e]=t[e])}return n},writable:!0,configurable:!0});var hzIcons={"exclamation-circle":[512,512,"M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zm-248 50c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"],"question-circle":[512,512,"M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zM262.655 90c-54.497 0-89.255 22.957-116.549 63.758-3.536 5.286-2.353 12.415 2.715 16.258l34.699 26.31c5.205 3.947 12.621 3.008 16.665-2.122 17.864-22.658 30.113-35.797 57.303-35.797 20.429 0 45.698 13.148 45.698 32.958 0 14.976-12.363 22.667-32.534 33.976C247.128 238.528 216 254.941 216 296v4c0 6.627 5.373 12 12 12h56c6.627 0 12-5.373 12-12v-1.333c0-28.462 83.186-29.647 83.186-106.667 0-58.002-60.165-102-116.531-102zM256 338c-25.365 0-46 20.635-46 46 0 25.364 20.635 46 46 46s46-20.636 46-46c0-25.365-20.635-46-46-46z"],times:[352,512,"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"],minus:[448,512,"M416 208H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h384c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"],plus:[448,512,"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"],calendar:[448,512,"M12 192h424c6.6 0 12 5.4 12 12v260c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V204c0-6.6 5.4-12 12-12zm436-44v-36c0-26.5-21.5-48-48-48h-48V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H160V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H48C21.5 64 0 85.5 0 112v36c0 6.6 5.4 12 12 12h424c6.6 0 12-5.4 12-12z"],search:[512,512,"M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"]};Array.fromObject=function(e){if("object"!=typeof e)return null;let t=[];for(let n in e)t.push(e[n]);return t},String.prototype.hash=function(){let e,t,n=0;if(0===this.length)return n;for(e=0;e<this.length;e++)t=this.charCodeAt(e),n=(n<<5)-n+t,n|=0;return n},Date.getLocalDateFormat=function(){let e=[],t=[],n="/",a=null,i=new Date(2001,4,9).toLocaleDateString();if(!1!==(a=i.match(/\W/))&&(n=a[0]),t=i.split(n),2001===parseInt(t[0]))e=["yyyy","mm","dd"],n="-";else for(let n in t){let a=!1,i=parseInt(t[n]);"0"===t[n][0]&&(a=!0),9===i?e.push(a?"dd":"d"):5===i?e.push(a?"mm":"m"):1===i?e.push("yy"):2001===i&&e.push("yyyy")}return e.join(n)},dataBinder.prototype._commit=dataBinderArray.prototype._commit=function(e){this._default={};for(let t in e){let n=e[t];n instanceof dataBinder||n instanceof dataBinderArray?n=e[t].commit():n instanceof dataBinderValue&&(n=n.save()),this._default[t]=n}return this._default},dataBinder.prototype.commit=function(){return this._commit(this._attributes)},dataBinderArray.prototype.commit=function(){return this._commit(this._elements)},dataBinder.prototype.reset=function(){if(!this._default)return!1;for(let e in this._attributes)e in this._default||this.remove(e);for(let e in this._default)this._attributes[e]instanceof dataBinder||this._attributes[e]instanceof dataBinderArray?this._attributes[e].reset():this[e]=this._default[e];return!0},dataBinderArray.prototype.reset=function(){if(!this._default)return!1;this._elements=[];for(let e in this._default)this._elements[e]=this.__convert_type(e,this._default[e]);return this.resync(),!0},dataBinder.prototype.diff=function(e,t){if(null!==e&&"object"==typeof e){e instanceof dataBinder||(e=new dataBinder(e,null,null,"form-differential-analysis"));for(let n in this._attributes){let a=n in e?e[n].value:null;this._attributes[n]instanceof dataBinder||this._attributes[n]instanceof dataBinderArray?this._attributes[n].diff(a,t):this._attributes[n]instanceof dataBinderValue&&this._attributes[n].value!==a&&t(this._attributes[n],a)}}},dataBinderArray.prototype.diff=function(e,t){if(e&&"object"==typeof e)for(let n in this._elements)n in e||(e[n]=null),this._elements[n]instanceof dataBinder&&this._elements[n].diff(e[n],t)},function(e){function t(t){"string"==typeof t?t={str:t}:t instanceof Error?t={status:"JavaScript Error",str:t.message,line:t.lineNumber,file:t.fileName}:"done"in t&&("responseJSON"in t||(t.responseJSON=JSON.parse(t.responseText)),t=t.responseJSON.error),e("<div>").css("text-align","left").html([e("<h4>").html(t.status),e("<div>").html(t.str).css({"font-weight":"bold","margin-bottom":"15px"}),t.line?e("<div>").html("Line: "+t.line):null,t.file?e("<div>").html("File: "+t.file):null]).popup({title:"An error ocurred!",icon:"danger",buttons:[{label:"OK",class:"btn btn-default"}]})}function n(){return"yxxx-yxxx-yxxx".replace(/[xy]/g,function(e){let t=16*Math.random()|0,n="x"===e?t:3&t|8;return n.toString(16)})}function a(e,t){return t.split(".").reduce(function(e,t){return e[t]},e)}function i(e){return"object"!=typeof e&&(e=e.toString().trim().toLowerCase(),"t"===e||"true"===e||"on"===e||"yes"===e||"y"===e||"ok"===e?"true":RegExp("/^(!|not)s*null$/").test(e)?"true":1===parseInt(e)?"true":"false")}function l(e){return"true"===i(e)}function r(t,n){let a=t.get(0),i=document.createElement("INPUT");i.style.position="absolute",i.style.left=-999,document.body.appendChild(i),i.setAttribute("value",a.value),i.select(),document.execCommand("copy"),i.parentNode.removeChild(i);let l=e(n).tooltip({title:"Copied!",trigger:"manual"}).tooltip("show");setTimeout(function(){l.tooltip("dispose")},3e3)}function s(e,t,n){return _hz_icon(t,n,e.settings.icons)}function o(e,t){if(!("type"in e))return t;let n=e.type.toLowerCase();return"array"===n&&"arrayOf"in e&&(n=e.arrayOf.toLowerCase()),"string"==typeof t&&""===t?null:("int"===n||"integer"===n?t=parseInt(t):"text"===n||"string"===n?t=t.toString().trim():"bool"===n||"boolean"===n?t=l(t):"float"!==n&&"number"!==n&&"double"!==n&&"money"!==n||(t=parseFloat(t.replace(/\,/g,""))),t)}function d(e,t){return t=m(e,t,null,!0),t.match(/^https?:\/\//)?t:hazaar.url(t)}function u(e,t,n,a){if(!Array.isArray(e))return console.warn("Attempting to sort object.  Sorting is only supported by arrays."),e;if("string"==typeof t)e.sort(function(e,n){return e[t]<n[t]?-1:e[t]>n[t]?1:0});else if(Array.isArray(t)){let i=[];for(let a in t){let l=e.findIndex(function(e,i,l){return e[n]===t[a]});-1!==l&&(i.push(e[l]),e.splice(l,1))}if(e.length>0&&a){let e={};e[a]="__spacer__",e[n]=Array(10).join("&#x2500;"),i.push(e)}e=i.concat(u(e,n))}return e}function f(e,t,n,a){let i=[];for(let l in e)if(e[l]&&"object"==typeof e[l])i.push(e[l]);else{let r={};r[t]=o(a,l),r[n]=e[l],i.push(r)}return i}function c(e,t,n,a,i){let l="";if("string"==typeof e.eval_cache)l=e.eval_cache;else{let t=e.data.save(!0),n=Object.keys(t).sort();for(let e in n){let a=n[e];if("form"===a)continue;let i=t[a];"string"==typeof i?i='"'+i.replace(/"/g,'\\"').replace("\n","\\n")+'"':("object"==typeof i||Array.isArray(i))&&(i=JSON.stringify(i)),l+="let "+a+" = "+i+";\n"}!0===e.eval_cache&&(e.eval_cache=l)}n&&(l+="let value = "+JSON.stringify(n.save(!0))+";\n",l+="let item = "+JSON.stringify(n.parent.save(!0))+";\n"),l+=!0===i?"return ( "+t.replace(/[\;\s]+$/,"")+" );":t;try{let i=e.parent?e.parent:e;return new Function("form","tags","formValue","formItem","key",l).call(this,i.data,i.tags,n||null,n?n.parent:null,a)}catch(e){console.error("Failed to evaluate condition: "+t),console.error(e)}return!1}function p(e,t,n,a,i){return"boolean"==typeof t?t:void 0===t?void 0!==n&&n:c(e,t,a,i,!0)}function h(e,t){if("object"==typeof t&&!t.protected&&!t.keep)if("string"==typeof t.name){let n=g(e.data,t.name);n instanceof dataBinderValue?n.set(t.default||null,t.placeholder||null):n instanceof dataBinder&&n.empty()}else if("fields"in t)for(let n in t.fields){let a=t.fields[n];if(a instanceof Array)h(e,{fields:a});else if("string"==typeof a){let n=g(e.data,a);n instanceof dataBinderValue&&n.set(t.default||null,t.placeholder||null)}}}function m(e,t,n,a,i){if("string"!=typeof t)return t;let l=e&&e.parent?e.parent:e;for(;null!==(match=t.match(/\{\{([\W]*)([\w\.]+)\}\}/));){let e=match[1].split(""),d=l?g(l.data,match[2]):null;if(null===d&&(d="this."===match[2].substr(0,5)?g(l.settings,match[2].substr(5)):n?g(n,match[2]):null),-1===e.indexOf("!")&&null===(d instanceof dataBinderValue?d.value:d)&&!0!==a)return!1;-1!==e.indexOf(">")&&(i=!1);let u=function(e){return Array.isArray(e)?(e.filter(u),e.length>0):null!==e},f=(r=d,s=e,o=i,r instanceof dataBinder?JSON.stringify(r.save(!0)):r instanceof dataBinderArray?JSON.stringify(r.save(!0).filter(u)):r instanceof dataBinderValue?!0===o&&-1===s.indexOf(":")?r:r.value:r),c=i?'<span data-bind="'+match[2]+'" data-bind-label="'+(-1===e.indexOf(":")?"true":"false")+'">'+f+"</span>":f||"";t=t.replace(match[0],c)}var r,s,o;return t}function g(e,t,n,a){if(t instanceof dataBinder||t instanceof dataBinderArray||t instanceof dataBinderValue)return t;if("string"!=typeof t||"object"!=typeof e||!e)return null;let i=t.split(/[\.\[]/),l=e;for(let e in i){let t=i[e];if("]"===i[e].slice(-1)&&(t=parseInt(t.slice(0,-1))),!(t in l)){if(void 0===a)return null;l[t]=parseInt(e)+1<i.length?{}:a}!0===n&&l[t]instanceof dataBinderValue&&(l[t]=[]),l=l[t]}return l}function b(e,t,n){if("required"in t)return"boolean"!=typeof t.required&&e.events.required.push(n),y(e,n,!1)}function y(t,n,a){let i=n.data("def");if(!i)return!1;let l=n.children("label.control-label"),r=l.children("svg.form-required"),o=g(t.data,n.data("item")),d=t.required[o.attrName]=p(t,i.required,void 0!==a&&a,o,i.name);return!0!==d?r.remove():0===r.length&&l.append(s(t,"exclamation-circle","Required").addClass("form-required")),"fields"in i&&n.children("div.form-section,div.form-group").each(function(n,a){let i=e(a);i.data("item")&&y(t,i,d)}),d}function v(e,t,n,a){if("disabled"in t&&!0!==t.protected)return"function"==typeof a&&n.data("disabled_func",a),"string"==typeof t.disabled&&e.events.disabled.push(n),w(e,n,a)}function w(t,n,a){let i=n.data("def");if(!i)return!1;let l=g(t.data,n.data("item")),r=t.disabled[l.attrName]=p(t,i.disabled,void 0!==a&&a,l,i.name);return n.find("input,textarea,select,button").prop("disabled",r).data("ed",r),"fields"in i&&n.children("div.form-section,div.form-group").each(function(n,a){let i=e(a);i.data("item")&&w(t,i,r)}),r}function k(e,t,n){n.data("show",t.show),"boolean"!=typeof t.show&&e.events.show.push(n),C(e,n)}function C(e,t){let n=t.data("def");if(!n)return!1;e.working=!0;let a=g(e.data,t.data("item")),i=p(e,t.data("show"),!0,a,n?n.name:null);t.toggle(i),i||h(e,n),e.working=!1}function _(t,n){let a=n.data("def"),i=n.attr("data-bind"),l=g(t.data,i);if(!l)return!1;if(n.is("[type=checkbox]")){let e=n.is(":checked");l.set(e,e?"Yes":"No")}else if(n.is("select")){let i=n.val();if("__hz_other"===i){l&&null!==l.value&&l.set(null,null,l.other);let i=e("<div>").addClass(t.settings.styleClasses.inputGroup),r=e('<input type="text" placeholder="Enter other option...">').addClass(t.settings.styleClasses.input).data("def",a).val(l.other).attr("data-bind",n.attr("data-bind")).attr("data-bind-other",!0).change(function(n){return _(t,e(n.target))}).on("update",function(e,t,a){n.show(),i.remove()}).appendTo(i),o=e('<button class="btn btn-secondary" type="button">').html(s(t,"times")).click(function(e){i.remove(),l.other=null,n.val("").show()});"format"in a&&r.inputmask(a.format),e('<span class="input-group-btn">').addClass(t.settings.styleClasses.inputGroupAppend).html(o).appendTo(i),n.hide().after(i),r.focus()}else l.set(o(a,i))}else if("date"===a.type&&"format"in a){let e=n.datepicker("getDate");l.set(e?e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate():null,n.datepicker("getFormattedDate"))}else if(!0===a.other)l.other=n.val(),x(t,n,!1,l);else{let e=o(a,n.val());l instanceof dataBinder?l.populate(e):l.set(e)}return!1!==l.enabled()&&(e(t).trigger("change",[l]),!1)}function x(e,n,a,i){let l=K(e.def,"string"==typeof n?n:n.attr("data-bind"));if(!l)return;let r=l.update,s=null;if(i||(i=g(e.data,l.name)),e.eval_cache=!0,"string"==typeof r&&(r={url:r}),"object"==typeof n){if(i&&n.is("select")&&"__hz_other"!==n.val()){let e=n.children('option[value="'+i.value+'"]').data("other")||null;i.enabled(!1),i.set(i.value,n.children("option:selected").text(),e,!1),i.enabled(!0)}else i&&n.is('input[type="radio"]')&&!0===i.enabled()&&i.set(i.value,n.next().text());if("boolean"==typeof r||r&&("url"in r||!0===e.settings.update)){let a={originator:l.name,form:e.data.save()},o=function(e,t){let n=null;if("boolean"==typeof t)return t;if("object"!=typeof t)return!1;if("enabled"in t||(t.enabled=!0),"when"in t&&(t.enabled=p(e,t.when,!1,i,l.name)),t.enabled){if(!("url"in t))return!0;if(!1!==(n=m(e,t.url)))return a.api=n,!0}return!1};o(e,r)&&(s=function(){be(e,"update",a,!1).done(function(t){t.ok&&(e.data.extend(t.updates),ae(e,n))}).fail(t)})}!0!==a&&ae(e,n)}if(i&&i.enabled()&&l.change&&c(e,l.change,i,l.name),!e.working){if(e.events.show&&e.events.show.length>0)for(let t in e.events.show)C(e,e.events.show[t]);Ae(e,e.def.pages)}if(e.events.required&&e.events.required.length>0)for(let t in e.events.required)y(e,e.events.required[t],!1);if(e.events.disabled&&e.events.disabled.length>0)for(let t in e.events.disabled)w(e,e.events.disabled[t]);"save"in l&&p(e,l.save,!1,i,l.name)?pe(e,!1).done(s):"function"==typeof s&&s(),i&&i.parent&&i.parent.attrName&&x(e,i.parent.attrName,a,i.parent)}function A(e,t){let n=t.data("def"),a=g(e.data,t.attr("data-bind"));n.focus&&c(e,n.focus,a,n.name)}function z(e,t){let n=t.data("def"),a=g(e.data,t.attr("data-bind"));n.blur&&c(e,n.blur,a,n.name)}function j(t,n){if("buttons"in n){let a=e("<div>").addClass(t.settings.styleClasses.buttonGroup),i=Object.assign({},n);delete i.buttons;for(let l in n.buttons)a.append(j(t,e.extend({},i,n.buttons[l])));return a}let a=e('<button type="button">').addClass(t.settings.styleClasses.button).addClass(n.class||"btn-default").data("def",n);switch("label"in n||(n.label="Button"),a.html(m(t,n.label,null,!0,!0)),n.action){case"update":a.click(function(){x(t,a)});break;case"link":a.click(function(){document.location=d(t,n.url)});break;default:let e=n.action?n.action:n.change?n.change:n.click;a.click(function(){c.call(this,t,e,null,n.name)})}return n.nolabel=!0,a}function O(t,a,i){let l=i.data("def"),r=g(t.data,l.name),s=l.options.value||"value",d=l.options.label||"label";if(null===a||Array.isArray(a)&&0===a.length)return r.empty(),r.enabled(!1),x(t,l.name,!0),i.parent().hide();Array.isArray(a)&&(a=a.reduce(function(e,t){return Object.assign(e,{[t[s]]:t[d]})},{}));let c=r.save(!0);if(c){let e=c.filter(function(e){return!(e in a)});for(let t in e)r.remove(e[t])}let h=function(){let n=e(this.childNodes[0]).data("def"),a=o(n,this.childNodes[0].value),i=g(t.data,n.name),l=i.indexOf(a);this.childNodes[0].checked?-1===l&&i.push({__hz_value:a,__hz_label:this.childNodes[1].textContent}):i.unset(l)},m=g(t.data,l.name,!0),b=[],y=!0===l.protected||p(t,l.disabled,!1,r,l.name);if(a=f(a,s,d,l),"sort"in l.options&&("boolean"==typeof l.options.sort&&(l.options.sort=d),a=u(a,l.options.sort,d)),!0===l.buttons){let t=l.class||"primary";for(let n in a){let i=o(l,a[n][s]),u=a[n][d],f=r.indexOf(i)>-1,c=l.name+"_"+i;b.push(e('<label class="btn">').addClass("btn-"+t).html([e('<input type="checkbox" autocomplete="off">').attr("name",c).attr("value",i).prop("checked",f).toggleClass("active",f).prop("disabled",y).attr("data-bind-value",i).data("def",l),e("<span>").html(u)]).toggleClass("active",f).change(h))}return i.addClass("btn-group").addClass("btn-group-toggle").attr("role","group").attr("aria-label",l.label).html(b).parent().show()}"columns"in l||(l.columns=1),l.columns>6&&(l.columns=6);let v=Math.floor(12/l.columns),w=Math.ceil(Object.keys(a).length/l.columns),k=e('<div class="row">'),C=0;for(let t=0;t<l.columns;t++)b.push(e("<div>").addClass("col-md-"+v).toggleClass("custom-controls-stacked",l.inline));for(let i in a){if("filter"in l.options&&-1===l.options.filter.indexOf(a[i][d])){delete a[i];continue}let r=o(l,a[i][s]),u=a[i][d],f=n(),c=m instanceof dataBinderArray&&m.indexOf(r)>-1,p=(l.name,e("<div>").addClass(t.settings.styleClasses.chkDiv).html([e('<input type="checkbox">').addClass(t.settings.styleClasses.chkInput).attr("id",f).attr("value",r).prop("checked",c).prop("disabled",y).data("def",l),e("<label>").addClass(t.settings.styleClasses.chkLabel).html(u).attr("for",f)]).attr("data-bind-value",r).change(h));"css"in l&&p.css(l.css),b[C].append(p),b[C].children().length>=w&&C++}return r.enabled(!0),x(t,l.name,!0),i.html(k.html(b)).parent().show()}function T(n,a,i,l){let r=e.extend(!0,{},a);if(!1===(r.url=m(n,r.url,{site_url:hazaar.url()})))return O(n,null,i);if(!0===l&&fe(n),r.url=d(n,r.url),"data"in r)for(let e in r.data)r.data[e]=m(n,r.data[e]);return e.ajax(r).done(function(e){if("object"!=typeof i.data("def"))return ce(n);O(n,e,i),ce(n)}).fail(t),!0}function B(e,t,n,a){if(!t)return!1;if("object"==typeof t&&"url"in t){let i=t.url.match(/\{\{[\w\.]+\}\}/g),l=n.data("def");if(null!==i)for(let a in i){let r=i[a].substr(2,i[a].length-4);r in l.watchers||(l.watchers[r]=[]),l.watchers[r].push(e.data.watch(r,function(n,a,i){!1!==a.enabled()&&T(e,t,i,!1)},n))}return T(e,t,n,a)}if(t instanceof dataBinderValue){let a="object"==typeof t.value?t.value:"object"==typeof t.other?t.other:null;return O(e,a,n)}return O(e,"data"in t?t.data:t,n),!0}function N(t,n){let a=e("<div>").data("def",n),i=g(t.data,n.name);return!0===n.buttons?a.addClass("btn-group").attr("data-bind",n.name).attr("data-toggle","buttons").toggleClass("btn-group-justified",!0===n.justified):a.attr("data-bind",n.name).attr("data-toggle","checks"),n.watchers={},"string"==typeof n.options&&(n.options={url:n.options}),$(t,n,a,null,function(e,n){B(t,n,e,!0)}),a.on("pop",function(e,t,n){a.find('div[data-bind-value="'+n.value+'"]').children("input[type=checkbox]").prop("checked",!1)}),i&&i.watch(function(e){if(e){let t=a.find('[data-bind-value="'+e.value+'"]');t.is("input")?(e.label||(e.label=t.parent().children("span").html()),t.prop("checked",!0).parent().addClass("active")):t.is("div")&&(e.label||(e.label=t.children("label").html()),t.children("input[type=checkbox]").prop("checked",!0))}return x(t,a,!1,e)}),a}function S(t,a,i,l,r){let s=l.data("def"),o=a.value||"value",d=a.label||"label";i=f(i,o,d,s);for(let r in i){if("filter"in a&&-1===a.filter.indexOf(i[r][d])||"__spacer__"===i[r][o]){delete i[r];continue}let u=n(),f=e('<input type="radio" class="custom-control-input">').attr("id",u).attr("name",s.name).attr("value",i[r][o]).attr("data-bind",s.name).data("def",s),c=e('<div class="custom-control custom-radio">').html([f,e('<label class="custom-control-label">').attr("for",u).html(d.indexOf("{{")>-1?m(null,d,i[r],!0):i[r][d])]).appendTo(l);!0===s.horizontal&&c.addClass("custom-control-inline"),f.change(function(n){return _(t,e(n.target))}).on("update",function(n,a,i,l){return x(t,e(n.target),!1,l)})}return l}function q(t,n,a,i,l){let r=g(t.data,i.attr("data-bind")),s=i.data("def"),d=!1;if(i.prop("disabled",!(!0!==s.disabled&&!0!==s.protected&&!0!==i.data("ed"))),null===a||"object"!=typeof a||Array.isArray(a)&&0===a.length||0===Object.keys(a).length)return!0!==l&&h(t,s),r&&r.enabled(!1),x(t,s.name,!0),i.empty().prop("disabled",!0);let c=n.value||"value",b=n.label||"label";i.empty().append(e("<option>").attr("value","").html(m(t,s.placeholder,null,!0,!0)));let y=function(t,a){t=f(t,c,b,s,d),"sort"in n&&("boolean"==typeof n.sort&&(n.sort=b),t=u(t,n.sort,b,c));let i=r&&null===r.value&&"default"in n?n.default:null;for(let l in t){if("filter"in n&&-1===n.filter.indexOf(t[l][b])){delete t[l];continue}let s=e("<option>").attr("value",t[l][c]).html(b.indexOf("{{")>-1?m(null,b,t[l],!0):t[l][b]).appendTo(a);"__spacer__"===t[l][c]&&s.prop("disabled",!0).addClass("form-select-spacer"),"other"in n&&"string"==typeof n.other&&s.data("other",n.other.indexOf("{{")>-1?m(null,n.other,t[l],!0):t[l][n.other]),null!==i&&t[l][b]===i&&r.set(t[l][c],t[l][b],t[l][n.other])}return t};if(Array.isArray(a)||"object"!=typeof a[Object.keys(a)[0]]||a[Object.keys(a)[0]]&&c in a[Object.keys(a)[0]])a=y(a,i);else for(let t in a)a[t]=y(a[t],e("<optgroup>").attr("label",t).appendTo(i));if(r){"other"in s&&!0===p(t,s.other,null,r,s.name)&&(i.append(e("<option>").attr("value","__hz_other").html("Other")),null===r.value&&null!==r.other&&i.val("__hz_other").change());let l=null!==r.value?r.value.toString():null,d=function(e,t,n){return Array.isArray(e)?e.find(d):e&&e[c].toString()===l};if(Array.isArray(a)||(a=Array.fromObject(a)),l&&a.find(d))i.val(l),x(t,i);else if(r.value=null,1===Object.keys(a).length&&!0===n.single){let e=a[Object.keys(a)[0]],t=o(s,e[c]);r.value!==t&&(r.set(t,b.indexOf("{{")>-1?m(null,b,e,!0):e[b]),"other"in n&&n.other in e&&(r.other=e[n.other]))}r.enabled(!0)}return i}function D(n,a,i,l,r,s){let o=e.extend(!0,{},a);if(!1===(o.url=m(n,o.url,r)))return s(n,a,null,i);if(!1!==l&&i.prop("disabled",!0).html(e("<option value selected>").html("Loading...")),o.url=d(n,o.url),"data"in o)for(let e in o.data)o.data[e]=m(n,o.data[e]);return e.ajax(o).done(function(e){"object"==typeof i.data("def")&&s(n,a,e,i)}).fail(t)}function L(e,t,n,a,i,l){if("string"==typeof t){let l=t.match(/^\{\{([\w\.]+)\}\}$/);null!==l?(e.data.watch(l[1],function(t,n,l){L(e,n,l,a,i)},n),t=g(e.data,l[1])):t={url:t}}if("function"!=typeof l&&(l=q),t instanceof dataBinderValue){let a="object"==typeof t.value?t.value:"object"==typeof t.other?t.other:null;return l(e,{},a,n,!a)}if(!(null!==t&&"object"==typeof t&&"url"in t))return l(e,t,"data"in t?t.data:t,n);let r=t.url.match(/\{\{[\w\.]+\}\}/g),s=n.data("def");for(let a in r){let o=r[a].substr(2,r[a].length-4);o in s.watchers||(s.watchers[o]=[]),void 0===i&&(i=e.data),s.watchers[o].push(i.watch(o,function(n,a,i){!1!==a.enabled()&&D(e,t,i,!0,a,l)},n))}return D(e,t,n,a,i,l)}function $(e,t,n,a,i){if(!("options"in t))return!1;let l={};if(Array.isArray(t.options)){for(let n in t.options)if("object"==typeof t.options[n]&&"when"in t.options[n]&&p(e,t.options[n].when,null,a,t.name)){l="items"in t.options[n]?t.options[n].items:t.options[n];break}if(n&&"watch"in t){let l=function(l,r,s){g(a,t.name).value=null,"function"==typeof i&&i(n,$(e,t,null,r))};for(let n in t.watch)"item."===t.watch[n].substr(0,5)&&a?a.watch(t.watch[n].substr(5),l):(a=e.data,e.data.watch(t.watch[n],l))}}else l=t.options;return"function"==typeof i&&i(n,l),l}function E(t,n,a){if(!0===n.radios){let i=e("<div>").addClass(t.settings.styleClasses.group).data("def",n);return!1!==a&&$(t,n,i,ud,function(e,n){L(t,n,e,ud,ud,S)}),i}let i=e('<div class="input-group">'),l=e("<select>").addClass(t.settings.styleClasses.input).attr("name",n.name).data("def",n).attr("data-bind",n.name).appendTo(i);return n.protected?l.prop("disabled",!0):l.focus(function(n){return A(t,e(n.target))}).blur(function(n){return z(t,e(n.target))}).change(function(n){return _(t,e(n.target))}).on("update",function(n,a,i,l){return x(t,e(n.target),!1,l)}),n.watchers={},"placeholder"in n||(n.placeholder=t.settings.placeholder),!1!==a&&$(t,n,l,null,function(e,n){L(t,n,e)}),i}function I(t,a){let i=g(t.data,a.name),l=e("<div>").addClass(t.settings.styleClasses.chkDiv),r=n(),s=e('<input type="checkbox">').addClass(t.settings.styleClasses.chkInput).attr("name",a.name).attr("id",r).attr("data-bind",a.name).attr("checked",!!i&&i.value).data("def",a).appendTo(l);return a.protected?s.prop("disabled",!0):s.focus(function(n){return A(t,e(n.target))}).blur(function(n){return z(t,e(n.target))}).change(function(n){return _(t,e(n.target))}).on("update",function(n,a,i,l){return x(t,e(n.target),!1,l)}),e("<label>").addClass(t.settings.styleClasses.chkLabel).html(m(t,a.label,null,!0,!0)).attr("for",r).appendTo(l),a.nolabel=!0,l}function F(t,n){let a=g(t.data,n.name),i=e('<div class="date">').addClass(t.settings.styleClasses.inputGroup),l=e("<input>").addClass(t.settings.styleClasses.input).attr("type","datetime"===n.type?"datetime-local":"date").attr("name",n.name).attr("data-bind",n.name).data("def",n).val(a).appendTo(i);return n.protected?l.prop("disabled",!0):l.focus(function(n){return A(t,e(n.target))}).blur(function(n){return z(t,e(n.target))}).change(function(n){return _(t,e(n.target))}).on("update",function(n,a,i,l){return x(t,e(n.target),!1,l)}),!1!==n.suffix&&e("<div>").addClass(t.settings.styleClasses.inputGroupAppend).html(e('<span style="cursor: pointer;">').addClass(t.settings.styleClasses.inputGroupText).html(s(t,"calendar").click(function(){l.focus()}))).appendTo(i),n.format&&("local"===n.format&&(n.format=Date.getLocalDateFormat()),n.__datepicker_options=e.extend({format:n.format,autoclose:!0,forceParse:!0,language:"en",clearBtn:!("required"in n)||p(t,n.required,!1,a),todayHighlight:!0,updateViewDate:!0},n.dateOptions),l.attr("type","text").attr("data-bind-label","true").datepicker(n.__datepicker_options),a&&a.value&&(a.enabled(!1),l.datepicker("setDate",new Date(a.value)),a.enabled(!0)),n.placeholder||(n.placeholder=n.format)),n.placeholder&&l.attr("placeholder",n.placeholder),i}function P(n,a){let i=g(n.data,a.name),l=e("<div>").attr("data-bind",a.name).data("def",a).attr("name",a.name).fileUpload({name:a.name,multiple:a.multiple||!1,btnClass:a.btnClass||"btn btn-default",btnLabel:a.btnLabel||"Select",height:a.height||null,accept:a.accept||null,maxSize:a.maxSize||n.settings.maxUploadSize||null,autoAdd:!1,autoRemove:!1,select:function(e){for(let t in e)n.deloads=n.deloads.filter(function(n){if(n.field!==a.name||n.file.name!==e[t].name)return n}),n.uploads.push({field:a.name,file:e[t]}),i.push(he(e[t]),!0);x(n,l)},remove:function(e){return e=he(e),n.uploads=n.uploads.filter(function(t){if(t.field!==a.name||t.file.name!==e.name)return t}),n.deloads.push({field:a.name,file:e.name}),i.unset(i.indexOf(function(t){return t.name.value===e.name}),!0),x(n,l),!0}}).on("push",function(e,t,n){l.fileUpload("add",n.save())}).on("pop",function(e,t,n){l.fileUpload("remove",n.save())});return be(n,"fileinfo",{field:a.name},!0).done(function(e){if(!e.ok)return;let t=g(n.data,e.field);t.empty();for(let a in e.files)n.deloads.findIndex(function(t){return t.field===e.field&&t.file===e.files[a].name})<0&&t.push(he(e.files[a]));for(let a in n.uploads)n.uploads[a].field===e.field&&t.push(he(n.uploads[a].file))}).fail(t),l}function G(t,n){let i=g(t.data,n.name),l=e("<div>").addClass(t.settings.styleClasses.inputGroup),r=e('<input type="text">').addClass(t.settings.styleClasses.input).attr("data-bind",n.name).attr("data-bind-label",!0).data("def",n).attr("autocomplete","off").appendTo(l);return n.protected?r.prop("disabled",!0):r.focus(function(n){A(t,e(n.target))}).on("blur",function(n){let a=e(this),l=a.parent().parent().children(".form-lookup-popup"),r=a.data("def");i=g(t.data,a.attr("data-bind")),i||(i=g(t.data,a.parent().parent().parent().parent().data("item").attrName)[a.next().attr("name")]),l.length>0?(l.css({opacity:"0"}),setTimeout(function(){l.hide().empty(),!0!==r.lookup.autocomplete&&a.val(i.label)},500)):!0!==r.lookup.autocomplete&&a.val(i.label)}),e('<input type="hidden">').attr("data-bind",n.name).attr("name",n.name).data("def",n).appendTo(l).on("update",function(n,a,i,l){x(t,e(n.target),!1,l)}),n.lookup&&"url"in n.lookup&&r.on("keyup",function(i){if(32===i.keyCode)return;let l=e(this),r=g(t.data,l.attr("data-bind"));if(""===i.target.value)return r.empty();if(!0===n.lookup.autocomplete&&r.set(l.val(),l.val()),i.keyCode>47)delay(function(){let r="",s=l.parent().parent().children(".form-lookup-popup"),o=g(t.data,l.attr("data-bind")),u=n.lookup.value||"value",c=n.lookup.label||"label";if(o||(o=g(t.data,l.parent().parent().parent().parent().data("item").attrName)[l.next().attr("name")]),0===s.length&&(s=e('<div class="form-lookup-popup card">').hide().appendTo(l.parent().parent()).on("click",function(t){let a=e(t.target),i=a.data("lookup");if(!a.is(".list-group-item")||"string"!=typeof a.attr("data-value"))return!1;o.set(a.attr("data-value"),a.text(),"other"in n.lookup&&n.lookup.other in i?i[n.lookup.other]:null),s.hide()})),"startlen"in n.lookup&&i.target.value.length<n.lookup.startlen)return s.hide();let p={__input__:i.target.value},h=s.children("ul");0===h.length&&(h=e('<ul class="list-group">').appendTo(s)),!1!==(url=m(t,n.lookup.url,p))&&("query"in n.lookup&&!1===(r=m(t,n.lookup.query,p))||(s.css({"min-width":l.parent().outerWidth(),opacity:"1"}),!0!==n.lookup.autocomplete&&h.html(e('<li class="list-group-item">').html("Loading results...")),h.children().length>0&&s.show(),e.ajax({method:n.lookup.method||"GET",url:d(t,url),data:r}).always(function(){!0!==n.lookup.autocomplete&&h.empty()}).done(function(t){if("dataKey"in n.lookup&&n.lookup.dataKey in t&&(t=K(t,n.lookup.dataKey,!0)),t=f(t,u,c,n),"extra"in n.lookup&&e.merge(t,n.lookup.extra),Object.keys(t).length>0){!0===n.lookup.autocomplete&&h.empty();for(let n in t)h.append(e('<li class="list-group-item">').html(c.indexOf("{{")>-1?m(null,c,t[n],!0):t[n][c]).attr("data-value",a(t[n],u)).data("lookup",t[n]));1===Object.keys(t).length?h.children().first().click():!0===n.lookup.autocomplete&&s.show()}else!0===n.lookup.autocomplete?(h.empty(),s.hide()):h.html(e('<li class="list-group-item">').html("No results..."))}).fail(function(t){h.html(e('<li class="list-group-item">').html("Error "+t.status+": "+t.statusText))})))},t.settings.lookup.delay);else{let e="bg-primary",t=l.parent().parent().children(".form-lookup-popup").children(".list-group"),n=t.children("."+e);switch(i.key){case"ArrowDown":n.length>0?n.next().length>0&&n.removeClass(e).next().addClass(e):t.children().first().addClass(e);break;case"ArrowUp":n.prev().length>0?n.removeClass(e).prev().addClass(e):n.addClass(e);break;case"Home":n.removeClass(e),t.children().first().addClass(e);break;case"End":n.removeClass(e),t.children().last().addClass(e);break;case"Enter":n.click();break;case"Escape":t.parent().hide().empty();break;case"Backspace":if(""!==l.val())break;case"Delete":r.empty()}i.preventDefault(),i.stopPropagation()}}),"placeholder"in n&&r.attr("placeholder",n.placeholder),n.protected||l.append(e("<div>").addClass(t.settings.styleClasses.inputGroupAppend).html(e("<span>").addClass(t.settings.styleClasses.inputGroupText).html(s(t,"search")))),l}function M(t,n){let a=g(t.data,n.name),i="$",l=e('<input type="text">').addClass(t.settings.styleClasses.input),r=e("<div>").addClass(t.settings.styleClasses.inputGroup),s=e("<div>").addClass(t.settings.styleClasses.inputGroupPrepend),o=e("<div>").addClass(t.settings.styleClasses.inputGroupAppend)
;if(l.attr("name",n.name).attr("data-bind",n.name+".amt").data("def",n).val(a.amt).inputmask("currency",{prefix:""}),"currencies"in n){let e=n.currencies.find(function(e,t,n){if(e.currencycode===a.currency.value)return!0});i=e.symbol}if(r.append([s.html(e("<span>").addClass(t.settings.styleClasses.inputGroupText).html(i)),l,o]),"currencies"in n&&n.currencies.length>1){let i=e('<div class="dropdown-menu">');n.currencies.sort(function(e,t){return e.code===t.code?0:e.code<t.code?-1:1});for(let t of n.currencies)i.append(e('<div class="dropdown-item">').html(t.code+" - "+t.name).attr("data-currency",t.code));o.html([e('<button class="btn btn-outline-secondary dropdown-toggle" type="button" data-toggle="dropdown">').html(a.currency.value),i]),i.on("click",function(n){let a=g(t.data,e(this).parent().parent().children("input").attr("data-bind"));if(!a)return!1;let i=e(n.target).attr("data-currency");e(this).parent().children("button").html(i),a.parent.currency=i}),a.watch("currency",function(e,t){let i=n.currencies.find(function(e,t,n){if(e.code===a.currency.value)return!0});s.children("span").html(i.symbol)})}else o.html(e("<span>").addClass(t.settings.styleClasses.inputGroupText).html(a.currency.value));return n.protected?l.prop("disabled",!0):l.focus(function(n){return A(t,e(n.target))}).blur(function(n){return z(t,e(n.target))}).change(function(n){return _(t,e(n.target))}).on("update",function(n,a,i,l){return x(t,e(n.target),!1,l)}),r}function V(t,n){let a,i=e('<div class="form-multi-text">'),l=g(t.data,n.name),r=function(t){let a=e(t.currentTarget.parentNode).children("span").text();l.remove(o(n,a))},d=function(n){e('<div class="input-mt-item">').html([e("<span>").html(n.toString()),e('<div class="input-mt-item-rm">').html(s(t,"times","Remove")).click(function(e){r(e)})]).data("item",n).appendTo(a)},u=Object.assign({},n,{name:"__hz_input_mt_"+n.name,type:n.arrayOf});if("format"in n&&"validate"in n&&(delete u.validate.minlen,delete u.validate.maxlen),"hint"in n&&!0!==n.hint||(n.hint="Press ENTER to add item to list."),J(je(ud,t),n.arrayOf,u,!0).appendTo(i).on("keypress",function(a){if(13!==a.which)return;let i=o(n,e(this).val());!i||l.indexOf(i)>=0||!0!==le(t,u.name,l,u,n,i)||(l.push(i),e(this).val(""))}),a=e('<div class="input-mt-items">').attr("data-bind",n.name).appendTo(i).on("push",function(e,t,n){d(n)}).on("pop",function(t,n,a){e(this).children().each(function(t,n){e(n).data("item")===a&&e(n).remove()})}),l.length>0)for(let e of l)d(e);return i}function J(t,n,a,i){let l=null,s=g(t.data,a.name);if("int"!==n&&"integer"!==n||(n="number"),a.multiline?(l=e("<textarea>").addClass(t.settings.styleClasses.input),"height"in a&&l.css("height",a.height)):l=e("<input>").addClass(t.settings.styleClasses.input).attr("type",a.password?"password":n),l.attr("name",a.name).attr("data-bind",a.name).data("def",a).val(s instanceof dataBinderValue?s.value:s),a.protected?l.prop("disabled",!0):l.focus(function(n){return A(t,e(n.target))}).blur(function(n){return z(t,e(n.target))}).change(function(n){return _(t,e(n.target))}).on("update",function(n,a,i,l){return x(t,e(n.target),!1,l)}),"text"===n&&"validate"in a&&"maxlen"in a.validate&&l.attr("maxlength",a.validate.maxlen),"format"in a&&l.attr("type","text").inputmask(a.format),"placeholder"in a&&l.attr("placeholder",a.placeholder),!0===i)return l;let o=e("<div>").addClass(t.settings.styleClasses.inputGroup);if(a.prefix&&e("<div>").addClass(t.settings.styleClasses.inputGroupPrepend).appendTo(o).html(("text"===a.type&&null!==(sf=K(t.def,a.prefix))&&a.name!==sf.name?U(t,sf,null,null,!0).css("text-align","left"):e("<span>").html(m(t,a.prefix,null,!0,!0))).addClass(t.settings.styleClasses.inputGroupText)),a.suffix||!0===a.copy||!0===a.reveal){let n=e("<div>").addClass(t.settings.styleClasses.inputGroupAppend).appendTo(o);a.suffix&&n.html(("text"===a.type&&null!==(sf=K(t.def,a.suffix))&&a.name!==sf.name?U(t,sf,null,null,!0).css("text-align","left"):e("<span>").html(m(t,a.suffix,null,!0,!0))).addClass(t.settings.styleClasses.inputGroupText)),!0===a.password&&!0===a.reveal&&n.append(e('<span class="input-group-text">').click(function(t){let n=e(this).children("i"),a=!1;(a=l.is("[type=password]"))?l.attr("type","text"):l.attr("type","password"),n.toggleClass("fa-eye-slash",a).toggleClass("fa-eye",!a)}).html(e('<i class="fa fa-eye"">').attr("title","Toggle "+a.label.toLowerCase()))),!0===a.copy&&n.append(e('<span class="input-group-text">').click(function(e){r(l,this)}).html(e('<i class="fa fa-copy" title="Copy to clipboard">')))}return s&&s.value&&ae(t,l),o.append(l)}function U(t,n,a,i,l){let r;if(!0===t.viewmode)if(i instanceof dataBinderArray)r=H(t,n);else{if("button"===n.type)return;r=e("<span>").attr("data-bind",i?i.attrName:"").html(i?i.toString():"")}else if("array"!==n.type||"options"in n){if(n.type)if("options"in n)r="array"===n.type?N(t,n):E(t,n,a);else if("lookup"in n&&"array"!==n.type)"string"==typeof n.lookup&&(n.lookup={url:n.lookup}),r=G(t,n);else switch(n.type){case"button":r=j(t,n);break;case"boolean":r=I(t,n);break;case"date":case"datetime":r=F(t,n);break;case"file":r=P(t,n);break;case"money":r=M(t,n);break;case"text":case"string":default:r=J(t,n.type,n)}}else r="arrayOf"in n?V(t,n):H(t,n);return!0===l&&r.is("."+t.settings.styleClasses.inputGroup)&&(r=r.children(),"width"in n&&r.css("width",n.width)),r}function R(e,t){if(Array.isArray(e)){for(let t in e)e[t]=R(e[t]);return e}if("fields"in e){for(let n in e.fields)e.fields[n]=R(e.fields[n],(t||e.name)+"."+n);return e}return{html:'<div data-bind="'+(t||e.name)+'">',weight:e.weight||1}}function H(t,n){let a=g(t.data,n.name),i=e('<div class="itemlist">').addClass(t.settings.styleClasses.group);if(!(a instanceof dataBinderArray))return i;if("label"in n&&(e("<h4>").addClass(t.settings.styleClasses.label).html(m(t,n.label,null,!0,!0)).appendTo(i),n.nolabel=!0),!("fields"in n))return i;let l=n.fields&&"label"in n.fields[Object.keys(n.fields)[0]],r=Y(t,n.fields,n.layout),o=e('<div class="itemlist-item">');if(!0!==t.viewmode&&p(t,n.allow_remove,!0,a,n.name)&&o.append(e('<div class="itemlist-item-rm">').html([!0===n.allow_edit&&l?e("<label>").html("&nbsp;").addClass(t.settings.styleClasses.label):"",e('<button type="button" class="btn btn-danger btn-sm">').html("btnLabels"in n&&"remove"in n.btnLabels?n.btnLabels.remove:s(t,"minus"))])),!0!==t.viewmode&&p(t,n.allow_add,!0,a,n.name)){let o=je(ud,t),d=new dataBinder(ve(n.fields),n.name,null,n.name);o.settings=e.extend({},e.fn.hzForm.defaults,t.settings),o.validate=!1,o.data=d,o.def={fields:n.fields};let u=e('<button type="button" class="btn btn-success btn-sm">').html("btnLabels"in n&&"add"in n.btnLabels?n.btnLabels.add:s(t,"plus")),f=W(o,{fields:r,row:!0},!0,ud,ud,ud,!0).addClass("itemlist-newitem").attr("data-field",n.name);f.find("input,textarea,select").attr("data-bind-ns",n.name).keypress(function(t){13===t.which&&e(t.target).parent().parent().parent().children(".itemlist-newitem-add").children("button").click()}),f.find("select").each(function(t,n){let a=e(n),i=a.data("def");a.off("change").on("change",function(){return _(o,e(this))}).off("update").on("update",function(t,n,a,i){return x(o,e(this),!1,i)}),"options"in i&&$(o,i,a,d,function(e,t){L(o,t,e)})}),i.append(e('<div class="itemlist-newitems">').html([e('<div class="itemlist-newitem-add">').html([l?e("<label>").html("&nbsp;").addClass(t.settings.styleClasses.label):"",u]),f])),u.click(function(){let t=!0;f.find("input,select,textarea").each(function(n,a){if(!a.name)return;let i=e(a),l=null,r=i.data("def"),s=g(o.data,i.attr("data-bind"));if(l=i.is("[type=checkbox]")?i.is(":checked"):i.val(),s&&s.attrName in o.required&&!0===o.required[s.attrName]&&!l)return i.toggleClass("is-invalid",!0),void(t=!1);if(i.is("select"))l={__hz_value:l,__hz_label:i.children("option:selected").text()};else if("date"===r.type&&"format"in r){let e=i.datepicker("getDate");l=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()}let d=g(o.data,a.name,!1,l);d&&d.set(l,null,null,!1)}),!0===t&&(a.push(o.data.save()),o.data.empty())})}return!0!==t.viewmode&&!0===p(t,n.allow_edit,!1,a,n.name)||(r=R(r)),o.append(W(t,{fields:r,row:!0},!0,!1,!1,ud,!0)),a.watch(function(a,i){if(!a)return;let l=a.attrName;a.extend(ve(n.fields),!0),i.find("select,input").each(function(n,i){let l=e(i),r=l.data("def");if(l.is("select"))"options"in r&&$(t,r,l,a,function(e,n){L(t,n,e,!1,a)});else if("date"===r.type&&"format"in r){let e=a[r.name];l.data("datepicker",null),l.datepicker(r.__datepicker_options),e&&e.value&&l.datepicker("setDate",new Date(e.value))}}),e(i).find(".form-group,.form-section").each(function(n,i){let r=e(i),s=r.data("def");if(!s||!s.name)return;let o=g(a,s.name);o&&(r.data("name",l+"."+s.name).data("item",o.attrName),r.find("label").each(function(e,t){t.attributes.for.value=l.replace(/\[|\]/g,"_")+s.name}),"disabled"in s&&v(t,s,r),"required"in s&&b(t,s,r),"show"in s&&k(t,s,r))}),"disabled"in n&&v(t,n,e(i).parent().parent())}),i.append(e('<div class="itemlist-items" data-bind-template="o">').attr("data-bind",n.name).data("template",o)).data("def",n).data("item",a).on("click",".btn-danger",function(t){let n=Array.from(this.parentNode.parentNode.parentNode.children).indexOf(this.parentNode.parentNode),i=e(t.currentTarget.parentNode.parentNode.parentNode);a.unset(n),i.find("input,textarea,select").each(function(t,n){let a=e(n);a.parent().data("item",a.attr("data-bind"))})}),i}function K(t,n,a){if(n instanceof Object)t="name"in n?e.extend(K(t,n.name),n):n;else{let i=n.split(/[\.\[]/);for(let e in i){if(t&&"type"in t&&"money"===t.type&&"amt"===i[e])break;if("]"!==i[e].slice(-1)){if(!0!==a){if(!("fields"in t))return null;t=t.fields}if(!(i[e]in t))return null;t=t[i[e]]}}!0!==a&&(t=e.extend(!0,t,{name:n}))}return t}function Q(e,t){let n=/\{\{(\w*)\}\}/g,a=function(t,n){return"{{"+e+"."+n+"}}"};if(Array.isArray(t.options))for(let n in t.options)Q(e,t.options);else"object"==typeof t.options&&"url"in t.options?t.options.url=t.options.url.replace(n,a):"string"==typeof t.options&&(t.options=t.options.replace(n,a))}function Y(t,n,a,i,l){if(!n)return[];a||(a=Array.isArray(n)?e.extend(!0,[],n):Object.keys(n));for(let r in a)if("string"==typeof a[r]&&(a[r]={name:a[r]}),"object"==typeof a[r])if(Array.isArray(a[r]))a[r]={fields:Y(t,n,a[r],i,l)};else if("name"in a[r]){let s=a[r].name in n?n[a[r].name]:a[r].name in t.def.fields?t.def.fields[a[r].name]:null;if(!s||!0===s.hidden)continue;a[r]=e.extend(!0,{},s,a[r]),i&&(a[r].name=i+(l?"["+a[r].name+"]":"."+a[r].name),"options"in a[r]&&Q(i,a[r]))}else"fields"in a[r]&&("layout"in a[r]||(a[r].layout=Array.isArray(a[r].fields)?e.extend(!0,[],a[r].fields):Object.keys(n)),a[r].fields=Y(t,n,a[r].layout,i,l));return a}function W(t,n,a,i,l,r,o){let d=null,u=null;if(n instanceof Array&&(n={fields:n}),d=K(t.def,n)){if(!r&&"name"in d&&d.name&&(r=g(t.data,d.name)),"name"in d&&"default"in d&&r instanceof dataBinderArray&&null===r.value&&(r.value=d.default),"horizontal"in d&&(a=d.horizontal),"render"in d){if(u=c(t,d.render,r,d.name),!u)return;!0!==o&&d.name&&t.pageFields.push(d.name)}else if("fields"in d&&"array"!==d.type){let s,f=Y(t,d.fields,"layout"in d?e.extend(!0,[],d.layout):null,d.name),c=f.length,p=[];null==a&&(a=!t.settings.horizontal&&!("layout"in d&&d.layout));for(let e in f){let i=f[e];"string"==typeof i&&(i=K(t.def,i)),i&&(a&&!Array.isArray(i)&&("weight"in i||(i.weight=1),c+=i.weight-1),!0!==n.protected||"object"!=typeof i||Array.isArray(i)||(i.protected=!0),p.push(i))}s=12/c,u=e('<div class="form-section">').toggleClass("row",a).data("def",d),"label"in d&&u.append(e("<div>").toggleClass("col-md-12",a).html(e("<h5>").html(d.label)));for(let e in p){let n="name"in p[e]?r instanceof dataBinder?r[p[e].name]:void 0:r;!0===d.horizontal&&(p[e].row=!0);let f=s,c=W(t,p[e],!a,i,l,n,o);c&&(p[e]instanceof Object&&"weight"in p[e]&&(f=Math.round(f*p[e].weight)),u.append(c.toggleClass("col-md-"+f,a)),a&&!0!==d.row&&c.removeClass("row"))}}else{d.nolabel=!1;let n=e('<div class="form-field">'),a=U(t,d,i,r);t.settings.horizontal&&(!0!==d.nolabel&&d.label?n.addClass("col-sm-"+t.settings.hz.right):n.addClass("col-sm-12").toggleClass("row",!0===d.row)),!0!==o&&d.name&&t.pageFields.push(d.name),u=e("<div>").addClass(t.settings.styleClasses.group).toggleClass("row",t.settings.horizontal).data("def",d),(d.title||!0!==d.nolabel&&d.label)&&u.append(e("<label>").addClass(t.settings.styleClasses.label).toggleClass("col-sm-"+t.settings.hz.left,t.settings.horizontal).attr("for","__hz_field_"+d.name).html(m(t,"title"in d?d.title:d.label,null,!0,!0))),a&&(n.html(a),"hint"in d&&n.append(e('<small class="form-text text-muted">').html(m(t,d.hint,null,!0,!0))),"css"in d&&a.css(d.css),"cssClass"in d&&a.addClass(d.cssClass),u.append(n))}if(u.data("def",d).data("item",r||null),"width"in d&&u.width(d.width),"html"in d){let n=d.html;"label"in d&&0===u.children().length&&u.append(e("<label>").addClass(t.settings.styleClasses.label).html(d.label)),u.append(e("<div>").html(m(t,n,null,!0,!0)))}if("header"in d&&u.prepend(d.header),"footer"in d&&u.append(d.footer),"show"in d&&!1!==l&&k(t,d,u),"watch"in d)for(let e in d.watch)t.data.watch(d.watch[e],function(e){x(t,e)});return!0===t.viewmode?u:("tip"in d&&u.children("label.control-label").append(s(t,"question-circle").addClass("form-tip").attr("data-title",d.tip).tooltip({placement:"auto",html:!0})).on("show.bs.tooltip",function(n){let a=e(this).children(".form-tip");a.attr("data-original-title",m(t,a.attr("data-title"),null,!0,!1)).tooltip("_fixTitle")}),"required"in d&&!1!==l&&b(t,d,u),"disabled"in d&&!1!==l&&v(t,d,u),"invalid"in d&&u.append(e('<div class="invalid-feedback">').html(d.invalid)),u)}}function X(t,n,a){let i=e("<div>");if(Array.isArray(n)){let l=null;if(void 0===a&&(a=!0),a){i.addClass("row");let e=n.length;for(let t in n)"object"!=typeof n[t]||Array.isArray(n[t])||("weight"in n[t]||(n[t].weight=1),e+=n[t].weight-1);l=12/e}for(let r in n)i.append(e("<div>").toggleClass("col-md-"+Math.round((n[r].weight||1)*l),a).html(X(t,n[r],!a)));return i}if("object"!=typeof n)return null;let l=e('<fieldset class="col col-12">').data("def",n).appendTo(i);n.label&&l.append(e("<legend>").html(m(t,n.label,null,!0,!0)));for(let e in n.fields)l.append(W(t,n.fields[e]));return"show"in n&&k(t,n,l),i.addClass("row")}function Z(t,n){if("object"!=typeof n||"show"in n&&!0!==p(t,n.show,!0))return null;let a=e("<div>"),i=[];for(let e in n.sections)i.push(X(t,n.sections[e]));if(t.events.show.length>0)for(let e in t.events.show)C(t,t.events.show[e]);return!0===t.settings.cards?(a.addClass("card"),n.label&&a.append(e('<div class="card-header">').html(m(t,n.label,null,!0,!0))),a.append(e('<div class="card-body">').addClass(t.settings.styleClasses.page).data("def",n).append(i)),!0===t.settings.singlePage&&a.addClass("mb-5")):(a.addClass(t.settings.styleClasses.page),n.label&&a.append(e("<h1>").html(m(t,n.label,null,!0,!0))),a.append(i)),a.data("def",n)}function ee(e,t){e.page=t,e.events={show:[],required:[],disabled:[],change:{}},e.eval_cache=null,e.pageFields=[],e.data.unwatchAll()}function te(t,n){t.objects={loader:e('<div class="forms-loader-container">').html(e("<div>").addClass(t.settings.loaderClass)),container:e("<div>").addClass(t.settings.styleClasses.container).hide()},e(t).html([t.objects.loader,t.objects.container])}function ne(t,n,a,i){if("number"!=typeof n&&(n=parseInt(n)),!0!==i&&n===t.page)return!1;let l=function(t,n){if(fe(t),t.objects.container.empty(),t.settings.singlePage){ee(t,0);for(let e in t.pages)t.objects.container.append(Z(t,t.pages[e]))}else ee(t,n),t.objects.container.append(Z(t,t.pages[n])),e(t).trigger("nav",[t.page+1,t.pages.length]);t.data.resync(),ce(t),"function"==typeof a&&a()};if(null!==t.page&&n>t.page){let a=t.pages[t.page];if("validate"in a)return void ue(t).done(function(i,r){!0===i?"save"in a&&p(t,a.save,!1)?pe(t,!1).done(function(){l(t,n)}):l(t,n):e(t).trigger("validate",[i,r])});if("save"in a&&p(t,a.save,!1))return void pe(t,!1).done(function(){l(t,n)})}return l(t,n)}function ae(t,n,a){if(!n.is("input,select,textarea"))return n.children("input,select,textarea").each(function(n,i){ae(t,e(i),a)});let i=n.attr("data-bind");return i?re(t,i,{required:!1,disabled:!1}).done(function(l,r,s){!0!==r&&!0===a||(n.toggleClass("is-invalid",!0!==r).toggleClass("border-warning",!0===r&&null!==s&&"object"==typeof s&&!0===s.warning),e(t).trigger("validate_field",[i,!0===r,r]))}):void 0}function ie(t,n,a){let i={name:t,field:e.extend({},n),status:a};return i}function le(e,t,n,a,i,l){if(!n||!a||!0!==e.validate)return!0;if("show"in a&&!p(e,a.show,!0,n,a.name))return!0;if(void 0===l&&(l=n instanceof dataBinderArray?n.length>0?n:null:a.other&&!n.value?n.other:n.value),t in e.required||(e.required[t]=p(e,a.required,i.required,n,t)),i.required=e.required[t],i.required&&null===l)return ie(t,a,"required");if(null==l)return!0;if("format"in a&&l instanceof dataBinderValue&&"date"!==a.type&&!Inputmask.isValid(String(l),a.format))return ie(t,a,"bad_format");if("validate"in a)for(let i in a.validate){let r=a.validate[i];switch(i){case"min":if(parseInt(l)<r)return ie(t,a,"too_small");break;case"max":if(parseInt(l)>r)return ie(t,a,"too_big");break;case"with":let s=new RegExp(r);if("string"!=typeof l||!l.match(s))return ie(t,a,"regex_failed");break;case"equals":if(l!==r)return ie(t,a,"not_equal");break;case"minlen":if(n instanceof dataBinderValue&&(!l||l.length<r)||!n||n.length<r)return ie(t,a,"too_short");break;case"maxlen":if(n instanceof dataBinderValue&&(!l||l.length>r)||!n||n.length>r)return ie(t,a,"too_long");break;case"custom":if(!p(e,r,!0))return ie(t,a,"custom")}}return!0}function re(n,a,i,l){let r=[];return setTimeout(function(){let s="object"==typeof a?a:K(n.def,a);if(s){let a=g(n.data,s.name);a||(s.disabled=!0),s.name in n.disabled||(n.disabled[s.name]="disabled"in s&&p(n,s.disabled,i.disabled,a,s.name)),i.disabled=n.disabled[s.name];let o=!(!s.protected&&!i.disabled)||le(n,s.name,a,s,i);if("fields"in s&&a instanceof dataBinder){let e="array"===s.type?a.save():[a];if(!0!==o||0===e.length)for(let e in r)r[e](s.name,o,l);else for(let t in e)for(let e in s.fields){"name"in s.fields[e]||(s.fields[e].name=e);let a="array"===s.type?s.name+"["+t+"]."+e:s.name+"."+e;n.queue.push(a),re(n,a,{required:i.required,disabled:i.disabled},l).done(function(e,t){for(let n in r)r[n](e,t,l)})}}if(a&&a instanceof dataBinderValue&&a.value&&!0===o&&"validate"in s&&"url"in s.validate){let i=m(n,s.validate.url,{__input__:a.value},!0),l={target:[i,{name:s.name,value:a.value}]},o=JSON.stringify(l).hash(),d=function(e){o in n.apiCache||(n.apiCache[o]=e);let t=!0===e.ok||ie(s.name,s,e.reason||"api_failed("+s.validate.url+")");if(r.length>0)for(let n in r)r[n](s.name,t,e)};o in n.apiCache?d(n.apiCache[o]):!0===n.standalone?e.ajax({method:"POST",url:s.validate.url,contentType:"application/json",data:JSON.stringify(l.target[1])}).done(d).fail(t):be(n,"api",l,!1).done(d).fail(t)}else if(r.length>0)for(let e in r)r[e](s.name,o,l);if(s.name in n.monitor)for(let e in n.monitor[s.name])n.monitor[s.name][e](o)}else for(let e in r)r[e](a,!0,l)}),{done:function(e){return"function"==typeof e&&r.push(e),this}}}function se(e,t){if(Array.isArray(e)){for(let n in e)if(se(e[n],t))return!0}else{let n="string"==typeof e?e:e.name;if(t.name===n)return!0}return!1}function oe(e,t){for(let n in e.def.pages)for(let a in e.def.pages[n].sections)for(let i in e.def.pages[n].sections[a].fields)for(let l in t)if(se(e.def.pages[n].sections[a].fields[i],t[l])){let t=parseInt(n);return void(e.page!==t&&ne(e,t,function(){ue(e)}))}}function de(t,n){let a=[];return t.queue=[],t.required=[],setTimeout(function(){let i=[];if(void 0===n){if(!("def"in t&&"fields"in t.def))return;n=Object.keys(t.def.fields)}for(let l in n)t.queue.push(n[l]),re(t,n[l],{required:!1,disabled:!1}).done(function(n,l,r){let s=t.queue.indexOf(n);s>=0&&t.queue.splice(s,1),Array.isArray(l)||(l=[{name:n,result:l}]);for(let t in l)!0!==l[t].result&&i.push(l[t].result),e('[data-bind="'+l[t].name+'"]').toggleClass("is-invalid",!0!==l[t].result).toggleClass("border-warning",!0===l[t].result&&null!==r&&"object"==typeof r&&!0===r.warning);if(0===t.queue.length)for(let e in a)a[e](0===i.length,i)})}),{done:function(e){"function"==typeof e&&a.push(e)}}}function ue(e){return de(e,e.pageFields)}function fe(e){e.objects.container.hide(),e.objects.loader.show(),e.loading++}function ce(t){t.loading--,t.loading>0||null===t.page||(t.objects.loader.hide(),t.objects.container.show(),e(t).trigger("ready",[t.def]))}function pe(t,n,a){let i={done:null},l=function(t,n){let a=t.data.save(!0===t.standalone);for(let e in t.def.fields)!0===t.def.fields[e].protected&&delete a[e];let l=t.standalone?a:{params:n||{},form:a};(events=jQuery._data(t,"events"))&&"submit"in events&&!0!==e(t).triggerHandler("submit",[a,l])||("saveURL"in t.settings&&(l.url=t.settings.saveURL),e(t).trigger("saving",[a,l]),t.data.commit(),be(t,"save",l,!1).done(function(n){if(!n.ok)return e(t).trigger("saverror",t.standalone?n:[{error:{str:n.reason||"An unknown error occurred while saving the form!"}},n.params]);t.posts={},t.uploads.length>0||t.deloads.length>0?(e(t).trigger("attachStart",[t.uploads,t.deloads]),me(t,function(a,l){e(t).trigger("attachDone",[l]),a?(e(t).trigger("save",[n.result,n.params]),i.done&&i.done()):e(t).trigger("saverror",[{error:{str:"File upload failed"}},n.params,l])})):(e(t).trigger("save",t.standalone?n:[n.result,n.params]),i.done&&i.done())}).fail(function(n){e(t).trigger("saverror",[n.responseJSON,l])}))};return!0===n||void 0===n?de(t).done(function(n,i){n?l(t,a):(e(t).trigger("saverror",[{error:{str:"Validation failed!"},validation:i}]),e(t).trigger("validate",[n,i]),t.settings.validateNav&&oe(t,i))}):l(t,a),{done:function(e){"function"==typeof e&&(i.done=e)}}}function he(e){if(e instanceof File)e={lastModified:e.lastModified,lastModifiedDate:e.lastModifiedDate,name:e.name,size:e.size,type:e.type,url:URL.createObjectURL(e)};else if(Array.isArray(e))for(let t in e)e[t]=he(e[t]);else{let t=/[^/]*$/.exec(e.url)[0];e.url=e.url.substr(0,e.url.length-t.length)+encodeURIComponent(t)}return e}function me(t,n){if(t.deloads.length>0){let a={name:t.settings.form,params:t.settings.params,remove:t.deloads};e.ajax({url:hazaar.url(t.settings.controller,"detach"),method:"POST",data:JSON.stringify(a),contentType:"application/json"}).done(function(e){"removed"in e&&(t.deloads=t.deloads.filter(function(t){return!1===e.removed.indexOf(t.file)})),0===t.uploads.length&&n(e.ok)})}if(t.uploads.length>0){let e={pending:[],working:[],attached:[],failed:[]};t.uploads.sort(function(e,t){return e.file.name===t.file.name?0:e.file.name<t.file.name?-1:1}),e.pending=Object.assign([],t.uploads),ge(t,e,n)}}function ge(t,n,a){for(;n.working.length<t.settings.concurrentUploads;){let i=new FormData,l=n.pending.shift();if(!l)break;n.working.push(l),i.append("name",t.settings.form),i.append("params",JSON.stringify(t.settings.params)),i.append("attachment[field]",l.field),i.append("attachment[file]",l.file),e(t).trigger("fileStart",[l]),e.ajax({type:"POST",data:i,processData:!1,contentType:!1,url:hazaar.url(t.settings.controller,"attach"),upload_file:l,xhr:function(){return xhr=new XMLHttpRequest,xhr.upload.onprogress=function(n){e(t).trigger("fileProgress",[this.file,n])},xhr.upload.file=this.upload_file,xhr}}).done(function(n){let a=this.upload_file;t.uploads=t.uploads.filter(function(e){return!(a.field===e.field&&a.file.name===e.file.name)}),e(t).trigger("fileDone",[a,n])}).fail(function(n){this.upload_file.failed=!0,this.upload_file.response=n.responseJSON,e(t).trigger("fileError",[this.upload_file,n])}).always(function(){let e=this.upload_file;n.working=n.working.filter(function(t){return!(e.field===t.field&&e.file.name===t.file.name)}),!0===e.failed?n.failed.push(e):n.attached.push(e),n.pending.length>0?ge(t,n,a):0===n.working.length&&a(0===n.failed.length,n)})}}function be(t,n,a,i,l){!0===i&&fe(t);let r={},s="";if(!0===t.standalone){if(!(n in t.settings.endpoints))return e(t).trigger("error",["Host endpoint "+n+" is unknown!"]);s=t.settings.endpoints[n],r=a}else s=hazaar.url(t.settings.controller,"interact/"+n),r=e.extend(!0,{},{name:t.settings.form,params:t.settings.params},a);return e.ajax({method:"POST",url:s,async:!0!==l,contentType:"application/json",data:JSON.stringify(r)}).always(function(e){!0===i&&ce(t),"data"in e&&console.log(e.data)})}function ye(t,n){if("string"==typeof n)return e.get(n).done(function(e){ye(t,e)});e(t).find(".is-different").removeClass("is-different"),t.data.diff(n,function(e){e.find().addClass("is-different")})}function ve(e){if(!e)return;let t={};for(let n in e)"fields"in e[n]&&"array"!==e[n].type?t[n]=ve(e[n].fields):(e[n].default||"array"!==e[n].type&&"file"!==e[n].type||(e[n].default=[]),t[n]=e[n].default?e[n].default:null);return t}function we(t,n,a){let i=["disabled","protected","focus","blur"];for(let l in n){let r=a?e.extend(!0,{},a):null;if("string"==typeof n[l]&&(n[l]={type:n[l],label:l}),"type"in n[l]||!("options"in n[l]||"lookup"in n[l]))if("type"in n[l]&&"types"in t.def&&n[l].type in t.def.types){let e=t.def.types[n[l].type];n[l]=jQuery.extend(!0,{},e,r,n[l]),n[l].type=e.type,n[l].horizontal=!1,r={};for(let e in i)i[e]in n[l]&&(r[i[e]]=n[l][i[e]])}else"type"in n[l]&&"array"===n[l].type?("arrayOf"in n[l]&&"types"in t.def&&n[l].arrayOf in t.def.types&&(n[l].fields=t.def.types[n[l].arrayOf].fields,delete n[l].arrayOf),"default"in n[l]&&!Array.isArray(n[l].default)&&(n[l].default=[n[l].default])):r&&(n[l]=jQuery.extend(!0,{},r,n[l]));else n[l].type="text";"watch"in n[l]&&!Array.isArray(n[l].watch)&&(n[l].watch=[n[l].watch]),"fields"in n[l]&&we(t,n[l].fields,r)}}function ke(e,n){Array.isArray(n)||(n=[n]);for(let a in n)jQuery.ajax({url:hazaar.url(e.settings.controller,"script/"+n[a]),dataType:"script"}).fail(t)}function Ce(e){return be(e,"init").done(function(t){t.ok&&("form"in t&&(e.def=t.form),"tags"in t&&(e.tags=t.tags),"scripts"in e.def&&ke(e,e.def.scripts),we(e,e.def.fields),e.data=new dataBinder(ve(e.def.fields)))}).fail(t)}function _e(t,n,a){if(!n)return{};for(let i in n){let l=(a?a+".":"")+i,r=null;null===n[i]||"object"!=typeof n[i]||"__hz_value"in n[i]?"boolean"==typeof n[i]?n[i]={__hz_value:n[i],__hz_label:n[i]?"Yes":"No"}:!0===t.viewmode&&null!==(r=K(t.def,l))&&"options"in r&&$(t,r,e("<i>").data("def",r),null,function(e,a){"object"!=typeof a||"url"in a?L(t,a,e,!1,null,function(e,t,a,r){let s=g(e.data,l);s&&(s.label=a[n[i]])}):n[i]={__hz_value:n[i],__hz_label:a[n[i]]}}):_e(t,n[i],l)}return n}function xe(e){let t=function(e,n){if(Array.isArray(e))for(let a in e)t(e[a],n);else if("object"==typeof e)if("sections"in e)t(e.sections,n);else if("fields"in e)t(e.fields,n);else if("name"in e){let t=e.name.split(".");for(let a=1;a<=t.length;a++){let i=t[a-1];a<t.length?(n[i]={fields:{}},n=n[i].fields):i in n||(n[i]=e)}}};if(!Array.isArray(e))return!1;let n={};return t(e,n),{name:"",pages:[{sections:[{fields:e}]}],fields:n}}function Ae(t,n){let a=!1,i="pages"in t&&t.pages[t.page]?t.pages[t.page].id:t.page;t.pages=[],"pstate"in t||(t.pstate=[]);for(let e in n){let l=!("show"in n[e])||p(t,n[e].show,!0);if(n[e].id=parseInt(e),!0!==a&&t.pstate[e]!==l&&(a=!0),t.pstate[e]=l,!0!==t.pstate[e])continue;let r=t.pages.push(n[e]);n[e].id===i&&(t.page=r-1)}if(a){let n=[];for(num in t.pages)n[num]={label:m(t,t.pages[num].label,null,!0,!0)};e(t).trigger("pages",[n,t.page]).trigger("nav",[t.page+1,t.pages.length])}return a}function ze(n,a){let i=function(t){t.ok&&("horizontal"in n.def&&(n.settings.horizontal=n.def.horizontal),n.data.extend(_e(n,t.form)),n.data.commit(),Ae(n,n.def.pages),e(n).trigger("data",[n.data.save()]),ne(n,n.page,null,!0))};if(a&&(n.settings.endpoints.init=a),!0===n.standalone||!0==(n.standalone="def"in n.settings)){let a=function(a){n.def=a,Array.isArray(n.def)&&(n.def=xe(n.def)),we(n,n.def.fields),n.data=new dataBinder(ve(n.def.fields)),e(n).trigger("load",[n.def]),"load"in n.settings.endpoints?be(n,"load").done(i).fail(t):"string"==typeof n.settings.data?e.get(n.settings.data).done(function(e){i({ok:!0,form:e})}).fail(t):i({ok:!0,form:n.settings.data})};"init"in n.settings.endpoints?be(n,"init").done(a).fail(t):a(n.settings.def),delete n.settings.def,delete n.settings.data}else Ce(n).done(function(a){e(n).trigger("load",[n.def]),be(n,"load").done(i).fail(t)})}function je(e,t){return void 0===e&&(e={}),e.data={},e.events={show:[],required:[],disabled:[],change:{}},e.posts={},e.viewmode=!1,e.page=0,e.working=!1,e.validate=!0,e.standalone=!1,e.pageFields=[],e.queue=[],e.loading=0,e.uploads=[],e.deloads=[],e.monitor={},e.apiCache={},e.required={},e.disabled={},t&&(e.parent=t,e.settings=t.settings),e}function Oe(t,n){je(t),t.settings=e.extend(!0,{},e.fn.hzForm.defaults,n),t.viewmode=t.settings.viewmode,t.settings.concurrentUploads<1&&(t.settings.concurrentUploads=1),e(t).trigger("init"),te(t),ze(t),form=t}e.fn.hzForm=function(){let t=arguments,n=this.get(0);switch(t[0]){case"info":let e=n.data.save(),a={};for(let t in e)a[t]={label:n.def.fields[t].label,value:e[t]};return a;case"data":return n.data;case"def":return n.def;case"load":return void(n.settings&&ze(n,t[1]))}return this.each(function(n,a){if(a.settings)switch(t[0]){case"reload":if(!0===t[1])ze(a);else{let e=a.data.save();Ce(a).done(function(){for(let t in e)a.data[t]=e[t];Ae(a,a.def.pages),ne(a,a.page,null,!0)})}break;case"nav":case"navigate":case"page":ne(a,t[1]);break;case"prev":a.page>0&&ne(a,a.page-1);break;case"next":a.page<a.pages.length-1&&ne(a,a.page+1);break;case"save":pe(a,t[1],t[2]).done(function(){!0===a.settings.viewmode&&(a.viewmode=!0,ne(a,a.page,null,!0))});break;case"single":a.settings.singlePage=Boolean(t[1]),ne(a,0);break;case"validate":de(a).done(function(n,i){e(a).trigger("validate",[n,i]),(void 0!==t[1]||!0!==a.settings.validateNav)&&!1===t[1]||n||oe(a,i)});break;case"reset":a.data.reset();break;case"edit":a.viewmode=!1,ne(a,a.page,null,!0);break;case"view":a.viewmode=!0,ne(a,a.page,null,!0);break;case"toggleEdit":a.viewmode=1 in t&&"boolean"==typeof t[1]?t[1]:!a.viewmode,ne(a,a.page,null,!0);break;case"monitor":"function"==typeof t[2]&&(a.monitor[t[1]]=[t[2]],re(a,t[1],{required:!1,disabled:!1}));break;case"diff":ye(a,t[1])}else Oe(a,t[0])})},e.fn.hzForm.defaults={form:"default",controller:"index",endpoint:"interact",encode:!0,singlePage:!1,cards:!1,horizontal:!1,viewmode:!1,hz:{left:3,right:9},placeholder:"Please select...",loaderClass:"forms-loader",validateNav:!0,lookup:{delay:300,startlen:0,autocomplete:!1},concurrentUploads:2,styleClasses:{container:"forms-container",page:"form-page",group:"form-group",label:"control-label",input:"form-control",inputGroup:"input-group",inputGroupPrepend:"input-group-prepend",inputGroupText:"input-group-text",inputGroupAppend:"input-group-append",chkDiv:"custom-control custom-checkbox",chkInput:"custom-control-input",chkLabel:"custom-control-label",button:"btn",buttonGroup:"btn-group"},endpoints:{},icons:hzIcons}}(jQuery),$.fn.fileUpload=function(){let e=this.get(0);if(e.options){switch(arguments[0]){case"add":e._add(arguments[1]);break;case"remove":e._remove(arguments[1]);break;case"list":return e.files}return this}return e.files=[],e.options=$.extend({name:"file",multiple:!1,btnClass:"btn btn-default",maxSize:0,autoAdd:!0,autoRemove:!0},arguments[0]),e._isIE=function(){return!!navigator.userAgent.match(/Trident/g)||!!navigator.userAgent.match(/MSIE/g)},e._add=function(t){if(Array.isArray(t)){if(!0===e.options.multiple)for(let e in t)this._add(t[e])}else"object"!=typeof t&&(t={name:t,type:"text/text"}),"lastModifiedDate"in t||(t.lastModifiedDate=new Date(1e3*t.lastModified)),e.files.push(t),e.o.dzwords&&e.o.dzwords.hide(),e.o.list.append($('<div class="dz-item">').html([e._preview(t),$('<div class="dz-size">').html(humanFileSize(t.size)),$('<div class="dz-detail">').html($("<a>").attr("href",t.url).attr("target","_blank").html(t.name).attr("title",t.name)),$('<div class="dz-remove">').html(_hz_icon("times")).click(function(n){let a=$(this).parent()
;"function"==typeof e.options.remove&&e.options.remove(t),e.options.autoRemove&&e._remove(a.data("file")),n.stopPropagation()})]).data("file",t).click(function(e){e.stopPropagation()}))},e._remove=function(t){return this.files=this.files.filter(function(e){return e.name!==t.name}),e.o.list.children().each(function(e,n){let a=$(n),i=a.data("file");i&&i.name===t.name&&a.remove()}),0===this.files.length&&this.o.dzwords&&this.o.dzwords.show(),!0},e._preview=function(e){let t=$('<div class="dz-preview">');if(e.preview)t.append($("<img>").attr("src",e.preview));else if("string"==typeof e.type)if("image"===e.type.substr(0,5)){if(e.url)t.append($("<img>").attr("src",e.url));else if(e instanceof File&&"image"===e.type.substr(0,5)){let n=new FileReader;n.onload=function(e){t.append($("<img>").attr("src",e.target.result))},n.readAsDataURL(e)}}else t.addClass("fileicon").attr("data-type",e.type.replace(/\./g,"_").replace(/\//g,"-"));return t},e._checkexists=function(t){for(let n in e.files)if(e.files[n].name===t.name)return!0;return!1},e._checksize=function(t){return 0===e.options.maxSize||t.size<e.options.maxSize},e._add_files=function(t){let n=[],a=[];if(e.options.multiple||!(e.files.length>0)){for(let i=0;i<t.length;i++){let l=t[i];if(e._checkexists(l))return;e._checksize(l)?(e.options.autoAdd&&e._add(l),n.push(l)):a.push(l)}if(e.o.input.val(null),n.length>0&&"function"==typeof e.options.select&&e.options.select(n),a.length>0){let t=$("<p>");for(let e in a)t.append($("<strong>").html(a[e].name));$("<div>").html([$("<p>").html("Failed to attach the following files:"),t,$("<p>").html("Files were too big as the maximum allowed file size is "+humanFileSize(e.options.maxSize)+".")]).popup({title:"Bad Attachment",icon:"danger",buttons:[{label:"OK",class:"btn btn-danger"}]})}}},e._registerEvents=function(){this.o.dropzone&&(this.o.dropzone.click(function(t){!e.options.multiple&&e.files.length>0||e.o.input.click()}),this.o.dropzone.on("dragenter",function(e){e.preventDefault(),e.stopPropagation()}),this.o.dropzone.on("dragover",function(t){e.o.dropzone.addClass("drag"),t.preventDefault(),t.stopPropagation()}),this.o.dropzone.on("dragleave",function(t){t.preventDefault(),t.stopPropagation(),e.o.dropzone.removeClass("drag")}),this.o.dropzone.on("drop",function(t){t.preventDefault(),t.stopPropagation(),e.o.dropzone.removeClass("drag"),!e.options.multiple&&e.files.length>0||e._add_files(t.originalEvent.dataTransfer.files)})),e._isIE()&&e.o.input.click(function(){setTimeout(function(){e.o.input.val().length>0&&e.o.input.change()},0)}),this.o.input.change(function(t){!e.options.multiple&&e.files.length>0||e._add_files(t.target.files)}),this.options.multiple||this.o.dzwords.click(function(){e.o.input.click()})},e._render=function(e){$(this).addClass("form-fileupload"),this.o={},this.o.input=$('<input type="file" class="form-control">').appendTo(e),e.options.accept&&this.o.input.attr("accept",e.options.accept),this.o.list=$('<div class="dz-items">'),e.options.multiple?(this.o.input.prop("multiple",!0),e.o.dzwords=$('<div class="form-dropzone-words">').html("Drop files here or click to upload."),this.o.dropzone=$('<div class="form-dropzone">').html([this.o.dzwords,this.o.list]).appendTo($(e).addClass("multiple")).toggleClass("single",!e.options.multiple),e.options.height&&this.o.dropzone.height(e.options.height)):(e.o.dzwords=$("<button>").addClass(e.options.btnClass).html(e.options.btnLabel).appendTo($(e)),this.o.list.appendTo($(e).addClass("single")))},e._render(e),e._registerEvents(),this},Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null===this)throw new TypeError('"this" is null or not defined');let t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");let a=arguments[1],i=0;for(;i<n;){let n=t[i];if(e.call(a,n,i,t))return n;i++}},configurable:!0,writable:!0}),Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(e){if(null===this)throw new TypeError('"this" is null or not defined');let t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");let a=arguments[1],i=0;for(;i<n;){let n=t[i];if(e.call(a,n,i,t))return i;i++}return-1},configurable:!0,writable:!0});