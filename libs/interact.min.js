function _hz_icon(e,t,n){if(n||(n=hzIcons),!(e in n))return null;let a=n[e],i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("class","forms-icon"),i.setAttribute("viewBox","0 0 "+a[0]+" "+a[1]);let l=document.createElementNS("http://www.w3.org/2000/svg","path");return l.setAttribute("fill","currentColor"),l.setAttribute("d",a[2]),i.appendChild(l),t&&i.setAttribute("title",t),$(i)}var ud=void 0;"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){"use strict";if(null===e)throw new TypeError("Cannot convert undefined or null to object");let n=Object(e);for(let e=1;e<arguments.length;e++){let t=arguments[e];if(null!==t)for(let e in t)Object.prototype.hasOwnProperty.call(t,e)&&(n[e]=t[e])}return n},writable:!0,configurable:!0});var hzIcons={"exclamation-circle":[512,512,"M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zm-248 50c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"],"question-circle":[512,512,"M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zM262.655 90c-54.497 0-89.255 22.957-116.549 63.758-3.536 5.286-2.353 12.415 2.715 16.258l34.699 26.31c5.205 3.947 12.621 3.008 16.665-2.122 17.864-22.658 30.113-35.797 57.303-35.797 20.429 0 45.698 13.148 45.698 32.958 0 14.976-12.363 22.667-32.534 33.976C247.128 238.528 216 254.941 216 296v4c0 6.627 5.373 12 12 12h56c6.627 0 12-5.373 12-12v-1.333c0-28.462 83.186-29.647 83.186-106.667 0-58.002-60.165-102-116.531-102zM256 338c-25.365 0-46 20.635-46 46 0 25.364 20.635 46 46 46s46-20.636 46-46c0-25.365-20.635-46-46-46z"],times:[352,512,"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"],minus:[448,512,"M416 208H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h384c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"],plus:[448,512,"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"],calendar:[448,512,"M12 192h424c6.6 0 12 5.4 12 12v260c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V204c0-6.6 5.4-12 12-12zm436-44v-36c0-26.5-21.5-48-48-48h-48V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H160V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H48C21.5 64 0 85.5 0 112v36c0 6.6 5.4 12 12 12h424c6.6 0 12-5.4 12-12z"],search:[512,512,"M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"],"check-square":[448,512,"M400 480H48c-26.51 0-48-21.49-48-48V80c0-26.51 21.49-48 48-48h352c26.51 0 48 21.49 48 48v352c0 26.51-21.49 48-48 48zm-204.686-98.059l184-184c6.248-6.248 6.248-16.379 0-22.627l-22.627-22.627c-6.248-6.248-16.379-6.249-22.628 0L184 302.745l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628 0l-22.627 22.627c-6.248 6.248-6.248 16.379 0 22.627l104 104c6.249 6.25 16.379 6.25 22.628.001z"]};Array.fromObject=function(e){if("object"!=typeof e)return null;let t=[];for(let n in e)t.push(e[n]);return t},String.prototype.hash=function(){let e,t,n=0;if(0===this.length)return n;for(e=0;e<this.length;e++)t=this.charCodeAt(e),n=(n<<5)-n+t,n|=0;return n},Date.getLocalDateFormat=function(){let e=[],t=[],n="/",a=null,i=new Date(2001,4,9).toLocaleDateString();if(!1!==(a=i.match(/\W/))&&(n=a[0]),t=i.split(n),2001===parseInt(t[0]))e=["yyyy","mm","dd"],n="-";else for(let n in t){let a=!1,i=parseInt(t[n]);"0"===t[n][0]&&(a=!0),9===i?e.push(a?"dd":"d"):5===i?e.push(a?"mm":"m"):1===i?e.push("yy"):2001===i&&e.push("yyyy")}return e.join(n)},dataBinder.prototype._commit=dataBinderArray.prototype._commit=function(e){this._default={};for(let t in e){let n=e[t];n instanceof dataBinder||n instanceof dataBinderArray?n=e[t].commit():n instanceof dataBinderValue&&(n=n.save()),this._default[t]=n}return this._default},dataBinder.prototype.commit=function(){return this._commit(this._attributes)},dataBinderArray.prototype.commit=function(){return this._commit(this._elements)},dataBinder.prototype.reset=function(){if(!this._default)return!1;for(let e in this._attributes)e in this._default||this.remove(e);for(let e in this._default)this._attributes[e]instanceof dataBinder||this._attributes[e]instanceof dataBinderArray?this._attributes[e].reset():this[e]=this._default[e];return!0},dataBinderArray.prototype.reset=function(){if(!this._default)return!1;this._elements=[];for(let e in this._default)this._elements[e]=this.__convert_type(e,this._default[e]);return this.resync(),!0},dataBinder.prototype.diff=function(e,t){if(null!==e&&"object"==typeof e){e instanceof dataBinder||(e=new dataBinder(e,null,null,"form-differential-analysis"));for(let n in this._attributes){let a=n in e?e[n].value:null;this._attributes[n]instanceof dataBinder||this._attributes[n]instanceof dataBinderArray?this._attributes[n].diff(a,t):this._attributes[n]instanceof dataBinderValue&&this._attributes[n].value!==a&&t(this._attributes[n],a)}}},dataBinderArray.prototype.diff=function(e,t){if(e&&"object"==typeof e)for(let n in this._elements)n in e||(e[n]=null),this._elements[n]instanceof dataBinder&&this._elements[n].diff(e[n],t)},function(e){function t(t){"string"==typeof t?t={str:t}:t instanceof Error?t={status:"JavaScript Error",str:t.message,line:t.lineNumber,file:t.fileName}:"done"in t&&("responseJSON"in t||(t.responseJSON=JSON.parse(t.responseText)),t=t.responseJSON.error),e("<div>").css("text-align","left").html([e("<h4>").html(t.status),e("<div>").html(t.str).css({"font-weight":"bold","margin-bottom":"15px"}),t.line?e("<div>").html("Line: "+t.line):null,t.file?e("<div>").html("File: "+t.file):null]).popup({title:"An error ocurred!",icon:"danger",buttons:[{label:"OK",class:"btn btn-default"}]})}function n(){return"yxxx-yxxx-yxxx".replace(/[xy]/g,function(e){let t=16*Math.random()|0,n="x"===e?t:3&t|8;return n.toString(16)})}function a(e,t){return t.split(".").reduce(function(e,t){return e[t]},e)}function i(e){return null!==e&&"object"==typeof e&&!Array.isArray(e)}function l(e){return!i(e)&&(e=e.toString().trim().toLowerCase(),"t"===e||"true"===e||"on"===e||"yes"===e||"y"===e||"ok"===e?"true":RegExp("/^(!|not)s*null$/").test(e)?"true":1===parseInt(e)?"true":"false")}function r(e){return"true"===l(e)}function s(t,n){let a=t.get(0),i=document.createElement("INPUT");i.style.position="absolute",i.style.left=-999,document.body.appendChild(i),i.setAttribute("value",a.value),i.select(),document.execCommand("copy"),i.parentNode.removeChild(i);let l=e(n).tooltip({title:"Copied!",trigger:"manual"}).tooltip("show");setTimeout(function(){l.tooltip("dispose")},3e3)}function o(e,t,n){return _hz_icon(t,n,e.settings.icons)}function d(e,t){if(!("type"in e))return t;let n=e.type.toLowerCase();return"array"===n&&"arrayOf"in e&&(n=e.arrayOf.toLowerCase()),"string"==typeof t&&""===t?null:("int"===n||"integer"===n?t=parseInt(t):"text"===n||"string"===n?t=t.toString().trim():"bool"===n||"boolean"===n?t=r(t):"float"!==n&&"number"!==n&&"double"!==n&&"money"!==n||(t=parseFloat(t.replace(/\,/g,""))),t)}function u(e,t){return t=g(e,t,null,!0),t.match(/^https?:\/\//)?t:hazaar.url(t)}function f(e,t,n,a){if(!Array.isArray(e))return console.warn("Attempting to sort object.  Sorting is only supported by arrays."),e;if("string"==typeof t)e.sort(function(e,n){return e[t]<n[t]?-1:e[t]>n[t]?1:0});else if(Array.isArray(t)){let i=[];for(let a in t){let l=e.findIndex(function(e,i,l){return e[n]===t[a]});-1!==l&&(i.push(e[l]),e.splice(l,1))}if(e.length>0&&a){let e={};e[a]="__spacer__",e[n]=Array(10).join("&#x2500;"),i.push(e)}e=i.concat(f(e,n))}return e}function c(e,t,n,a,l){if("options"in a&&i(a.options)&&"in"in a.options&&(e=b(e,a.options.in)),null===e||"object"!=typeof e||Array.isArray(e)&&0===e.length||0===Object.keys(e).length)return null;if(!Array.isArray(e)&&"string"!=typeof e[Object.keys(e)[0]]){let i=[];a.options={data:e,group:{key:"group",data:{}}};for(let l in e){a.options.group.data[l]=l;for(let r in e[l])i.push({[t]:d(a,r),[n]:e[l][r],group:l})}e=i}let r="options"in a&&i(a.options)&&"group"in a.options&&"key"in a.options.group?a.options.group:null,s=r?{}:[];for(let o in e){let u={};if(e[o]&&i(e[o])?u=e[o]:(u[t]=d(a,o),u[n]=e[o]),r){let e=r.data&&u[r.key]in r.data?r.data[u[r.key]]:u[r.key];e in s||(s[e]=[]),s[e].push(u)}else s.push(u);i(l)&&(l[u[t]]=u[n])}return s}function p(e,t,n,a,i){let l="";if("string"==typeof e.eval_cache)l=e.eval_cache;else{let t=e.data.save(!0),n=Object.keys(t).sort();for(let e in n){let a=n[e];if("form"===a)continue;let i=t[a];"string"==typeof i?i='"'+i.replace(/"/g,'\\"').replace("\n","\\n")+'"':("object"==typeof i||Array.isArray(i))&&(i=JSON.stringify(i)),l+="let "+a+" = "+i+";\n"}!0===e.eval_cache&&(e.eval_cache=l)}n&&(l+="let value = "+JSON.stringify(n.save(!0))+";\n",l+="let item = "+JSON.stringify(n.parent.save(!0))+";\n"),l+=!0===i?"return ( "+t.replace(/[\;\s]+$/,"")+" );":t;try{let i=e.parent?e.parent:e;return new Function("form","tags","formValue","formItem","key",l).call(this,i.data,i.tags,n||null,n?n.parent:null,a)}catch(e){console.error("Failed to evaluate condition: "+t),console.error(e)}return!1}function h(e,t,n,a,i){return"boolean"==typeof t?t:void 0===t?void 0!==n&&n:p(e,t,a,i,!0)}function m(e,t){if("object"==typeof t&&!t.protected&&!t.keep)if("string"==typeof t.name){let n=b(e.data,t.name);n instanceof dataBinderValue?n.set(t.default||null,t.placeholder||null):n instanceof dataBinder&&n.empty()}else if("fields"in t)for(let n in t.fields){let a=t.fields[n];if(a instanceof Array)m(e,{fields:a});else if("string"==typeof a){let n=b(e.data,a);n instanceof dataBinderValue&&n.set(t.default||null,t.placeholder||null)}}}function g(e,t,n,a,i){if("string"!=typeof t)return t;let l=e&&e.parent?e.parent:e;for(;null!==(match=t.match(/\{\{([\W]*)([\w\.]+)\}\}/));){let e=match[1].split(""),d=l?b(l.data,match[2]):null;if(null===d&&(d="this."===match[2].substr(0,5)?b(l.settings,match[2].substr(5)):n?b(n,match[2]):null),-1===e.indexOf("!")&&null===(d instanceof dataBinderValue?d.value:d)&&!0!==a)return!1;-1!==e.indexOf(">")&&(i=!1);let u=function(e){return Array.isArray(e)?(e.filter(u),e.length>0):null!==e},f=(r=d,s=e,o=i,r instanceof dataBinder?JSON.stringify(r.save(!0)):r instanceof dataBinderArray?JSON.stringify(r.save(!0).filter(u)):r instanceof dataBinderValue?!0===o&&-1===s.indexOf(":")?r:r.value:r),c=i?'<span data-bind="'+match[2]+'" data-bind-label="'+(-1===e.indexOf(":")?"true":"false")+'">'+f+"</span>":f||"";t=t.replace(match[0],c)}var r,s,o;return t}function b(e,t,n,a){if(t instanceof dataBinder||t instanceof dataBinderArray||t instanceof dataBinderValue)return t;if("string"!=typeof t||!i(e))return null;let l=t.split(/[\.\[]/),r=e;for(let e in l){let t=l[e];if("]"===l[e].slice(-1)&&(t=parseInt(t.slice(0,-1))),!(t in r)){if(void 0===a)return null;r[t]=parseInt(e)+1<l.length?{}:a}!0===n&&r[t]instanceof dataBinderValue&&(r[t]=[]),r=r[t]}return r}function y(e,t,n){if("required"in t)return"boolean"!=typeof t.required&&e.events.required.push(n),v(e,n,!1)}function v(t,n,a){let i=n.data("def");if(!i)return!1;let l=n.children("label.control-label"),r=l.children("svg.form-required"),s=b(t.data,n.data("item")),d=t.required[s.attrName]=h(t,i.required,void 0!==a&&a,s,i.name);return!0!==d?r.remove():0===r.length&&l.append(o(t,"exclamation-circle","Required").addClass("form-required")),"fields"in i&&n.children("div.form-section,div.form-group").each(function(n,a){let i=e(a);i.data("item")&&v(t,i,d)}),d}function w(e,t,n,a){if("disabled"in t&&!0!==t.protected)return"function"==typeof a&&n.data("disabled_func",a),"string"==typeof t.disabled&&e.events.disabled.push(n),k(e,n,a)}function k(t,n,a){let i=n.data("def");if(!i)return!1;let l=b(t.data,n.data("item")),r=t.disabled[l.attrName]=h(t,i.disabled,void 0!==a&&a,l,i.name);return n.find("input,textarea,select,button").prop("disabled",r).data("ed",r),"fields"in i&&n.children("div.form-section,div.form-group").each(function(n,a){let i=e(a);i.data("item")&&k(t,i,r)}),r}function C(e,t,n){n.data("show",t.show),"boolean"!=typeof t.show&&e.events.show.push(n),x(e,n)}function x(e,t){let n=t.data("def");if(!n)return!1;e.working=!0;let a=b(e.data,t.data("item")),i=h(e,t.data("show"),!0,a,n?n.name:null);t.toggle(i),i||m(e,n),e.working=!1}function _(t,n){let a=n.data("def"),i=n.attr("data-bind"),l=b(t.data,i);if(!l)return!1;if(n.is("[type=checkbox]")){let e=n.is(":checked");l.set(e,e?"Yes":"No")}else if(n.is("select")){let i=n.val();if("__hz_other"===i){l&&null!==l.value&&l.set(null,null,l.other);let i=e("<div>").addClass(t.settings.styleClasses.inputGroup),r=e('<input type="text" placeholder="Enter other option...">').addClass(t.settings.styleClasses.input).data("def",a).val(l.other).attr("data-bind",n.attr("data-bind")).attr("data-bind-other",!0).change(function(n){return _(t,e(n.target))}).on("update",function(e,t,a){n.show(),i.remove()}).appendTo(i),s=e('<button class="btn btn-secondary" type="button">').html(o(t,"times")).click(function(e){i.remove(),l.other=null,n.val("").show()});"format"in a&&r.inputmask(a.format),e('<span class="input-group-btn">').addClass(t.settings.styleClasses.inputGroupAppend).html(s).appendTo(i),n.hide().after(i),r.focus()}else l.set(d(a,i))}else if("date"===a.type&&"format"in a){let e=n.datepicker("getDate");l.set(e?e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate():null,n.datepicker("getFormattedDate"))}else if(!0===a.other)l.other=n.val(),A(t,n,!1,l);else{let e=d(a,n.val());l instanceof dataBinder?l.populate(e):l.set(e)}return!1!==l.enabled()&&(e(t).trigger("change",[l]),!1)}function A(e,n,a,l,r){let s=Q(e.def,"string"==typeof n?n:n.attr("data-bind"));if(!s)return;let o=s.update,d=null;if(l||(l=b(e.data,s.name)),e.eval_cache=!0,"string"==typeof o&&(o={url:o}),i(n)){if(l&&n.is("select")&&"__hz_other"!==n.val()){let e=n.children('option[value="'+l.value+'"]').data("other")||null;l.enabled(!1),l.set(l.value,n.children("option:selected").text(),e,!1),l.enabled(!0)}else l&&n.is('input[type="radio"]')&&!0===l.enabled()&&l.set(l.value,n.next().text());if(!0!==r&&("boolean"==typeof o||o&&("url"in o||!0===e.settings.update))){let a={originator:s.name,form:e.data.save()},i=function(e,t){let n=null;if("boolean"==typeof t)return t;if("object"!=typeof t)return!1;if("enabled"in t||(t.enabled=!0),"when"in t&&(t.enabled=h(e,t.when,!1,l,s.name)),t.enabled){if(!("url"in t))return!0;if(!1!==(n=g(e,t.url)))return a.api=n,!0}return!1};i(e,o)&&(d=function(){ye(e,"update",a,!1).done(function(t){t.ok&&(e.data.extend(t.updates),ie(e,n))}).fail(t)})}!0!==a&&ie(e,n)}if(l&&l.enabled()&&s.change&&p(e,s.change,l,s.name),!e.working){if(e.events.show&&e.events.show.length>0)for(let t in e.events.show)x(e,e.events.show[t]);ze(e,e.def.pages)}if(e.events.required&&e.events.required.length>0)for(let t in e.events.required)v(e,e.events.required[t],!1);if(e.events.disabled&&e.events.disabled.length>0)for(let t in e.events.disabled)k(e,e.events.disabled[t]);"save"in s&&h(e,s.save,!1,l,s.name)?he(e,!1).done(d):"function"==typeof d&&d(),l&&l.parent&&l.parent.attrName&&A(e,l.parent.attrName,a,l.parent)}function z(e,t){let n=t.data("def"),a=b(e.data,t.attr("data-bind"));n.focus&&p(e,n.focus,a,n.name)}function O(e,t){let n=t.data("def"),a=b(e.data,t.attr("data-bind"));n.blur&&p(e,n.blur,a,n.name)}function j(t,n){if("buttons"in n){let a=e("<div>").addClass(t.settings.styleClasses.buttonGroup),i=Object.assign({},n);delete i.buttons;for(let l in n.buttons)a.append(j(t,e.extend({},i,n.buttons[l])));return a}let a=e('<button type="button">').addClass(t.settings.styleClasses.button).addClass(n.class||"btn-default").data("def",n);switch("label"in n||(n.label="Button"),a.html(g(t,n.label,null,!0,!0)),n.action){case"update":a.click(function(){A(t,a)});break;case"link":a.click(function(){document.location=u(t,n.url)});break;default:let e=n.action?n.action:n.change?n.change:n.click;a.click(function(){p.call(this,t,e,null,n.name)})}return n.nolabel=!0,a}function T(t,a,i){let l=i.empty().data("def"),r=b(t.data,l.name),s={},u=l.options.value||"value",p=l.options.label||"label";if(a=c(a,u,p,l,s),null===a||Array.isArray(a)&&0===a.length)return r.empty(),r.enabled(!1),A(t,l.name,!0),i.parent().hide();let m=r.save(!0);if(m){let e=m.filter(function(e){return!(e in s)});for(let t in e)r.remove(e[t])}let g=function(){let n=e(this.childNodes[0]).data("def"),a=d(n,this.childNodes[0].value),i=b(t.data,n.name),l=i.indexOf(a);this.childNodes[0].checked?-1===l&&i.push({__hz_value:a,__hz_label:this.childNodes[1].textContent}):i.unset(l)},y=b(t.data,l.name,!0),v=!0===l.protected||h(t,l.disabled,!1,r,l.name);if("sort"in l.options&&("boolean"==typeof l.options.sort&&(l.options.sort=p),a=f(a,l.options.sort,p)),!0===l.buttons){let t=l.class||"primary",n=[];for(let i in a){let s=d(l,a[i][u]),o=a[i][p],f=r.indexOf(s)>-1,c=l.name+"_"+s;n.push(e('<label class="btn">').addClass("btn-"+t).html([e('<input type="checkbox" autocomplete="off">').attr("name",c).attr("value",s).prop("checked",f).toggleClass("active",f).prop("disabled",v).attr("data-bind-value",s).data("def",l),e("<span>").html(o)]).toggleClass("active",f).change(g))}return i.addClass("btn-group").addClass("btn-group-toggle").attr("role","group").attr("aria-label",l.label).html(n).parent().show()}"columns"in l||(l.columns=1),l.columns>6&&(l.columns=6);let w=function(a,i){let r=Math.floor(12/l.columns),s=Math.ceil(Object.keys(a).length/l.columns),o=e('<div class="row">').appendTo(i),f=0,c=[];for(let t=0;t<l.columns;t++)c.push(e("<div>").addClass("col-md-"+r).toggleClass("custom-controls-stacked",l.inline));for(let i in a){if("filter"in l.options&&-1===l.options.filter.indexOf(a[i][p])){delete a[i];continue}let r=d(l,a[i][u]),o=a[i][p],h=n(),m=y instanceof dataBinderArray&&y.indexOf(r)>-1,b=(l.name,e("<div>").addClass(t.settings.styleClasses.chkDiv).html([e('<input type="checkbox">').addClass(t.settings.styleClasses.chkInput).attr("id",h).attr("value",r).prop("checked",m).prop("disabled",v).data("def",l),e("<label>").addClass(t.settings.styleClasses.chkLabel).html(o).attr("for",h)]).attr("data-bind-value",r).change(g));"css"in l&&b.css(l.css),c[f].append(b),c[f].children().length>=s&&f++}o.html(c)};if(Array.isArray(a))w(a,i);else for(let n in a)w(a[n],e('<div class="mb-1">').html(e('<label class="group-label">').html([e('<strong class="mr-1">').html(n),!0===l.selectAll?o(t,"check-square").addClass("text-primary").click(function(){let t=e(this).parent().parent().find("input[type=checkbox]"),n=t.length===t.filter(":checked").length;return t.each(function(t,a){e(a).is(":checked")===n&&e(a).click()}),!1}):""])).appendTo(i));return r.enabled(!0),A(t,l.name,!0),i.parent().show()}function B(n,a,i,l){let r=e.extend(!0,{},a);if(!1===(r.url=g(n,r.url,{site_url:hazaar.url()})))return T(n,null,i);if(!0===l&&ce(n),r.url=u(n,r.url),"data"in r)for(let e in r.data)r.data[e]=g(n,r.data[e]);return e.ajax(r).done(function(e){if("object"!=typeof i.data("def"))return pe(n);T(n,e,i),pe(n)}).fail(t),!0}function N(e,t,n,a){if(!t)return!1;if(i(t)&&"url"in t){let i=t.url.match(/\{\{[\w\.]+\}\}/g),l=n.data("def");if(null!==i)for(let a in i){let r=i[a].substr(2,i[a].length-4);r in l.watchers||(l.watchers[r]=[]),l.watchers[r].push(e.data.watch(r,function(n,a,i){!1!==a.enabled()&&B(e,t,i,!1)},n))}return B(e,t,n,a)}if(t instanceof dataBinderValue){let a=i(t.value)?t.value:i(t.other)?t.other:null;return T(e,a,n)}return T(e,"data"in t?t.data:t,n),!0}function q(t,n){let a=e("<div>").data("def",n),i=b(t.data,n.name);return!0===n.selectAll&&(n.label=[e('<span class="mr-1">').html(n.label),o(t,"check-square").addClass("text-primary").click(function(){let t=e(this).parent().parent().find("input[type=checkbox]"),n=t.length===t.filter(":checked").length;return t.each(function(t,a){e(a).is(":checked")===n&&e(a).click()}),!1})]),!0===n.buttons?a.addClass("btn-group").attr("data-bind",n.name).attr("data-toggle","buttons").toggleClass("btn-group-justified",!0===n.justified):a.attr("data-bind",n.name).attr("data-toggle","checks"),n.watchers={},"string"==typeof n.options&&(n.options={url:n.options}),F(t,n,a,null,function(e,n){N(t,n,e,!0)}),a.on("pop",function(e,t,n){a.find('div[data-bind-value="'+n.value+'"]').children("input[type=checkbox]").prop("checked",!1)}),i&&i.watch(function(e){if(e){let t=a.find('[data-bind-value="'+e.value+'"]');t.is("input")?(e.label||(e.label=t.parent().children("span").html()),t.prop("checked",!0).parent().addClass("active")):t.is("div")&&(e.label||(e.label=t.children("label").html()),t.children("input[type=checkbox]").prop("checked",!0))}return A(t,a,!1,e)}),a}function S(t,a,i,l,r){let s=l.data("def"),o=a.value||"value",d=a.label||"label";i=c(i,o,d,s);for(let r in i){if("filter"in a&&-1===a.filter.indexOf(i[r][d])||"__spacer__"===i[r][o]){delete i[r];continue}let u=n(),f=e('<input type="radio" class="custom-control-input">').attr("id",u).attr("name",s.name).attr("value",i[r][o]).attr("data-bind",s.name).data("def",s),c=e('<div class="custom-control custom-radio">').html([f,e('<label class="custom-control-label">').attr("for",u).html(d.indexOf("{{")>-1?g(null,d,i[r],!0):i[r][d])]).appendTo(l);!0===s.horizontal&&c.addClass("custom-control-inline"),f.change(function(n){return _(t,e(n.target))}).on("update",function(n,a,i,l){return A(t,e(n.target),!1,l)})}return l}function D(t,n,a,i,l){let r=b(t.data,i.attr("data-bind")),s=i.data("def"),o=n.value||"value",u=n.label||"label";if(i.prop("disabled",!(!0!==s.disabled&&!0!==s.protected&&!0!==i.data("ed"))).empty(),a=c(a,o,u,s),!a)return!0!==l&&m(t,s),r&&r.enabled(!1),A(t,s.name,!0),i.empty().prop("disabled",!0);!0!==s.notnull&&i.append(e("<option>").attr("value","").html(g(t,s.placeholder,null,!0,!0)));let p=function(t,a,i){"sort"in n&&("boolean"==typeof n.sort&&(n.sort=u),t=f(t,n.sort,u,o));let l=r&&null===r.value&&"default"in n?n.default:null;for(let s in t){if("filter"in n&&-1===n.filter.indexOf(t[s][u])){delete t[s];continue}let d=e("<option>").attr("value",t[s][o]).html(u.indexOf("{{")>-1?g(null,u,t[s],!0):t[s][u]).appendTo(a);"__spacer__"===t[s][o]&&d.prop("disabled",!0).addClass("form-select-spacer"),"other"in n&&"string"==typeof n.other&&d.data("other",n.other.indexOf("{{")>-1?g(null,n.other,t[s],!0):t[s][n.other]),null!==l&&t[s][u]===l&&r.set(t[s][o],t[s][u],t[s][n.other]),!0===i.notnull&&null===r.value&&r.set(t[s][o],t[s][u])}return t};if(!Array.isArray(a)&&Array.isArray(a[Object.keys(a)[0]]))for(let t in a)a[t]=p(a[t],e("<optgroup>").attr("label",t).appendTo(i),s);else a=p(a,i,s);if(r){"other"in s&&!0===h(t,s.other,null,r,s.name)&&(i.append(e("<option>").attr("value","__hz_other").html("Other")),null===r.value&&null!==r.other&&i.val("__hz_other").change());let l=null!==r.value?r.value.toString():null,f=function(e,t,n){return Array.isArray(e)?e.find(f):e&&e[o].toString()===l};if(Array.isArray(a)||(a=Array.fromObject(a)),l&&a.find(f))i.val(l),A(t,i,!1,null,!0);else if(r.value=null,1===Object.keys(a).length&&!0===n.single){let e=a[Object.keys(a)[0]],t=d(s,e[o]);r.value!==t&&(r.set(t,u.indexOf("{{")>-1?g(null,u,e,!0):e[u]),"other"in n&&n.other in e&&(r.other=e[n.other]))}r.enabled(!0)}return i}function L(n,a,i,l,r,s){let o=e.extend(!0,{},a);if(!1===(o.url=g(n,o.url,r)))return s(n,a,null,i);if(!1!==l&&i.prop("disabled",!0).html(e("<option value selected>").html("Loading...")),o.url=u(n,o.url),"data"in o)for(let e in o.data)o.data[e]=g(n,o.data[e]);return e.ajax(o).done(function(e){"object"==typeof i.data("def")&&s(n,a,e,i)}).fail(t)}function $(e,t,n,a,l,r){if("string"==typeof t){let i=t.match(/^\{\{([\w\.]+)\}\}$/);null!==i?(e.data.watch(i[1],function(t,n,i){$(e,n,i,a,l)},n),t=b(e.data,i[1])):t={url:t}}if("function"!=typeof r&&(r=D),t instanceof dataBinderValue){let a=i(t.value)?t.value:i(t.other)?t.other:null;return r(e,{},a,n,!a)}if(!(i(t)&&"url"in t))return r(e,t,"data"in t?t.data:t,n);let s=t.url.match(/\{\{[\w\.]+\}\}/g),o=n.data("def");for(let a in s){let i=s[a].substr(2,s[a].length-4);i in o.watchers||(o.watchers[i]=[]),void 0===l&&(l=e.data),o.watchers[i].push(l.watch(i,function(n,a,i){!1!==a.enabled()&&L(e,t,i,!0,a,r)},n))}return L(e,t,n,a,l,r)}function F(e,t,n,a,l){if(!("options"in t))return!1;let r={};if(Array.isArray(t.options)){for(let n in t.options)if(i(t.options[n])&&"when"in t.options[n]&&h(e,t.options[n].when,null,a,t.name)){r="items"in t.options[n]?t.options[n].items:t.options[n];break}if(n&&"watch"in t){let i=function(i,r,s){b(a,t.name).value=null,"function"==typeof l&&l(n,F(e,t,null,r))};for(let n in t.watch)"item."===t.watch[n].substr(0,5)&&a?a.watch(t.watch[n].substr(5),i):(a=e.data,e.data.watch(t.watch[n],i))}}else r=t.options;return"function"==typeof l&&l(n,r),r}function E(t,n,a){if(!0===n.radios){let i=e("<div>").addClass(t.settings.styleClasses.group).data("def",n);return!1!==a&&F(t,n,i,ud,function(e,n){$(t,n,e,ud,ud,S)}),i}let i=e('<div class="input-group">'),l=e("<select>").addClass(t.settings.styleClasses.input).attr("name",n.name).data("def",n).attr("data-bind",n.name).appendTo(i);return n.protected?l.prop("disabled",!0):l.focus(function(n){return z(t,e(n.target))}).blur(function(n){return O(t,e(n.target))}).change(function(n){return _(t,e(n.target))}).on("update",function(n,a,i,l){return A(t,e(n.target),!1,l)}),n.watchers={},"placeholder"in n||(n.placeholder=t.settings.placeholder),!1!==a&&F(t,n,l,null,function(e,n){$(t,n,e)}),i}function I(t,a){let i=b(t.data,a.name),l=e("<div>").addClass(t.settings.styleClasses.chkDiv),r=n(),s=e('<input type="checkbox">').addClass(t.settings.styleClasses.chkInput).attr("name",a.name).attr("id",r).attr("data-bind",a.name).attr("checked",!!i&&i.value).data("def",a).appendTo(l);return a.protected?s.prop("disabled",!0):s.focus(function(n){return z(t,e(n.target))}).blur(function(n){return O(t,e(n.target))}).change(function(n){return _(t,e(n.target))}).on("update",function(n,a,i,l){return A(t,e(n.target),!1,l)}),e("<label>").addClass(t.settings.styleClasses.chkLabel).html(g(t,a.label,null,!0,!0)).attr("for",r).appendTo(l),a.nolabel=!0,l}function M(t,n){let a=b(t.data,n.name),i=e('<div class="date">').addClass(t.settings.styleClasses.inputGroup),l=e("<input>").addClass(t.settings.styleClasses.input).attr("type","datetime"===n.type?"datetime-local":"date").attr("name",n.name).attr("data-bind",n.name).data("def",n).val(a).appendTo(i);return n.protected?l.prop("disabled",!0):l.focus(function(n){return z(t,e(n.target))}).blur(function(n){return O(t,e(n.target))}).change(function(n){return _(t,e(n.target))}).on("update",function(n,a,i,l){return A(t,e(n.target),!1,l)}),!1!==n.suffix&&e("<div>").addClass(t.settings.styleClasses.inputGroupAppend).html(e('<span style="cursor: pointer;">').addClass(t.settings.styleClasses.inputGroupText).html(o(t,"calendar").click(function(){l.focus()}))).appendTo(i),n.format&&("local"===n.format&&(n.format=Date.getLocalDateFormat()),n.__datepicker_options=e.extend({format:n.format,autoclose:!0,forceParse:!0,language:"en",clearBtn:!("required"in n)||h(t,n.required,!1,a),todayHighlight:!0,updateViewDate:!0},n.dateOptions),l.attr("type","text").attr("data-bind-label","true").datepicker(n.__datepicker_options),a&&a.value&&(a.enabled(!1),l.datepicker("setDate",new Date(a.value)),a.enabled(!0)),n.placeholder||(n.placeholder=n.format)),n.placeholder&&l.attr("placeholder",n.placeholder),i}function P(n,a){let i=b(n.data,a.name),l=e("<div>").attr("data-bind",a.name).data("def",a).attr("name",a.name).fileUpload({name:a.name,multiple:a.multiple||!1,btnClass:a.btnClass||"btn btn-default",btnLabel:a.btnLabel||"Select",height:a.height||null,thumbnail:a.thumbnail||(a.multiple?120:32),accept:a.accept||null,maxSize:a.maxSize||n.settings.maxUploadSize||null,autoAdd:!1,autoRemove:!1,select:function(e){for(let t of e){let e=i.push(me(t),!0);if(n.standalone){let n=new FileReader;n.onload=function(t){i[e].url=t.target.result},n.readAsDataURL(t)}else n.deloads=n.deloads.filter(function(e){if(e.field!==a.name||e.file.name!==t.name)return e}),n.uploads.push({field:a.name,file:t})}A(n,l)},remove:function(e){return n.standalone&&(e=me(e),n.uploads=n.uploads.filter(function(t){if(t.field!==a.name||t.file.name!==e.name)return t}),n.deloads.push({field:a.name,file:e.name})),i.unset(i.indexOf(function(t){return t.name.value===e.name}),!0),A(n,l),!0}}).on("push",function(e,t,n){l.fileUpload("add",n.save())}).on("pop",function(e,t,n){l.fileUpload("remove",n.save())});if(n.standalone)for(let e of i)l.fileUpload("add",e.save());else ye(n,"fileinfo",{field:a.name},!0).done(function(e){if(!e.ok)return;let t=b(n.data,e.field);t.empty();for(let a in e.files)n.deloads.findIndex(function(t){return t.field===e.field&&t.file===e.files[a].name})<0&&t.push(me(e.files[a]));for(let a in n.uploads)n.uploads[a].field===e.field&&t.push(me(n.uploads[a].file))}).fail(t);return l}function G(t,n){let i=b(t.data,n.name),l=e("<div>").addClass(t.settings.styleClasses.inputGroup),r=e('<input type="text">').addClass(t.settings.styleClasses.input).attr("data-bind",n.name).attr("data-bind-label",!0).data("def",n).attr("autocomplete","off").appendTo(l);return n.protected?r.prop("disabled",!0):r.focus(function(n){z(t,e(n.target))}).on("blur",function(n){let a=e(this),l=a.parent().parent().children(".form-lookup-popup"),r=a.data("def");i=b(t.data,a.attr("data-bind")),i||(i=b(t.data,a.parent().parent().parent().parent().data("item").attrName)[a.next().attr("name")]),l.length>0?(l.css({opacity:"0"}),setTimeout(function(){l.hide().empty(),!0!==r.lookup.autocomplete&&a.val(i.label)},500)):!0!==r.lookup.autocomplete&&a.val(i.label)}),e('<input type="hidden">').attr("data-bind",n.name).attr("name",n.name).data("def",n).appendTo(l).on("update",function(n,a,i,l){A(t,e(n.target),!1,l)}),n.lookup&&"url"in n.lookup&&r.on("keyup",function(i){if(32===i.keyCode)return;let l=e(this),r=b(t.data,l.attr("data-bind"));if(""===i.target.value)return r.empty();if(!0===n.lookup.autocomplete&&r.set(l.val(),l.val()),i.keyCode>47)delay(function(){let r="",s=l.parent().parent().children(".form-lookup-popup"),o=b(t.data,l.attr("data-bind")),d=n.lookup.value||"value",f=n.lookup.label||"label";if(o||(o=b(t.data,l.parent().parent().parent().parent().data("item").attrName)[l.next().attr("name")]),0===s.length&&(s=e('<div class="form-lookup-popup card">').hide().appendTo(l.parent().parent()).on("click",function(t){let a=e(t.target),i=a.data("lookup");if(!a.is(".list-group-item")||"string"!=typeof a.attr("data-value"))return!1;o.set(a.attr("data-value"),a.text(),"other"in n.lookup&&n.lookup.other in i?i[n.lookup.other]:null),s.hide()})),"startlen"in n.lookup&&i.target.value.length<n.lookup.startlen)return s.hide();let p={__input__:i.target.value},h=s.children("ul");0===h.length&&(h=e('<ul class="list-group">').appendTo(s)),!1!==(url=g(t,n.lookup.url,p))&&("query"in n.lookup&&!1===(r=g(t,n.lookup.query,p))||(s.css({"min-width":l.parent().outerWidth(),opacity:"1"}),!0!==n.lookup.autocomplete&&h.html(e('<li class="list-group-item">').html("Loading results...")),h.children().length>0&&s.show(),e.ajax({method:n.lookup.method||"GET",url:u(t,url),data:r}).always(function(){!0!==n.lookup.autocomplete&&h.empty()}).done(function(t){if("dataKey"in n.lookup&&n.lookup.dataKey in t&&(t=Q(t,n.lookup.dataKey,!0)),t=c(t,d,f,n),
"extra"in n.lookup&&e.merge(t,n.lookup.extra),Object.keys(t).length>0){!0===n.lookup.autocomplete&&h.empty();for(let n in t)h.append(e('<li class="list-group-item">').html(f.indexOf("{{")>-1?g(null,f,t[n],!0):t[n][f]).attr("data-value",a(t[n],d)).data("lookup",t[n]));1===Object.keys(t).length?h.children().first().click():!0===n.lookup.autocomplete&&s.show()}else!0===n.lookup.autocomplete?(h.empty(),s.hide()):h.html(e('<li class="list-group-item">').html("No results..."))}).fail(function(t){h.html(e('<li class="list-group-item">').html("Error "+t.status+": "+t.statusText))})))},t.settings.lookup.delay);else{let e="bg-primary",t=l.parent().parent().children(".form-lookup-popup").children(".list-group"),n=t.children("."+e);switch(i.key){case"ArrowDown":n.length>0?n.next().length>0&&n.removeClass(e).next().addClass(e):t.children().first().addClass(e);break;case"ArrowUp":n.prev().length>0?n.removeClass(e).prev().addClass(e):n.addClass(e);break;case"Home":n.removeClass(e),t.children().first().addClass(e);break;case"End":n.removeClass(e),t.children().last().addClass(e);break;case"Enter":n.click();break;case"Escape":t.parent().hide().empty();break;case"Backspace":if(""!==l.val())break;case"Delete":r.empty()}i.preventDefault(),i.stopPropagation()}}),"placeholder"in n&&r.attr("placeholder",n.placeholder),n.protected||l.append(e("<div>").addClass(t.settings.styleClasses.inputGroupAppend).html(e("<span>").addClass(t.settings.styleClasses.inputGroupText).html(o(t,"search")))),l}function V(t,n){let a=b(t.data,n.name),i="$",l=e('<input type="text">').addClass(t.settings.styleClasses.input),r=e("<div>").addClass(t.settings.styleClasses.inputGroup),s=e("<div>").addClass(t.settings.styleClasses.inputGroupPrepend),o=e("<div>").addClass(t.settings.styleClasses.inputGroupAppend);if(l.attr("name",n.name).attr("data-bind",n.name+".amt").data("def",n).val(a.amt).inputmask("currency",{prefix:""}),"currencies"in n){let e=n.currencies.find(function(e,t,n){if(e.currencycode===a.currency.value)return!0});i=e.symbol}if(r.append([s.html(e("<span>").addClass(t.settings.styleClasses.inputGroupText).html(i)),l,o]),"currencies"in n&&n.currencies.length>1){let i=e('<div class="dropdown-menu">');n.currencies.sort(function(e,t){return e.code===t.code?0:e.code<t.code?-1:1});for(let t of n.currencies)i.append(e('<div class="dropdown-item">').html(t.code+" - "+t.name).attr("data-currency",t.code));o.html([e('<button class="btn btn-outline-secondary dropdown-toggle" type="button" data-toggle="dropdown">').html(a.currency.value),i]),i.on("click",function(n){let a=b(t.data,e(this).parent().parent().children("input").attr("data-bind"));if(!a)return!1;let i=e(n.target).attr("data-currency");e(this).parent().children("button").html(i),a.parent.currency=i}),a.watch("currency",function(e,t){let i=n.currencies.find(function(e,t,n){if(e.code===a.currency.value)return!0});s.children("span").html(i.symbol)})}else o.html(e("<span>").addClass(t.settings.styleClasses.inputGroupText).html(a.currency.value));return n.protected?l.prop("disabled",!0):l.focus(function(n){return z(t,e(n.target))}).blur(function(n){return O(t,e(n.target))}).change(function(n){return _(t,e(n.target))}).on("update",function(n,a,i,l){return A(t,e(n.target),!1,l)}),r}function U(t,n){let a,i=e('<div class="form-multi-text">'),l=b(t.data,n.name),r=function(t){let a=e(t.currentTarget.parentNode).children("span").text();l.remove(d(n,a))},s=function(e){let a=d(n,e.val().trim());!a||l.indexOf(a)>=0||!0!==re(t,f.name,l,f,n,a)||(l.push(a),e.val(""))},u=function(n){e('<div class="input-mt-item">').html([e("<span>").html(n.toString()),e('<div class="input-mt-item-rm">').html(o(t,"times","Remove")).click(function(e){r(e)})]).data("item",n).appendTo(a)},f=Object.assign({},n,{name:"__hz_input_mt_"+n.name,type:n.arrayOf});if("format"in n&&"validate"in n&&(delete f.validate.minlen,delete f.validate.maxlen),"hint"in n&&!0!==n.hint||(n.hint="Press ENTER to add item to list."),R(je(ud,t),n.arrayOf,f,!0).appendTo(i).on("keypress",function(t){13===t.which&&s(e(this))}).on("blur",function(t){let n=e(this);n.val().trim()&&s(n)}),a=e('<div class="input-mt-items">').attr("data-bind",n.name).appendTo(i).on("push",function(e,t,n){u(n)}).on("pop",function(t,n,a){e(this).children().each(function(t,n){e(n).data("item")===a&&e(n).remove()})}),l.length>0)for(let e of l)u(e);return i}function R(t,n,a,i){let l=null,r=b(t.data,a.name);if("int"!==n&&"integer"!==n||(n="number"),a.multiline?(l=e("<textarea>").addClass(t.settings.styleClasses.input),"height"in a&&l.css("height",a.height)):l=e("<input>").addClass(t.settings.styleClasses.input).attr("type",a.password?"password":n),l.attr("name",a.name).attr("data-bind",a.name).data("def",a).val(r instanceof dataBinderValue?r.value:r),a.protected?l.prop("disabled",!0):l.focus(function(n){return z(t,e(n.target))}).blur(function(n){return O(t,e(n.target))}).change(function(n){return _(t,e(n.target))}).on("update",function(n,a,i,l){return A(t,e(n.target),!1,l)}),"text"===n&&"validate"in a&&"maxlen"in a.validate&&l.attr("maxlength",a.validate.maxlen),"format"in a&&l.attr("type","text").inputmask(a.format),"placeholder"in a&&l.attr("placeholder",a.placeholder),!0===i)return l;let o=e("<div>").addClass(t.settings.styleClasses.inputGroup);if(a.prefix&&e("<div>").addClass(t.settings.styleClasses.inputGroupPrepend).appendTo(o).html(("text"===a.type&&null!==(sf=Q(t.def,a.prefix))&&a.name!==sf.name?J(t,sf,null,null,!0).css("text-align","left"):e("<span>").html(g(t,a.prefix,null,!0,!0))).addClass(t.settings.styleClasses.inputGroupText)),a.suffix||!0===a.copy||!0===a.reveal){let n=e("<div>").addClass(t.settings.styleClasses.inputGroupAppend).appendTo(o);a.suffix&&n.html(("text"===a.type&&null!==(sf=Q(t.def,a.suffix))&&a.name!==sf.name?J(t,sf,null,null,!0).css("text-align","left"):e("<span>").html(g(t,a.suffix,null,!0,!0))).addClass(t.settings.styleClasses.inputGroupText)),!0===a.password&&!0===a.reveal&&n.append(e('<span class="input-group-text">').click(function(t){let n=e(this).children("i"),a=!1;(a=l.is("[type=password]"))?l.attr("type","text"):l.attr("type","password"),n.toggleClass("fa-eye-slash",a).toggleClass("fa-eye",!a)}).html(e('<i class="fa fa-eye"">').attr("title","Toggle "+a.label.toLowerCase()))),!0===a.copy&&n.append(e('<span class="input-group-text">').click(function(e){s(l,this)}).html(e('<i class="fa fa-copy" title="Copy to clipboard">')))}return r&&r.value&&ie(t,l),o.append(l)}function J(t,n,a,i,l){let r;if(!0===t.viewmode)if(i instanceof dataBinderArray)r=K(t,n);else{if("button"===n.type)return;r=e("<span>").attr("data-bind",i?i.attrName:"").html(i?i.toString():"")}else if("array"!==n.type||"options"in n){if(n.type)if("options"in n)r="array"===n.type?q(t,n):E(t,n,a);else if("lookup"in n&&"array"!==n.type)"string"==typeof n.lookup&&(n.lookup={url:n.lookup}),r=G(t,n);else switch(n.type){case"button":r=j(t,n);break;case"boolean":r=I(t,n);break;case"date":case"datetime":r=M(t,n);break;case"file":r=P(t,n);break;case"money":r=V(t,n);break;case"text":case"string":default:r=R(t,n.type,n)}}else r="arrayOf"in n?U(t,n):K(t,n);return!0===l&&r.is("."+t.settings.styleClasses.inputGroup)&&(r=r.children(),"width"in n&&r.css("width",n.width)),r}function H(e,t){if(Array.isArray(e)){for(let t in e)e[t]=H(e[t]);return e}if("fields"in e){for(let n in e.fields)e.fields[n]=H(e.fields[n],(t||e.name)+"."+n);return e}return{html:'<div data-bind="'+(t||e.name)+'">',weight:e.weight||1}}function K(t,n){let a=b(t.data,n.name),i=e('<div class="itemlist">').addClass(t.settings.styleClasses.group);if(!(a instanceof dataBinderArray))return i;if("label"in n&&(e("<h4>").addClass(t.settings.styleClasses.label).html(g(t,n.label,null,!0,!0)).appendTo(i),n.nolabel=!0),!("fields"in n))return i;let l=n.fields&&"label"in n.fields[Object.keys(n.fields)[0]],r=W(t,n.fields,n.layout),s=e('<div class="itemlist-item">');if(!0!==t.viewmode&&h(t,n.allow_remove,!0,a,n.name)&&s.append(e('<div class="itemlist-item-rm">').html([!0===n.allow_edit&&l?e("<label>").html("&nbsp;").addClass(t.settings.styleClasses.label):"",e('<button type="button" class="btn btn-danger btn-sm">').html("btnLabels"in n&&"remove"in n.btnLabels?n.btnLabels.remove:o(t,"minus"))])),!0!==t.viewmode&&h(t,n.allow_add,!0,a,n.name)){let s=je(ud,t),d=new dataBinder(we(n.fields),n.name,null,n.name);s.settings=e.extend({},e.fn.hzForm.defaults,t.settings),s.validate=!1,s.data=d,s.def={fields:n.fields};let u=e('<button type="button" class="btn btn-success btn-sm">').html("btnLabels"in n&&"add"in n.btnLabels?n.btnLabels.add:o(t,"plus")),f=X(s,{fields:r,row:!0},!0,ud,ud,ud,!0).addClass("itemlist-newitem").attr("data-field",n.name);f.find("input,textarea,select").attr("data-bind-ns",n.name).keypress(function(t){13===t.which&&e(t.target).parent().parent().parent().children(".itemlist-newitem-add").children("button").click()}),f.find("select").each(function(t,n){let a=e(n),i=a.data("def");a.off("change").on("change",function(){return _(s,e(this))}).off("update").on("update",function(t,n,a,i){return A(s,e(this),!1,i)}),"options"in i&&F(s,i,a,d,function(e,t){$(s,t,e)})}),i.append(e('<div class="itemlist-newitems">').html([e('<div class="itemlist-newitem-add">').html([l?e("<label>").html("&nbsp;").addClass(t.settings.styleClasses.label):"",u]),f])),u.click(function(){let t=!0;f.find("input,select,textarea").each(function(n,a){if(!a.name)return;let i=e(a),l=null,r=i.data("def"),o=b(s.data,i.attr("data-bind"));if(l=i.is("[type=checkbox]")?i.is(":checked"):i.val(),o&&o.attrName in s.required&&!0===s.required[o.attrName]&&!l)return i.toggleClass("is-invalid",!0),void(t=!1);if(i.is("select"))l={__hz_value:l,__hz_label:i.children("option:selected").text()};else if("date"===r.type&&"format"in r){let e=i.datepicker("getDate");l=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()}let d=b(s.data,a.name,!1,l);d&&d.set(l,null,null,!1)}),!0===t&&(a.push(s.data.save()),s.data.empty())})}return!0!==t.viewmode&&!0===h(t,n.allow_edit,!1,a,n.name)||(r=H(r)),s.append(X(t,{fields:r,row:!0},!0,!1,!1,ud,!0)),a.watch(function(a,i){if(!a)return;let l=a.attrName;a.extend(we(n.fields),!0),i.find("select,input").each(function(n,i){let l=e(i),r=l.data("def");if(l.is("select"))"options"in r&&F(t,r,l,a,function(e,n){$(t,n,e,!1,a)});else if("date"===r.type&&"format"in r){let e=a[r.name];l.data("datepicker",null),l.datepicker(r.__datepicker_options),e&&e.value&&l.datepicker("setDate",new Date(e.value))}}),e(i).find(".form-group,.form-section").each(function(n,i){let r=e(i),s=r.data("def");if(!s||!s.name)return;let o=b(a,s.name);o&&(r.data("name",l+"."+s.name).data("item",o.attrName),r.find("label").each(function(e,t){t.attributes.for.value=l.replace(/\[|\]/g,"_")+s.name}),"disabled"in s&&w(t,s,r),"required"in s&&y(t,s,r),"show"in s&&C(t,s,r))}),"disabled"in n&&w(t,n,e(i).parent().parent())}),i.append(e('<div class="itemlist-items" data-bind-template="o">').attr("data-bind",n.name).data("template",s)).data("def",n).data("item",a).on("click",".btn-danger",function(t){let n=Array.from(this.parentNode.parentNode.parentNode.children).indexOf(this.parentNode.parentNode),i=e(t.currentTarget.parentNode.parentNode.parentNode);a.unset(n),i.find("input,textarea,select").each(function(t,n){let a=e(n);a.parent().data("item",a.attr("data-bind"))})}),i}function Q(t,n,a){if(n instanceof Object)t="name"in n?e.extend(Q(t,n.name),n):n;else{let i=n.split(/[\.\[]/);for(let e in i){if(t&&"type"in t&&"money"===t.type&&"amt"===i[e])break;if("]"!==i[e].slice(-1)){if(!0!==a){if(!("fields"in t))return null;t=t.fields}if(!(i[e]in t))return null;t=t[i[e]]}}!0!==a&&(t=e.extend(!0,t,{name:n}))}return t}function Y(e,t){let n=/\{\{(\w*)\}\}/g,a=function(t,n){return"{{"+e+"."+n+"}}"};if(Array.isArray(t.options))for(let n in t.options)Y(e,t.options);else i(t.options)&&"url"in t.options?t.options.url=t.options.url.replace(n,a):"string"==typeof t.options&&(t.options=t.options.replace(n,a))}function W(t,n,a,i,l){if(!n)return[];a||(a=Array.isArray(n)?e.extend(!0,[],n):Object.keys(n));for(let r in a)if("string"==typeof a[r]&&(a[r]={name:a[r]}),"object"==typeof a[r])if(Array.isArray(a[r]))a[r]={fields:W(t,n,a[r],i,l)};else if("name"in a[r]){let s=a[r].name in n?n[a[r].name]:a[r].name in t.def.fields?t.def.fields[a[r].name]:null;if(!s||!0===s.hidden)continue;a[r]=e.extend(!0,{},s,a[r]),i&&(a[r].name=i+(l?"["+a[r].name+"]":"."+a[r].name),"options"in a[r]&&Y(i,a[r]))}else"fields"in a[r]&&("layout"in a[r]||(a[r].layout=Array.isArray(a[r].fields)?e.extend(!0,[],a[r].fields):Object.keys(n)),a[r].fields=W(t,n,a[r].layout,i,l));return a}function X(t,n,a,l,r,s,d){let u=null,f=null;if(n instanceof Array&&(n={fields:n}),u=Q(t.def,n)){if(!s&&"name"in u&&u.name&&(s=b(t.data,u.name)),"name"in u&&"default"in u&&s instanceof dataBinderArray&&null===s.value&&(s.value=u.default),"horizontal"in u&&(a=u.horizontal),"render"in u){if(f=p(t,u.render,s,u.name),!f)return;!0!==d&&u.name&&t.pageFields.push(u.name),f.attr("data-bind",u.name)}else if("fields"in u&&"array"!==u.type){let o,c=W(t,u.fields,"layout"in u?e.extend(!0,[],u.layout):null,u.name),p=c.length,h=[];null==a&&(a=!t.settings.horizontal&&!("layout"in u&&u.layout));for(let e in c){let l=c[e];"string"==typeof l&&(l=Q(t.def,l)),l&&(a&&!Array.isArray(l)&&("weight"in l||(l.weight=1),p+=l.weight-1),!0===n.protected&&i(l)&&(l.protected=!0),h.push(l))}o=12/p,f=e('<div class="form-section">').toggleClass("row",a).data("def",u),"label"in u&&f.append(e("<div>").toggleClass("col-md-12",a).html(e("<h5>").html(u.label)));for(let e in h){let n="name"in h[e]?s instanceof dataBinder?s[h[e].name]:void 0:s;!0===u.horizontal&&(h[e].row=!0);let i=o,c=X(t,h[e],!a,l,r,n,d);c&&(h[e]instanceof Object&&"weight"in h[e]&&(i=Math.round(i*h[e].weight)),f.append(c.toggleClass("col-md-"+i,a)),a&&!0!==u.row&&c.removeClass("row"))}}else{u.nolabel=!1;let n=e('<div class="form-field">'),a=J(t,u,l,s);t.settings.horizontal&&(!0!==u.nolabel&&u.label?n.addClass("col-sm-"+t.settings.hz.right):n.addClass("col-sm-12").toggleClass("row",!0===u.row)),!0!==d&&u.name&&t.pageFields.push(u.name),f=e("<div>").addClass(t.settings.styleClasses.group).toggleClass("row",t.settings.horizontal).data("def",u),(u.title||!0!==u.nolabel&&u.label)&&f.append(e("<label>").addClass(t.settings.styleClasses.label).toggleClass("col-sm-"+t.settings.hz.left,t.settings.horizontal).attr("for","__hz_field_"+u.name).html(g(t,"title"in u?u.title:u.label,null,!0,!0))),a&&(n.html(a),"hint"in u&&n.append(e('<small class="form-text text-muted">').html(g(t,u.hint,null,!0,!0))),"css"in u&&a.css(u.css),"cssClass"in u&&a.addClass(u.cssClass),f.append(n))}if(f.data("def",u).data("item",s||null),"width"in u&&f.width(u.width),"max-width"in u&&f.css("max-width",u["max-width"]),"height"in u&&f.css("height",u.height),"max-height"in u&&f.css("max-height",u["max-height"]),"html"in u){let n=u.html;"label"in u&&0===f.children().length&&f.append(e("<label>").addClass(t.settings.styleClasses.label).html(u.label)),f.append(e("<div>").html(g(t,n,null,!0,!0)))}if("header"in u&&f.prepend(u.header),"footer"in u&&f.append(u.footer),"show"in u&&!1!==r&&C(t,u,f),"watch"in u)for(let e in u.watch)t.data.watch(u.watch[e],function(e){A(t,e)});return!0===t.viewmode?f:("tip"in u&&f.children("label.control-label").append(o(t,"question-circle").addClass("form-tip").attr("data-title",u.tip).tooltip({placement:"auto",html:!0})).on("show.bs.tooltip",function(n){let a=e(this).children(".form-tip");a.attr("data-original-title",g(t,a.attr("data-title"),null,!0,!1)).tooltip("_fixTitle")}),"required"in u&&!1!==r&&y(t,u,f),"disabled"in u&&!1!==r&&w(t,u,f),"invalid"in u&&f.append(e('<div class="invalid-feedback">').html(u.invalid)),f)}}function Z(t,n,a){let i=e("<div>");if(Array.isArray(n)){let l=null;if(void 0===a&&(a=!0),a){i.addClass("row");let e=n.length;for(let t in n)"object"!=typeof n[t]||Array.isArray(n[t])||("weight"in n[t]||(n[t].weight=1),e+=n[t].weight-1);l=12/e}for(let r in n)i.append(e("<div>").toggleClass("col-md-"+Math.round((n[r].weight||1)*l),a).html(Z(t,n[r],!a)));return i}if("object"!=typeof n)return null;let l=e('<fieldset class="col col-12">').data("def",n).appendTo(i);n.label&&l.append(e("<legend>").html(g(t,n.label,null,!0,!0)));for(let e in n.fields)l.append(X(t,n.fields[e]));return"show"in n&&C(t,n,l),i.addClass("row")}function ee(t,n){if("object"!=typeof n||"show"in n&&!0!==h(t,n.show,!0))return null;let a=e("<div>"),i=[];for(let e in n.sections)i.push(Z(t,n.sections[e]));if(t.events.show.length>0)for(let e in t.events.show)x(t,t.events.show[e]);return!0===t.settings.cards?(a.addClass("card"),n.label&&a.append(e('<div class="card-header">').html(g(t,n.label,null,!0,!0))),a.append(e('<div class="card-body">').addClass(t.settings.styleClasses.page).data("def",n).append(i)),!0===t.settings.singlePage&&a.addClass("mb-5")):(a.addClass(t.settings.styleClasses.page),n.label&&a.append(e("<h1>").html(g(t,n.label,null,!0,!0))),a.append(i)),a.data("def",n)}function te(e,t){e.page=t,e.events={show:[],required:[],disabled:[],change:{}},e.eval_cache=null,e.pageFields=[],e.data.unwatchAll()}function ne(t,n){t.objects={loader:e('<div class="forms-loader-container">').html(e("<div>").addClass(t.settings.loaderClass)),container:e("<div>").addClass(t.settings.styleClasses.container).hide()},e(t).html([t.objects.loader,t.objects.container])}function ae(t,n,a,i){if("number"!=typeof n&&(n=parseInt(n)),!0!==i&&n===t.page)return!1;let l=function(t,n){let i=[];if(ce(t),t.objects.container.empty(),t.settings.singlePage){te(t,0);for(let e in t.pages)t.objects.container.append(ee(t,t.pages[e])),"exec"in t.pages[e]&&i.push(t.pages[e].exec)}else te(t,n),t.objects.container.append(ee(t,t.pages[n])),"exec"in t.pages[n]&&i.push(t.pages[n].exec),e(t).trigger("nav",[t.page+1,t.pages.length]);t.data.resync(),i.length>0&&new Function("change",i.join("\n")).call(this,function(e){return _(t,e)}),pe(t),"function"==typeof a&&a()};if(null!==t.page&&n>t.page){let a=t.pages[t.page];if("validate"in a)return void fe(t).done(function(i,r){!0===i?"save"in a&&h(t,a.save,!1)?he(t,!1).done(function(){l(t,n)}):l(t,n):e(t).trigger("validate",[i,r])});if("save"in a&&h(t,a.save,!1))return void he(t,!1).done(function(){l(t,n)})}return l(t,n)}function ie(t,n,a){if(!n.is("input,select,textarea"))return n.children("input,select,textarea").each(function(n,i){ie(t,e(i),a)});let l=n.attr("data-bind");return l?se(t,l,{required:!1,disabled:!1}).done(function(r,s,o){!0!==s&&!0===a||(n.toggleClass("is-invalid",!0!==s).toggleClass("border-warning",!0===s&&i(o)&&!0===o.warning),e(t).trigger("validate_field",[l,!0===s,s]))}):void 0}function le(t,n,a){let i={name:t,field:e.extend({},n),status:a};return i}function re(e,t,n,a,i,l){if(!n||!a||!0!==e.validate)return!0;if("show"in a&&!h(e,a.show,!0,n,a.name))return!0;if(void 0===l&&(l=n instanceof dataBinderArray?n.length>0?n:null:a.other&&!n.value?n.other:n.value),t in e.required||(e.required[t]=h(e,a.required,i.required,n,t)),i.required=e.required[t],i.required&&null===l)return le(t,a,"required");if(null==l)return!0;if("format"in a&&l instanceof dataBinderValue&&"date"!==a.type&&!Inputmask.isValid(String(l),a.format))return le(t,a,"bad_format");if("validate"in a)for(let i in a.validate){let r=a.validate[i];switch(i){case"min":if(parseInt(l)<r)return le(t,a,"too_small");break;case"max":if(parseInt(l)>r)return le(t,a,"too_big");break;case"with":let s=new RegExp(r);if("string"!=typeof l||!l.match(s))return le(t,a,"regex_failed");break;case"equals":if(l!==r)return le(t,a,"not_equal");break;case"minlen":if(n instanceof dataBinderValue&&(!l||l.length<r)||!n||n.length<r)return le(t,a,"too_short");break;case"maxlen":if(n instanceof dataBinderValue&&(!l||l.length>r)||!n||n.length>r)return le(t,a,"too_long");break;case"custom":if(!h(e,r,!0))return le(t,a,"custom")}}return!0}function se(n,a,l,r){let s=[];return setTimeout(function(){let o=i(a)?a:Q(n.def,a);if(o){let a=b(n.data,o.name);a||(o.disabled=!0),o.name in n.disabled||(n.disabled[o.name]="disabled"in o&&h(n,o.disabled,l.disabled,a,o.name)),l.disabled=n.disabled[o.name];let i=!(!o.protected&&!l.disabled)||re(n,o.name,a,o,l);if("fields"in o&&(a instanceof dataBinder||a instanceof dataBinderArray)){let e="array"===o.type?a.save():[a];if(!0!==i||0===e.length)for(let e in s)s[e](o.name,i,r);else for(let t in e)for(let e in o.fields){"name"in o.fields[e]||(o.fields[e].name=e);let a="array"===o.type?o.name+"["+t+"]."+e:o.name+"."+e;n.queue.push(a),se(n,a,{required:l.required,disabled:l.disabled},r).done(function(e,t){for(let n in s)s[n](e,t,r)})}}if(a&&a instanceof dataBinderValue&&a.value&&!0===i&&"validate"in o&&"url"in o.validate){let i=g(n,o.validate.url,{__input__:a.value},!0),l={target:[i,{name:o.name,value:a.value}]},r=JSON.stringify(l).hash(),d=function(e){r in n.apiCache||(n.apiCache[r]=e);let t=!0===e.ok||le(o.name,o,e.reason||"api_failed("+o.validate.url+")");if(s.length>0)for(let n in s)s[n](o.name,t,e)};r in n.apiCache?d(n.apiCache[r]):!0===n.standalone?e.ajax({method:o.validate.method||"POST",url:o.validate.url,contentType:"application/json",data:JSON.stringify(l.target[1])}).done(d).fail(t):ye(n,"api",l,!1).done(d).fail(t)}else if(s.length>0)for(let e in s)s[e](o.name,i,r);if(o.name in n.monitor)for(let e in n.monitor[o.name])n.monitor[o.name][e](i)}else for(let e in s)s[e](a,!0,r)}),{done:function(e){return"function"==typeof e&&s.push(e),this}}}function oe(e,t){if(Array.isArray(e)){for(let n in e)if(oe(e[n],t))return!0}else{let n="string"==typeof e?e:e.name;if(t.name===n)return!0}return!1}function de(e,t){for(let n in e.def.pages)for(let a in e.def.pages[n].sections)for(let i in e.def.pages[n].sections[a].fields)for(let l in t)if(oe(e.def.pages[n].sections[a].fields[i],t[l])){let t=parseInt(n);return void(e.page!==t&&ae(e,t,function(){fe(e)}))}}function ue(t,n){let a=[];return t.queue=[],t.required=[],setTimeout(function(){let l=[];if(void 0===n){if(!("def"in t&&"fields"in t.def))return;n=Object.keys(t.def.fields)}for(let r in n)t.queue.push(n[r]),se(t,n[r],{required:!1,disabled:!1}).done(function(n,r,s){let o=t.queue.indexOf(n);o>=0&&t.queue.splice(o,1),Array.isArray(r)||(r=[{name:n,result:r}]);for(let t in r)!0!==r[t].result&&l.push(r[t].result),e('[data-bind="'+r[t].name+'"]').toggleClass("is-invalid",!0!==r[t].result).toggleClass("border-warning",!0===r[t].result&&i(s)&&!0===s.warning);if(0===t.queue.length)for(let e in a)a[e](0===l.length,l)})}),{done:function(e){"function"==typeof e&&a.push(e)}}}function fe(e){return ue(e,e.pageFields)}function ce(e){e.objects.container.hide(),e.objects.loader.show(),e.loading++}function pe(t){t.loading--,t.loading>0||null===t.page||(t.objects.loader.hide(),t.objects.container.show(),e(t).trigger("ready",[t.def]))}function he(t,n,a){let i={done:null},l=function(t,n){let a=t.data.save(!0===t.standalone);for(let e in t.def.fields)!0===t.def.fields[e].protected&&delete a[e];let l=t.standalone?a:{params:n||{},form:a};(events=jQuery._data(t,"events"))&&"submit"in events&&!0!==e(t).triggerHandler("submit",[a,l])||("saveURL"in t.settings&&(l.url=t.settings.saveURL),e(t).trigger("saving",[a,l]),t.data.commit(),ye(t,"save",l,!1).done(function(n){if(!n.ok)return e(t).trigger("saverror",t.standalone?n:[{error:{str:n.reason||"An unknown error occurred while saving the form!"}},n.params]);t.posts={},!t.standalone&&(t.uploads.length>0||t.deloads.length>0)?(e(t).trigger("attachStart",[t.uploads,t.deloads]),ge(t,function(a,l){e(t).trigger("attachDone",[l]),a?(e(t).trigger("save",[n.result,n.params]),i.done&&i.done()):e(t).trigger("saverror",[{error:{str:"File upload failed"}},n.params,l])})):(e(t).trigger("save",t.standalone?n:[n.result,n.params]),i.done&&i.done())}).fail(function(n){e(t).trigger("saverror",[n.responseJSON,l])}))};return!0===n||void 0===n?ue(t).done(function(n,i){n?l(t,a):(e(t).trigger("saverror",[{error:{str:"Validation failed!"},validation:i}]),e(t).trigger("validate",[n,i]),t.settings.validateNav&&de(t,i))}):l(t,a),{done:function(e){"function"==typeof e&&(i.done=e)}}}function me(e){if(e instanceof File)e={lastModified:e.lastModified,lastModifiedDate:e.lastModifiedDate,name:e.name,size:e.size,type:e.type,url:URL.createObjectURL(e)};else if(Array.isArray(e))for(let t in e)e[t]=me(e[t]);else{let t=/[^/]*$/.exec(e.url)[0];e.url=e.url.substr(0,e.url.length-t.length)+encodeURIComponent(t)}return e}function ge(t,n){if(t.deloads.length>0){let a={name:t.settings.form,params:t.settings.params,remove:t.deloads};e.ajax({url:hazaar.url(t.settings.controller,"detach"),method:"POST",data:JSON.stringify(a),contentType:"application/json"}).done(function(e){"removed"in e&&(t.deloads=t.deloads.filter(function(t){return!1===e.removed.indexOf(t.file)})),0===t.uploads.length&&n(e.ok)})}if(t.uploads.length>0){let e={pending:[],working:[],attached:[],failed:[]};t.uploads.sort(function(e,t){return e.file.name===t.file.name?0:e.file.name<t.file.name?-1:1}),e.pending=Object.assign([],t.uploads),be(t,e,n)}}function be(t,n,a){for(;n.working.length<t.settings.concurrentUploads;){let i=new FormData,l=n.pending.shift();if(!l)break;n.working.push(l),i.append("name",t.settings.form),i.append("params",JSON.stringify(t.settings.params)),i.append("attachment[field]",l.field),i.append("attachment[file]",l.file),e(t).trigger("fileStart",[l]),e.ajax({type:"POST",data:i,processData:!1,contentType:!1,url:hazaar.url(t.settings.controller,"attach"),upload_file:l,xhr:function(){return xhr=new XMLHttpRequest,xhr.upload.onprogress=function(n){e(t).trigger("fileProgress",[this.file,n])},xhr.upload.file=this.upload_file,xhr}}).done(function(n){let a=this.upload_file;t.uploads=t.uploads.filter(function(e){return!(a.field===e.field&&a.file.name===e.file.name)}),e(t).trigger("fileDone",[a,n])}).fail(function(n){this.upload_file.failed=!0,this.upload_file.response=n.responseJSON,e(t).trigger("fileError",[this.upload_file,n])}).always(function(){let e=this.upload_file;n.working=n.working.filter(function(t){return!(e.field===t.field&&e.file.name===t.file.name)}),!0===e.failed?n.failed.push(e):n.attached.push(e),n.pending.length>0?be(t,n,a):0===n.working.length&&a(0===n.failed.length,n)})}}function ye(t,n,a,i,l){!0===i&&ce(t);let r={},s="";if(!0===t.standalone){if(!(n in t.settings.endpoints))return e(t).trigger("error",["Host endpoint "+n+" is unknown!"]);s=t.settings.endpoints[n],r=a}else s=hazaar.url(t.settings.controller,"interact/"+n),r=e.extend(!0,{},{name:t.settings.form,params:t.settings.params},a);return e.ajax({method:"POST",url:s,async:!0!==l,contentType:"application/json",data:JSON.stringify(r)}).always(function(e){!0===i&&pe(t),"data"in e&&console.log(e.data)})}function ve(t,n){if("string"==typeof n)return e.get(n).done(function(e){ve(t,e)});e(t).find(".is-different").removeClass("is-different"),t.data.diff(n,function(e){e.find().addClass("is-different")})}function we(e){if(!e)return;let t={};for(let n in e)"fields"in e[n]&&"array"!==e[n].type?t[n]=we(e[n].fields):(e[n].default||"array"!==e[n].type&&"file"!==e[n].type||(e[n].default=[]),t[n]=e[n].default?e[n].default:null);return t}function ke(t,n,a){let i=["disabled","protected","focus","blur"];for(let l in n){let r=a?e.extend(!0,{},a):null;if("string"==typeof n[l]&&(n[l]={type:n[l],label:l}),"type"in n[l]||!("options"in n[l]||"lookup"in n[l]))if("type"in n[l]&&"types"in t.def&&n[l].type in t.def.types){let e=t.def.types[n[l].type];n[l]=jQuery.extend(!0,{},e,r,n[l]),n[l].type=e.type,n[l].horizontal=!1,r={};for(let e in i)i[e]in n[l]&&(r[i[e]]=n[l][i[e]])}else"type"in n[l]&&"array"===n[l].type?("arrayOf"in n[l]&&"types"in t.def&&n[l].arrayOf in t.def.types&&(n[l].fields=t.def.types[n[l].arrayOf].fields,delete n[l].arrayOf),"default"in n[l]&&!Array.isArray(n[l].default)&&(n[l].default=[n[l].default])):r&&(n[l]=jQuery.extend(!0,{},r,n[l]));else n[l].type="text";"watch"in n[l]&&!Array.isArray(n[l].watch)&&(n[l].watch=[n[l].watch]),"fields"in n[l]&&ke(t,n[l].fields,r)}}function Ce(e,n){Array.isArray(n)||(n=[n]);for(let a in n)jQuery.ajax({url:hazaar.url(e.settings.controller,"script/"+n[a]),dataType:"script"}).fail(t)}function xe(e){return ye(e,"init").done(function(t){t.ok&&("form"in t&&(e.def=t.form),"tags"in t&&(e.tags=t.tags),"scripts"in e.def&&Ce(e,e.def.scripts),ke(e,e.def.fields),e.data=new dataBinder(we(e.def.fields)))}).fail(t)}function _e(t,n,a){if(!n)return{};for(let l in n){let r=(a?a+".":"")+l,s=null;!i(n[l])||"__hz_value"in n[l]?"boolean"==typeof n[l]?n[l]={__hz_value:n[l],__hz_label:n[l]?"Yes":"No"}:!0===t.viewmode&&null!==(s=Q(t.def,r))&&"options"in s&&F(t,s,e("<i>").data("def",s),null,function(e,a){!i(a)||"url"in a?$(t,a,e,!1,null,function(e,t,a,i){let s=b(e.data,r);s&&(s.label=a[n[l]])}):n[l]={__hz_value:n[l],__hz_label:a[n[l]]}}):_e(t,n[l],r)}return n}function Ae(e){let t=function(e,n,a){let l=null;if(Array.isArray(e)){l=[];for(let n in e)t(e[n],l,a)}else if(i(e))if("sections"in e)t(e.sections,l=[],a);else if("fields"in e)t(e.fields,l=[],a);else if("name"in e){let t=e.name.split(".");for(let n=1;n<=t.length;n++){let i=t[n-1];n<t.length?(a[i]={fields:{}},a=a[i].fields):i in a||(a[i]=e)}l=e.name}n.push(l)};if(!Array.isArray(e))return!1;let n=[],a={};return t(e,n,a),{name:"Simple Form",pages:[{sections:[{fields:n}]}],fields:a}}function ze(t,n){let a=!1,i="pages"in t&&t.pages[t.page]?t.pages[t.page].id:t.page;t.pages=[],"pstate"in t||(t.pstate=[]);for(let e in n){let l=!("show"in n[e])||h(t,n[e].show,!0);if(n[e].id=parseInt(e),!0!==a&&t.pstate[e]!==l&&(a=!0),t.pstate[e]=l,!0!==t.pstate[e])continue;let r=t.pages.push(n[e]);n[e].id===i&&(t.page=r-1)}if(a){let n=[];for(num in t.pages)n[num]={label:g(t,t.pages[num].label,null,!0,!0)};e(t).trigger("pages",[n,t.page]).trigger("nav",[t.page+1,t.pages.length])}return a}function Oe(n,a){let i=function(t){t.ok&&("horizontal"in n.def&&(n.settings.horizontal=n.def.horizontal),n.data.extend(_e(n,t.form)),n.data.commit(),ze(n,n.def.pages),e(n).trigger("data",[n.data.save()]),ae(n,n.page,null,!0))};if(a&&(n.settings.endpoints.init=a),!0===n.standalone||!0==(n.standalone="def"in n.settings)){let a=function(a){n.def=a,Array.isArray(n.def)&&(n.def=Ae(n.def)),ke(n,n.def.fields),n.data=new dataBinder(we(n.def.fields)),e(n).trigger("load",[n.def]),"load"in n.settings.endpoints?ye(n,"load").done(i).fail(t):"string"==typeof n.settings.data?e.get(n.settings.data).done(function(e){i({ok:!0,form:e})}).fail(t):i({ok:!0,form:n.settings.data})};"init"in n.settings.endpoints?ye(n,"init").done(a).fail(t):a(n.settings.def),delete n.settings.def,delete n.settings.data}else xe(n).done(function(a){e(n).trigger("load",[n.def]),ye(n,"load").done(i).fail(t)})}function je(e,t){return void 0===e&&(e={}),e.data={},e.events={show:[],required:[],disabled:[],change:{}},e.posts={},e.viewmode=!1,e.page=0,e.working=!1,e.validate=!0,e.standalone=!1,e.pageFields=[],e.queue=[],e.loading=0,e.uploads=[],e.deloads=[],e.monitor={},e.apiCache={},e.required={},e.disabled={},t&&(e.parent=t,e.settings=t.settings),e}function Te(t,n){je(t),t.settings=e.extend(!0,{},e.fn.hzForm.defaults,n),t.viewmode=t.settings.viewmode,t.settings.concurrentUploads<1&&(t.settings.concurrentUploads=1),e(t).trigger("init"),ne(t),Oe(t),form=t}e.fn.hzForm=function(){let t=arguments,n=this.get(0);switch(t[0]){case"info":let e=n.data.save(),a={};for(let t in e)a[t]={label:n.def.fields[t].label,value:e[t]};return a;case"data":return n.data;case"def":return n.def;case"load":return void(n.settings&&Oe(n,t[1]))}return this.each(function(n,a){if(a.settings)switch(t[0]){case"reload":if(!0===t[1])Oe(a);else{let e=a.data.save();xe(a).done(function(){for(let t in e)a.data[t]=e[t];ze(a,a.def.pages),ae(a,a.page,null,!0)})}break;case"nav":case"navigate":case"page":ae(a,t[1]);break;case"prev":a.page>0&&ae(a,a.page-1);break;case"next":a.page<a.pages.length-1&&ae(a,a.page+1);break;case"save":he(a,t[1],t[2]).done(function(){!0===a.settings.viewmode&&(a.viewmode=!0,ae(a,a.page,null,!0))});break;case"single":a.settings.singlePage=Boolean(t[1]),ae(a,0);break;case"validate":ue(a).done(function(n,i){e(a).trigger("validate",[n,i]),(void 0!==t[1]||!0!==a.settings.validateNav)&&!1===t[1]||n||de(a,i)});break;case"reset":
a.data.reset();break;case"edit":a.viewmode=!1,ae(a,a.page,null,!0);break;case"view":a.viewmode=!0,ae(a,a.page,null,!0);break;case"toggleEdit":a.viewmode=1 in t&&"boolean"==typeof t[1]?t[1]:!a.viewmode,ae(a,a.page,null,!0);break;case"monitor":"function"==typeof t[2]&&(a.monitor[t[1]]=[t[2]],se(a,t[1],{required:!1,disabled:!1}));break;case"diff":ve(a,t[1])}else Te(a,t[0])})},e.fn.hzForm.defaults={form:"default",controller:"index",endpoint:"interact",encode:!0,singlePage:!1,cards:!1,horizontal:!1,viewmode:!1,hz:{left:3,right:9},placeholder:"Please select...",loaderClass:"forms-loader",validateNav:!0,lookup:{delay:300,startlen:0,autocomplete:!1},concurrentUploads:2,styleClasses:{container:"forms-container",page:"form-page",group:"form-group",label:"control-label",input:"form-control",inputGroup:"input-group",inputGroupPrepend:"input-group-prepend",inputGroupText:"input-group-text",inputGroupAppend:"input-group-append",chkDiv:"custom-control custom-checkbox",chkInput:"custom-control-input",chkLabel:"custom-control-label",button:"btn",buttonGroup:"btn-group"},endpoints:{},icons:hzIcons}}(jQuery),$.fn.fileUpload=function(){let e=this.get(0);if(e.options){switch(arguments[0]){case"add":e._add(arguments[1]);break;case"remove":e._remove(arguments[1]);break;case"list":return e.files}return this}return e.files=[],e.options=$.extend({name:"file",multiple:!1,btnClass:"btn btn-default",thumbnail:120,maxSize:null,autoAdd:!0,autoRemove:!0},arguments[0]),e._isIE=function(){return!!navigator.userAgent.match(/Trident/g)||!!navigator.userAgent.match(/MSIE/g)},e._add=function(t){if(Array.isArray(t)){if(!0===e.options.multiple)for(let e in t)this._add(t[e])}else"object"!=typeof t&&(t={name:t,type:"text/text"}),"lastModifiedDate"in t||(t.lastModifiedDate=new Date(1e3*t.lastModified)),e.files.push(t),e.o.dzwords&&e.o.dzwords.hide(),e.o.list.append($('<div class="dz-item">').html([e._preview(t),$('<div class="dz-size">').html(humanFileSize(t.size)),$('<div class="dz-detail">').html($("<a>").attr("href",t.url).attr("target","_blank").html(t.name).attr("title",t.name)),$('<div class="dz-remove">').html(_hz_icon("times")).click(function(n){let a=$(this).parent();"function"==typeof e.options.remove&&e.options.remove(t),e.options.autoRemove&&e._remove(a.data("file")),n.stopPropagation()})]).data("file",t).click(function(e){e.stopPropagation()}))},e._remove=function(t){return this.files=this.files.filter(function(e){return e.name!==t.name}),e.o.list.children().each(function(e,n){let a=$(n),i=a.data("file");i&&i.name===t.name&&a.remove()}),0===this.files.length&&this.o.dzwords&&this.o.dzwords.show(),!0},e._preview=function(t){let n=$('<div class="dz-preview">').css({width:e.options.thumbnail,height:e.options.thumbnail});if(t.preview)n.append($("<img>").attr("src",t.preview));else if("string"==typeof t.type)if("image"===t.type.substr(0,5)){if(t.url)n.append($("<img>").attr("src",t.url));else if(t instanceof File&&"image"===t.type.substr(0,5)){let e=new FileReader;e.onload=function(e){n.append($("<img>").attr("src",e.target.result))},e.readAsDataURL(t)}}else n.addClass("fileicon").attr("data-type",t.type.replace(/\./g,"_").replace(/\//g,"-"));return n},e._checkexists=function(t){for(let n in e.files)if(e.files[n].name===t.name)return!0;return!1},e._checksize=function(t){return"integer"!=typeof e.options.maxSize||e.options.maxSize<=0||t.size<e.options.maxSize},e._add_files=function(t){let n=[],a=[];if(e.options.multiple||!(e.files.length>0)){for(let i=0;i<t.length;i++){let l=t[i];if(e._checkexists(l))return;e._checksize(l)?(e.options.autoAdd&&e._add(l),n.push(l)):a.push(l)}if(e.o.input.val(null),n.length>0&&"function"==typeof e.options.select&&e.options.select(n),a.length>0){let t=$("<p>");for(let e in a)t.append($("<strong>").html(a[e].name));$("<div>").html([$("<p>").html("Failed to attach the following files:"),t,$("<p>").html("Files were too big as the maximum allowed file size is "+humanFileSize(e.options.maxSize)+".")]).popup({title:"Bad Attachment",icon:"danger",buttons:[{label:"OK",class:"btn btn-danger"}]})}}},e._registerEvents=function(){this.o.dropzone&&(this.o.dropzone.click(function(t){!e.options.multiple&&e.files.length>0||e.o.input.click()}),this.o.dropzone.on("dragenter",function(e){e.preventDefault(),e.stopPropagation()}),this.o.dropzone.on("dragover",function(t){e.o.dropzone.addClass("drag"),t.preventDefault(),t.stopPropagation()}),this.o.dropzone.on("dragleave",function(t){t.preventDefault(),t.stopPropagation(),e.o.dropzone.removeClass("drag")}),this.o.dropzone.on("drop",function(t){t.preventDefault(),t.stopPropagation(),e.o.dropzone.removeClass("drag"),!e.options.multiple&&e.files.length>0||e._add_files(t.originalEvent.dataTransfer.files)})),e._isIE()&&e.o.input.click(function(){setTimeout(function(){e.o.input.val().length>0&&e.o.input.change()},0)}),this.o.input.change(function(t){!e.options.multiple&&e.files.length>0||e._add_files(t.target.files)}),this.options.multiple||this.o.dzwords.click(function(){e.o.input.click()})},e._render=function(e){$(this).addClass("form-fileupload"),this.o={},this.o.input=$('<input type="file" class="form-control">').appendTo(e),e.options.accept&&this.o.input.attr("accept",e.options.accept),this.o.list=$('<div class="dz-items">'),e.options.multiple?(this.o.input.prop("multiple",!0),e.o.dzwords=$('<div class="form-dropzone-words">').html("Drop files here or click to upload."),this.o.dropzone=$('<div class="form-dropzone">').html([this.o.dzwords,this.o.list]).appendTo($(e).addClass("multiple")).toggleClass("single",!e.options.multiple),e.options.height&&this.o.dropzone.height(e.options.height)):(e.o.dzwords=$("<button>").addClass(e.options.btnClass).html(e.options.btnLabel).appendTo($(e)),this.o.list.appendTo($(e).addClass("single")))},e._render(e),e._registerEvents(),this},Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null===this)throw new TypeError('"this" is null or not defined');let t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");let a=arguments[1],i=0;for(;i<n;){let n=t[i];if(e.call(a,n,i,t))return n;i++}},configurable:!0,writable:!0}),Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(e){if(null===this)throw new TypeError('"this" is null or not defined');let t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");let a=arguments[1],i=0;for(;i<n;){let n=t[i];if(e.call(a,n,i,t))return i;i++}return-1},configurable:!0,writable:!0});