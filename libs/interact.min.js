function _hz_icon(e,t){if(!(e in hzIcons))return null;let n=hzIcons[e],a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.setAttribute("class","forms-icon"),a.setAttribute("viewBox","0 0 "+n[0]+" "+n[1]);let i=document.createElementNS("http://www.w3.org/2000/svg","path");return i.setAttribute("fill","currentColor"),i.setAttribute("d",n[2]),a.appendChild(i),$(a)}var ud=void 0;"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){"use strict";if(null===e)throw new TypeError("Cannot convert undefined or null to object");let n=Object(e);for(let e=1;e<arguments.length;e++){let t=arguments[e];if(null!==t)for(let e in t)Object.prototype.hasOwnProperty.call(t,e)&&(n[e]=t[e])}return n},writable:!0,configurable:!0});var hzIcons={"exclamation-circle":[512,512,"M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zm-248 50c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"],"question-circle":[512,512,"M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zM262.655 90c-54.497 0-89.255 22.957-116.549 63.758-3.536 5.286-2.353 12.415 2.715 16.258l34.699 26.31c5.205 3.947 12.621 3.008 16.665-2.122 17.864-22.658 30.113-35.797 57.303-35.797 20.429 0 45.698 13.148 45.698 32.958 0 14.976-12.363 22.667-32.534 33.976C247.128 238.528 216 254.941 216 296v4c0 6.627 5.373 12 12 12h56c6.627 0 12-5.373 12-12v-1.333c0-28.462 83.186-29.647 83.186-106.667 0-58.002-60.165-102-116.531-102zM256 338c-25.365 0-46 20.635-46 46 0 25.364 20.635 46 46 46s46-20.636 46-46c0-25.365-20.635-46-46-46z"],times:[352,512,"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"],minus:[448,512,"M416 208H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h384c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"],plus:[448,512,"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"],calendar:[448,512,"M12 192h424c6.6 0 12 5.4 12 12v260c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V204c0-6.6 5.4-12 12-12zm436-44v-36c0-26.5-21.5-48-48-48h-48V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H160V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H48C21.5 64 0 85.5 0 112v36c0 6.6 5.4 12 12 12h424c6.6 0 12-5.4 12-12z"],search:[512,512,"M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"]};Array.fromObject=function(e){if("object"!=typeof e)return null;let t=[];for(let n in e)t.push(e[n]);return t},String.prototype.hash=function(){let e,t,n=0;if(0===this.length)return n;for(e=0;e<this.length;e++)t=this.charCodeAt(e),n=(n<<5)-n+t,n|=0;return n},Date.getLocalDateFormat=function(){let e=[],t=[],n="/",a=null,i=new Date(2001,4,9).toLocaleDateString();if(!1!==(a=i.match(/\W/))&&(n=a[0]),t=i.split(n),2001===parseInt(t[0]))e=["yyyy","mm","dd"],n="-";else for(x in t){let n=!1,a=parseInt(t[x]);"0"===t[x][0]&&(n=!0),9===a?e.push(n?"dd":"d"):5===a?e.push(n?"mm":"m"):1===a?e.push("yy"):2001===a&&e.push("yyyy")}return e.join(n)},dataBinder.prototype._commit=dataBinderArray.prototype._commit=function(e){this._default={};for(let t in e){let n=e[t];n instanceof dataBinder||n instanceof dataBinderArray?n=e[t].commit():n instanceof dataBinderValue&&(n=n.save()),this._default[t]=n}return this._default},dataBinder.prototype.commit=function(){return this._commit(this._attributes)},dataBinderArray.prototype.commit=function(){return this._commit(this._elements)},dataBinder.prototype.reset=function(){if(!this._default)return!1;for(let e in this._attributes)e in this._default||this.remove(e);for(let e in this._default)this._attributes[e]instanceof dataBinder||this._attributes[e]instanceof dataBinderArray?this._attributes[e].reset():this[e]=this._default[e];return!0},dataBinderArray.prototype.reset=function(){if(!this._default)return!1;this._elements=[];for(let e in this._default)this._elements[e]=this.__convert_type(e,this._default[e]);return this.resync(),!0},dataBinder.prototype.diff=function(e,t){if(null!==e&&"object"==typeof e){e instanceof dataBinder||(e=new dataBinder(e,null,null,"form-differential-analysis"));for(let n in this._attributes){let a=n in e?e[n].value:null;this._attributes[n]instanceof dataBinder||this._attributes[n]instanceof dataBinderArray?this._attributes[n].diff(a,t):this._attributes[n]instanceof dataBinderValue&&this._attributes[n].value!==a&&t(this._attributes[n],a)}}},dataBinderArray.prototype.diff=function(e,t){if(e&&"object"==typeof e)for(key in this._elements)key in e||(e[key]=null),this._elements[key]instanceof dataBinder&&this._elements[key].diff(e[key],t)},function(e){function t(t){"string"==typeof t?t={str:t}:t instanceof Error?t={status:"JavaScript Error",str:t.message,line:t.lineNumber,file:t.fileName}:"done"in t&&("responseJSON"in t||(t.responseJSON=JSON.parse(t.responseText)),t=t.responseJSON.error),e("<div>").css("text-align","left").html([e("<h4>").html(t.status),e("<div>").html(t.str).css({"font-weight":"bold","margin-bottom":"15px"}),t.line?e("<div>").html("Line: "+t.line):null,t.file?e("<div>").html("File: "+t.file):null]).popup({title:"An error ocurred!",icon:"danger",buttons:[{label:"OK",class:"btn btn-default"}]})}function n(){return"yxxx-yxxx-yxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"===e?t:3&t|8;return n.toString(16)})}function a(e,t){return t.split(".").reduce(function(e,t){return e[t]},e)}function l(e){return"object"!=typeof e&&(e=e.toString().trim().toLowerCase(),"t"===e||"true"===e||"on"===e||"yes"===e||"y"===e||"ok"===e?"true":RegExp("/^(!|not)s*null$/").test(e)?"true":1===parseInt(e)?"true":"false")}function r(e){return"true"===l(e)}function o(e,t){if(!("type"in e))return t;let n=e.type.toLowerCase();return"array"===n&&"arrayOf"in e&&(n=e.arrayOf.toLowerCase()),"string"==typeof t&&""===t?null:("int"===n||"integer"===n?t=parseInt(t):"text"===n||"string"===n?t=t.toString():"bool"===n||"boolean"===n?t=r(t):"float"!==n&&"double"!==n&&"money"!==n||(t=parseFloat(t.replace(/\,/g,""))),t)}function s(e,t){return t=h(e,t,null,!0),t.match(/^https?:\/\//)?t:hazaar.url(t)}function d(e,t,n,a){if(!Array.isArray(e))return console.warn("Attempting to sort object.  Sorting is only supported by arrays."),e;if("string"==typeof t)e.sort(function(e,n){return e[t]<n[t]?-1:e[t]>n[t]?1:0});else if(Array.isArray(t)){let i=[];for(let a in t){let l=e.findIndex(function(e,i,l){return e[n]===t[a]});-1!==l&&(i.push(e[l]),e.splice(l,1))}if(e.length>0&&a){let e={};e[a]="__spacer__",e[n]=Array(10).join("&#x2500;"),i.push(e)}e=i.concat(d(e,n))}return e}function u(e,t,n,a){for(let i in e)if("object"!=typeof e[i]){let l={};l[t]=o(a,i),l[n]=e[i],e[i]=l}return Array.isArray(e)||(e=Array.fromObject(e)),e}function f(e,t,n,a,i){let l="";if("string"==typeof e.eval_cache)l=e.eval_cache;else{let t=e.data.save(!0),n=Object.keys(t).sort();for(let e in n){let a=n[e];if("form"===a)continue;let i=t[a];"string"==typeof i?i='"'+i.replace(/"/g,'\\"').replace("\n","\\n")+'"':("object"==typeof i||Array.isArray(i))&&(i=JSON.stringify(i)),l+="let "+a+" = "+i+";\n"}!0===e.eval_cache&&(e.eval_cache=l)}n&&(l+="let value = "+JSON.stringify(n.save(!0))+";\n",l+="let item = "+JSON.stringify(n.parent.save(!0))+";\n"),l+=!0===i?"return ( "+t.replace(/[\;\s]+$/,"")+" );":t;try{let i=e.parent?e.parent:e;return new Function("form","tags","formValue","formItem","key",l)(i.data,i.tags,n||null,n?n.parent:null,a)}catch(e){console.error("Failed to evaluate condition: "+t),console.error(e)}return!1}function c(e,t,n,a,i){return"boolean"==typeof t?t:void 0===t?void 0!==n&&n:f(e,t,a,i,!0)}function p(e,t){if("object"==typeof t&&!t.protected&&!t.keep)if("string"==typeof t.name){let n=m(e.data,t.name);n instanceof dataBinderValue?n.set(t.default||null,t.placeholder||null):n instanceof dataBinder&&n.empty()}else if("fields"in t)for(let n in t.fields){let a=t.fields[n];if(a instanceof Array)p(e,{fields:a});else if("string"==typeof a){let n=m(e.data,a);n instanceof dataBinderValue&&n.set(t.default||null,t.placeholder||null)}}}function h(e,t,n,a,i){if(!t)return null;let l=e&&e.parent?e.parent:e;for(;null!==(match=t.match(/\{\{([\W]*)([\w\.]+)\}\}/));){let e=match[1].split(""),r=l?m(l.data,match[2]):null;if(null===r&&(r="this."===match[2].substr(0,5)?m(l.settings,match[2].substr(5)):n?m(n,match[2]):null),-1===e.indexOf("!")&&null===(r instanceof dataBinderValue?r.value:r)&&!0!==a)return!1;-1!==e.indexOf(">")&&(i=!1);let o=r instanceof dataBinderValue?!0===i&&-1===e.indexOf(":")?r:r.value:r,s=i?'<span data-bind="'+match[2]+'" data-bind-label="'+(-1===e.indexOf(":")?"true":"false")+'">'+o+"</span>":o||"";t=t.replace(match[0],s)}return t}function m(e,t,n,a){if(t instanceof dataBinder||t instanceof dataBinderArray||t instanceof dataBinderValue)return t;if("string"!=typeof t||"object"!=typeof e||!e)return null;let i=t.split(/[\.\[]/),l=e;for(let e in i){let t=i[e];if("]"===i[e].slice(-1)&&(t=parseInt(t.slice(0,-1))),!(t in l)){if(void 0===a)return null;l[t]=parseInt(e)+1<i.length?{}:a}!0===n&&l[t]instanceof dataBinderValue&&(l[t]=[]),l=l[t]}return l}function g(e,t,n){if("required"in t)return"boolean"!=typeof t.required&&e.events.required.push(n),b(e,n,!1)}function b(t,n,a){let i=n.data("def");if(!i)return!1;let l=n.children("label.control-label"),r=l.children("svg.form-required"),o=m(t.data,n.data("item")),s=t.required[o.attrName]=c(t,i.required,void 0!==a&&a,o,i.name);return!0!==s?r.remove():0===r.length&&l.append(_hz_icon("exclamation-circle","Required").addClass("form-required")),"fields"in i&&n.children("div.form-section,div.form-group").each(function(n,a){let i=e(a);i.data("item")&&b(t,i,s)}),s}function y(e,t,n,a){if("disabled"in t&&!0!==t.protected)return"function"==typeof a&&n.data("disabled_func",a),"string"==typeof t.disabled&&e.events.disabled.push(n),v(e,n,a)}function v(t,n,a){let i=n.data("def");if(!i)return!1;let l=m(t.data,n.data("item")),r=t.disabled[l.attrName]=c(t,i.disabled,void 0!==a&&a,l,i.name);return n.find("input,textarea,select,button").prop("disabled",r),"fields"in i&&n.children("div.form-section,div.form-group").each(function(n,a){let i=e(a);i.data("item")&&v(t,i,r)}),r}function w(e,t,n){n.data("show",t.show),"boolean"!=typeof t.show&&e.events.show.push(n),k(e,n)}function k(e,t){let n=t.data("def");if(!n)return!1;e.working=!0;let a=m(e.data,t.data("item")),i=c(e,t.data("show"),!0,a,n?n.name:null);t.toggle(i),i||p(e,n),e.working=!1}function _(t,n){let a=n.data("def"),i=n.attr("data-bind"),l=m(t.data,i);if(!l)return!1;if(n.is("[type=checkbox]")){let e=n.is(":checked");l.set(e,e?"Yes":"No")}else if(n.is("select")){let i=n.val();if("__hz_other"===i){l&&null!==l.value&&l.set(null,null,l.other);let i=e("<div>").addClass(t.settings.styleClasses.inputGroup),r=e('<input type="text" placeholder="Enter other option...">').addClass(t.settings.styleClasses.input).data("def",a).val(l.other).attr("data-bind",n.attr("data-bind")).attr("data-bind-other",!0).change(function(n){return _(t,e(n.target))}).on("update",function(e,t,a){n.show(),i.remove()}).appendTo(i),o=e('<button class="btn btn-secondary" type="button">').html(_hz_icon("times")).click(function(e){i.remove(),l.other=null,n.val("").show()});"format"in a&&r.inputmask(a.format),e('<span class="input-group-btn">').addClass(t.settings.styleClasses.inputGroupAppend).html(o).appendTo(i),n.hide().after(i),r.focus()}else l.set(o(a,i))}else if("date"===a.type&&"format"in a){let e=n.datepicker("getDate");l.set(e?e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate():null,n.datepicker("getFormattedDate"))}else!0===a.other?l.other=n.val():l.value=o(a,n.val());return!1!==l.enabled()&&(e(t).trigger("change",[l]),!1)}function C(e,n,a,i){let l=R(e.def,"string"==typeof n?n:n.attr("data-bind"));if(!l)return;let r=l.update,o=null;if(i||(i=m(e.data,l.name)),e.eval_cache=!0,"string"==typeof r&&(r={url:r}),"object"==typeof n){if(i&&n.is("select")&&!0===i.enabled()&&"__hz_other"!==n.val()){let e=n.children('option[value="'+i.value+'"]').data("other")||null;i.enabled(!1),i.set(i.value,n.children("option:selected").text(),e)}else if("boolean"==typeof r||r&&("url"in r||!0===e.settings.update)){let a={originator:l.name,form:e.data.save()},s=function(e,t){let n=null;if("boolean"==typeof t)return t;if("object"!=typeof t)return!1;if("enabled"in t||(t.enabled=!0),"when"in t&&(t.enabled=c(e,t.when,!1,i,l.name)),t.enabled){if(!("url"in t))return!0;if(!1!==(n=h(e,t.url)))return a.api=n,!0}return!1};s(e,r)&&(o=function(){ge(e,"update",a,!1).done(function(t){t.ok&&(e.data.extend(t.updates),te(e,n))}).fail(t)})}!0!==a&&te(e,n)}if(i&&i.enabled()&&l.change&&f(e,l.change,i,l.name),!e.working&&e.events.show&&e.events.show.length>0)for(let t in e.events.show)k(e,e.events.show[t]);if(e.events.required&&e.events.required.length>0)for(let t in e.events.required)b(e,e.events.required[t],!1);if(e.events.disabled&&e.events.disabled.length>0)for(let t in e.events.disabled)v(e,e.events.disabled[t]);i&&i.enabled(!0),"save"in l&&c(e,l.save,!1,i,l.name)?fe(e,!1).done(o):"function"==typeof o&&o()}function z(e,t){let n=t.data("def"),a=m(e.data,t.attr("data-bind"));n.focus&&f(e,n.focus,a,n.name)}function j(e,t){let n=t.data("def"),a=m(e.data,t.attr("data-bind"));n.blur&&f(e,n.blur,a,n.name)}function A(t,n){if("buttons"in n){let a=e("<div>").addClass(t.settings.styleClasses.buttonGroup),i=Object.assign({},n);for(x in delete i.buttons,n.buttons)a.append(A(t,e.extend({},i,n.buttons[x])));return a}let a=e('<button type="button">').addClass(t.settings.styleClasses.button).addClass(n.class||"btn-default").data("def",n);switch("label"in n||(n.label="Button"),a.html(h(t,n.label,null,!0,!0)),n.action){case"update":a.click(function(){C(t,a)});break;case"link":a.click(function(){document.location=s(t,n.url)});break;default:let e=n.action?n.action:n.change?n.change:n.click;a.click(function(){f(t,e,null,n.name)})}return n.nolabel=!0,a}function O(t,a,i){let l=i.data("def"),r=m(t.data,l.name);if(null===a||Array.isArray(a)&&0===a.length)return r.empty(),r.enabled(!1),C(t,l.name,!0),i.parent().hide();let s=r.save(!0);if(s){let e=s.filter(function(e){return!(e in a)});for(let t in e)r.remove(e[t])}let f=function(){let n=e(this.childNodes[0]).data("def"),a=o(n,this.childNodes[0].value),i=m(t.data,n.name),l=i.indexOf(a);this.childNodes[0].checked&&-1===l?i.push({__hz_value:a,__hz_label:this.childNodes[1].textContent}):i.unset(l)},p=m(t.data,l.name,!0),h=[],g=l.options.value||"value",b=l.options.label||"label",y=!0===l.protected||c(t,l.disabled,!1,r,l.name);if(a=u(a,g,b,l),"sort"in l.options&&("boolean"==typeof l.options.sort&&(l.options.sort=b),a=d(a,l.options.sort,b)),!0===l.buttons){let t=l.class||"primary";for(let n in a){let i=o(l,a[n][g]),s=a[n][b],d=r.indexOf(i)>-1,u=l.name+"_"+i;h.push(e('<label class="btn">').addClass("btn-"+t).html([e('<input type="checkbox" autocomplete="off">').attr("name",u).attr("value",i).prop("checked",d).toggleClass("active",d).prop("disabled",y).attr("data-bind-value",i).data("def",l),s]).toggleClass("active",d).change(f))}return i.addClass("btn-group").addClass("btn-group-toggle").attr("role","group").attr("aria-label",l.label).html(h).parent().show()}"columns"in l||(l.columns=1),l.columns>6&&(l.columns=6);let v=Math.floor(12/l.columns),w=Math.ceil(Object.keys(a).length/l.columns),k=e('<div class="row">'),_=0;for(let t=0;t<l.columns;t++)h.push(e("<div>").addClass("col-md-"+v).toggleClass("custom-controls-stacked",l.inline));for(let i in a){let r=o(l,a[i][g]),s=a[i][b],d=n(),u=p instanceof dataBinderArray&&p.indexOf(r)>-1,c=(l.name,e("<div>").addClass(t.settings.styleClasses.chkDiv).html([e('<input type="checkbox">').addClass(t.settings.styleClasses.chkInput).attr("id",d).attr("value",r).prop("checked",u).prop("disabled",y).data("def",l),e("<label>").addClass(t.settings.styleClasses.chkLabel).html(s).attr("for",d)]).attr("data-bind-value",r).change(f));"css"in l&&c.css(l.css),h[_].append(c),h[_].children().length>=w&&_++}return r.enabled(!0),C(t,l.name,!0),i.html(k.html(h)).parent().show()}function q(n,a,i,l){let r={};return Object.assign(r,a),!1===(r.url=h(n,r.url,{site_url:hazaar.url()}))?O(n,null,i):(!0===l&&de(n),r.url=s(n,r.url),e.ajax(r).done(function(e){if("object"!=typeof i.data("def"))return ue(n);O(n,e,i),ue(n)}).fail(t),!0)}function T(e,t,n,a){if(null!==t&&"object"==typeof t&&"url"in t){let i=t.url.match(/\{\{[\w\.]+\}\}/g),l=n.data("def");for(let a in i){let r=i[a].substr(2,i[a].length-4);r in l.watchers||(l.watchers[r]=[]),l.watchers[r].push(e.data.watch(r,function(n,a,i){q(e,t,i,!1)},n))}return q(e,t,n,a)}if(t instanceof dataBinderValue){let a="object"==typeof t.value?t.value:"object"==typeof t.other?t.other:null;return O(e,a,n)}return O(e,t,n),!0}function B(t,n){let a=e("<div>").data("def",n);if(!0===n.buttons?a.addClass("btn-group").attr("data-bind",n.name).attr("data-toggle","buttons").toggleClass("btn-group-justified",!0===n.justified):a.attr("data-bind",n.name).attr("data-toggle","checks"),n.watchers={},"string"==typeof n.options){let e=n.options.match(/^\{\{([\w\.]+)\}\}$/);null!==e?(t.data.watch(e[1],function(e,n,a){T(t,"object"==typeof n.value?n.value:"object"==typeof n.other?n.other:null,a)},a),n.options=m(t.data,e[1])):n.options={url:n.options}}return F(t,n,a,null,function(e,n){T(t,n,e,!0)}),a}function S(t,a,i,l,r){let o=l.data("def"),s=a.value||"value",d=a.label||"label";for(x in i=u(i,s,d,o),i){if("filter"in a&&-1===a.filter.indexOf(i[x][d])||"__spacer__"===i[x][s]){delete i[x];continue}let r=n(),u=e('<input type="radio" class="custom-control-input">').attr("id",r).attr("name",o.name).attr("value",i[x][s]).attr("data-bind",o.name).data("def",o),f=e('<div class="custom-control custom-radio">').html([u,e('<label class="custom-control-label">').attr("for",r).html(d.indexOf("{{")>-1?h(null,d,i[x],!0):i[x][d])]).appendTo(l);!0===o.horizontal&&f.addClass("custom-control-inline"),u.change(function(n){return _(t,e(n.target))}).on("update",function(n,a,i,l){return C(t,e(n.target),!1,l)})}return l}function N(t,n,a,i,l){let r=m(t.data,i.attr("data-bind")),s=i.data("def");if(i.prop("disabled",!(!0!==s.disabled&&!0!==s.protected)),null===a||"object"!=typeof a||Array.isArray(a)&&0===a.length||0===Object.keys(a).length)return!0!==l&&p(t,s),r&&r.enabled(!1),C(t,s.name,!0),i.empty().prop("disabled",!0);let f=n.value||"value",g=n.label||"label";i.empty().append(e("<option>").attr("value","").html(h(t,s.placeholder,null,!0,!0))),a=u(a,f,g,s),"sort"in n&&("boolean"==typeof n.sort&&(n.sort=g),a=d(a,n.sort,g,f));let b=r&&null===r.value&&"default"in n?n.default:null;for(let t in a){if("filter"in n&&-1===n.filter.indexOf(a[t][g])){delete a[t];continue}let l=e("<option>").attr("value",a[t][f]).html(g.indexOf("{{")>-1?h(null,g,a[t],!0):a[t][g]).appendTo(i);"__spacer__"===a[t][f]&&l.prop("disabled",!0).addClass("form-select-spacer"),"other"in n&&"string"==typeof n.other&&l.data("other",n.other.indexOf("{{")>-1?h(null,n.other,a[t],!0):a[t][n.other]),null!==b&&a[t][g]===b&&r.set(a[t][f],a[t][g],a[t][n.other])}if(r){"other"in s&&!0===c(t,s.other,null,r,s.name)&&(i.append(e("<option>").attr("value","__hz_other").html("Other")),null===r.value&&null!==r.other&&i.val("__hz_other").change());let l=null!==r.value?r.value.toString():null;if(l&&a.find(function(e,t,n){return e&&e[f].toString()===l}))i.val(l),C(t,i);else if(r.value=null,1===Object.keys(a).length&&!0===n.single){let e=a[Object.keys(a)[0]],t=o(s,e[f]);r.value!==t&&(r.set(t,g.indexOf("{{")>-1?h(null,g,e,!0):e[g]),"other"in n&&n.other in e&&(r.other=e[n.other]))}r.enabled(!0)}return i}function D(n,a,i,l,r,o){let d={};return Object.assign(d,a),!1===(d.url=h(n,d.url,r))?o(n,a,null,i):(!1!==l&&i.prop("disabled",!0).html(e("<option value selected>").html("Loading...")),d.url=s(n,d.url),e.ajax(d).done(function(e){"object"==typeof i.data("def")&&o(n,a,e,i)}).fail(t))}function $(e,t,n,a,i,l){if("string"==typeof t){let l=t.match(/^\{\{([\w\.]+)\}\}$/);null!==l?(e.data.watch(l[1],function(t,n,l){$(e,n,l,a,i)},n),t=m(e.data,l[1])):t={url:t}}if("function"!=typeof l&&(l=N),t instanceof dataBinderValue){let a="object"==typeof t.value?t.value:"object"==typeof t.other?t.other:null;return l(e,{},a,n,!a)}if(!(null!==t&&"object"==typeof t&&"url"in t))return l(e,t,t,n);let r=t.url.match(/\{\{[\w\.]+\}\}/g),o=n.data("def");for(let a in r){let s=r[a].substr(2,r[a].length-4);s in o.watchers||(o.watchers[s]=[]),void 0===i&&(i=e.data),o.watchers[s].push(i.watch(s,function(n,a,r){D(e,t,r,!0,i,l)},n))}return D(e,t,n,a,i,l)}function F(e,t,n,a,i){if(!("options"in t))return!1;let l={};if(Array.isArray(t.options)){for(let n in t.options)if("object"==typeof t.options[n]&&"when"in t.options[n]&&c(e,t.options[n].when,null,a,t.name)){l="items"in t.options[n]?t.options[n].items:t.options[n];break}if(n&&"watch"in t){let l=function(l,r,o){m(a,t.name).value=null,"function"==typeof i&&i(n,F(e,t,null,r))};for(x in t.watch)"item."===t.watch[x].substr(0,5)&&a?a.watch(t.watch[x].substr(5),l):(a=e.data,e.data.watch(t.watch[x],l))}}else l=t.options;return"function"==typeof i&&i(n,l),l}function L(t,n,a){if(!0===n.radios){let i=e("<div>").addClass(t.settings.styleClasses.group).data("def",n);return!1!==a&&F(t,n,i,ud,function(e,n){$(t,n,e,ud,ud,S)}),i}let i=e('<div class="input-group">'),l=e("<select>").addClass(t.settings.styleClasses.input).attr("name",n.name).data("def",n).attr("data-bind",n.name).appendTo(i);return n.protected?l.prop("disabled",!0):l.focus(function(n){return z(t,e(n.target))}).blur(function(n){return j(t,e(n.target))}).change(function(n){return _(t,e(n.target))}).on("update",function(n,a,i,l){return C(t,e(n.target),!1,l)}),n.watchers={},"placeholder"in n||(n.placeholder=t.settings.placeholder),!1!==a&&F(t,n,l,null,function(e,n){$(t,n,e)}),i}function M(t,a){let i=m(t.data,a.name),l=e("<div>").addClass(t.settings.styleClasses.chkDiv),r=n(),o=e('<input type="checkbox">').addClass(t.settings.styleClasses.chkInput).attr("name",a.name).attr("id",r).attr("data-bind",a.name).attr("checked",!!i&&i.value).data("def",a).appendTo(l);return a.protected?o.prop("disabled",!0):o.focus(function(n){return z(t,e(n.target))}).blur(function(n){return j(t,e(n.target))}).change(function(n){return _(t,e(n.target))}).on("update",function(n,a,i,l){return C(t,e(n.target),!1,l)}),e("<label>").addClass(t.settings.styleClasses.chkLabel).html(h(t,a.label,null,!0,!0)).attr("for",r).appendTo(l),a.nolabel=!0,l}function E(t,n){let a=m(t.data,n.name),i=e('<div class="date">').addClass(t.settings.styleClasses.inputGroup),l=e("<input>").addClass(t.settings.styleClasses.input).attr("type","datetime"===n.type?"datetime-local":"date").attr("name",n.name).attr("data-bind",n.name).data("def",n).val(a).appendTo(i);n.protected?l.prop("disabled",!0):l.focus(function(n){return z(t,e(n.target))}).blur(function(n){return j(t,e(n.target))}).change(function(n){return _(t,e(n.target))}).on("update",function(n,a,i,l){return C(t,e(n.target),!1,l)});e("<div>").addClass(t.settings.styleClasses.inputGroupAppend).html(e('<span style="cursor: pointer;">').addClass(t.settings.styleClasses.inputGroupText).html(_hz_icon("calendar").click(function(){l.focus()}))).appendTo(i);return n.format&&("local"===n.format&&(n.format=Date.getLocalDateFormat()),n.__datepicker_options=e.extend({format:n.format,autoclose:!0,forceParse:!0,language:"en",clearBtn:!("required"in n)||c(t,n.required,!1,a),todayHighlight:!0,updateViewDate:!0},n.dateOptions),l.attr("type","text").attr("data-bind-label","true").datepicker(n.__datepicker_options),a&&a.value&&(a.enabled(!1),l.datepicker("setDate",new Date(a.value)),a.enabled(!0)),n.placeholder||(n.placeholder=n.format)),n.placeholder&&l.attr("placeholder",n.placeholder),i}function G(n,a){let i=m(n.data,a.name),l=e("<div>").attr("data-bind",a.name).data("def",a).attr("name",a.name).fileUpload({name:a.name,multiple:a.multiple||!1,btnClass:a.btnClass||"btn btn-default",btnLabel:a.btnLabel||"Select",height:a.height||null,accept:a.accept||null,maxSize:a.maxSize||n.settings.maxUploadSize||null,autoAdd:!1,autoRemove:!1,select:function(e){for(let t in e)n.deloads=n.deloads.filter(function(n){if(n.field!==a.name||n.file.name!==e[t].name)return n}),n.uploads.push({field:a.name,file:e[t]}),i.push(pe(e[t]),!0);C(n,l)},remove:function(e){return e=pe(e),n.uploads=n.uploads.filter(function(t){if(t.field!==a.name||t.file.name!==e.name)return t}),n.deloads.push({field:a.name,file:e.name}),i.unset(i.indexOf(function(t){return t.name.value===e.name}),!0),C(n,l),!0}}).on("push",function(e,t,n){l.fileUpload("add",n.save())}).on("pop",function(e,t,n){l.fileUpload("remove",n.save())});return ge(n,"fileinfo",{field:a.name},!0).done(function(e){if(!e.ok)return;let t=m(n.data,e.field);t.empty();for(let a in e.files)n.deloads.findIndex(function(t){return t.field===e.field&&t.file===e.files[a].name})<0&&t.push(pe(e.files[a]));for(let a in n.uploads)n.uploads[a].field===e.field&&t.push(pe(n.uploads[a].file))}).fail(t),l}function I(t,n){let i=m(t.data,n.name),l=e("<div>").addClass(t.settings.styleClasses.inputGroup),r=e('<input type="text">').addClass(t.settings.styleClasses.input).attr("data-bind",n.name).attr("data-bind-label",!0).data("def",n).attr("autocomplete","off").appendTo(l);return n.protected?r.prop("disabled",!0):r.focus(function(n){z(t,e(n.target))}).on("blur",function(n){let a=e(this),l=a.parent().parent().children(".form-lookup-popup"),r=a.data("def");i=m(t.data,a.attr("data-bind")),i||(i=m(t.data,a.parent().parent().parent().parent().data("item").attrName)[a.next().attr("name")]),l.length>0?(l.css({opacity:"0"}),setTimeout(function(){l.hide().empty(),!0!==r.lookup.autocomplete&&a.val(i.label)},500)):!0!==r.lookup.autocomplete&&a.val(i.label)}),e('<input type="hidden">').attr("data-bind",n.name).attr("name",n.name).data("def",n).appendTo(l).on("update",function(n,a,i,l){C(t,e(n.target),!1,l)}),n.lookup&&"url"in n.lookup&&r.on("keyup",function(i){if(32===i.keyCode)return;let l=e(this),r=m(t.data,l.attr("data-bind"));if(""===i.target.value)return r.empty();if(!0===n.lookup.autocomplete&&r.set(l.val(),l.val()),i.keyCode>47)delay(function(){let r="",o=l.parent().parent().children(".form-lookup-popup"),d=m(t.data,l.attr("data-bind")),f=n.lookup.value||"value",c=n.lookup.label||"label";if(d||(d=m(t.data,l.parent().parent().parent().parent().data("item").attrName)[l.next().attr("name")]),0===o.length&&(o=e('<div class="form-lookup-popup card">').hide().appendTo(l.parent().parent()).on("click",function(t){let a=e(t.target),i=a.data("lookup");if(!a.is(".list-group-item")||"string"!=typeof a.attr("data-value"))return!1;d.set(a.attr("data-value"),a.text(),"other"in n.lookup&&n.lookup.other in i?i[n.lookup.other]:null),o.hide()})),"startlen"in n.lookup&&i.target.value.length<n.lookup.startlen)return o.hide();let p={__input__:i.target.value},g=o.children("ul");0===g.length&&(g=e('<ul class="list-group">').appendTo(o)),!1!==(url=h(t,n.lookup.url,p))&&("query"in n.lookup&&!1===(r=h(t,n.lookup.query,p))||(o.css({"min-width":l.parent().outerWidth(),opacity:"1"}),!0!==n.lookup.autocomplete&&g.html(e('<li class="list-group-item">').html("Loading results...")),g.children().length>0&&o.show(),e.ajax({method:n.lookup.method||"GET",url:s(t,url),data:r}).always(function(){!0!==n.lookup.autocomplete&&g.empty()}).done(function(t){if("dataKey"in n.lookup&&n.lookup.dataKey in t&&(t=R(t,n.lookup.dataKey,!0)),t=u(t,f,c,n),"extra"in n.lookup&&e.merge(t,n.lookup.extra),Object.keys(t).length>0){!0===n.lookup.autocomplete&&g.empty();for(let n in t)g.append(e('<li class="list-group-item">').html(a(t[n],c)).attr("data-value",a(t[n],f)).data("lookup",t[n]));1===Object.keys(t).length?g.children().first().click():!0===n.lookup.autocomplete&&o.show()}else!0===n.lookup.autocomplete?(g.empty(),o.hide()):g.html(e('<li class="list-group-item">').html("No results..."))}).fail(function(t){g.html(e('<li class="list-group-item">').html("Error "+t.status+": "+t.statusText))})))},t.settings.lookup.delay);else{let e="bg-primary",t=l.parent().parent().children(".form-lookup-popup").children(".list-group"),n=t.children("."+e);switch(i.key){case"ArrowDown":n.length>0?n.next().length>0&&n.removeClass(e).next().addClass(e):t.children().first().addClass(e);break;case"ArrowUp":n.prev().length>0?n.removeClass(e).prev().addClass(e):n.addClass(e);break;case"Home":n.removeClass(e),t.children().first().addClass(e);break;case"End":n.removeClass(e),t.children().last().addClass(e);break;case"Enter":n.click();break;case"Escape":t.parent().hide().empty();break;case"Backspace":if(""!==l.val())break;case"Delete":r.empty()}i.preventDefault(),i.stopPropagation()}}),"placeholder"in n&&r.attr("placeholder",n.placeholder),n.protected||l.append(e("<div>").addClass(t.settings.styleClasses.inputGroupAppend).html(e("<span>").addClass(t.settings.styleClasses.inputGroupText).html(_hz_icon("search")))),l}function P(t,n){let a=m(t.data,n.name),i="$",l=e('<input type="text">').addClass(t.settings.styleClasses.input),r=e("<div>").addClass(t.settings.styleClasses.inputGroup),o=e("<div>").addClass(t.settings.styleClasses.inputGroupPrepend),s=e("<div>").addClass(t.settings.styleClasses.inputGroupAppend);if(l.attr("name",n.name).attr("data-bind",n.name+".amt").data("def",n).val(a.amt).inputmask("currency",{prefix:""}),"currencies"in n){let e=n.currencies.find(function(e,t,n){if(e.currencycode===a.currency.value)return!0});i=e.symbol}if(r.append([o.html(e("<span>").addClass(t.settings.styleClasses.inputGroupText).html(i)),l,s]),"currencies"in n&&n.currencies.length>1){let i=e('<div class="dropdown-menu">');for(x of(n.currencies.sort(function(e,t){return e.code===t.code?0:e.code<t.code?-1:1}),n.currencies))i.append(e('<div class="dropdown-item">').html(x.code+" - "+x.name).attr("data-currency",x.code));s.html([e('<button class="btn btn-outline-secondary dropdown-toggle" type="button" data-toggle="dropdown">').html(a.currency.value),i]),i.on("click",function(n){let a=m(t.data,e(this).parent().parent().children("input").attr("data-bind"));if(!a)return!1;let i=e(n.target).attr("data-currency");e(this).parent().children("button").html(i),a.parent.currency=i}),a.watch("currency",function(e,t){let i=n.currencies.find(function(e,t,n){if(e.code===a.currency.value)return!0});o.children("span").html(i.symbol)})}else s.html(e("<span>").addClass(t.settings.styleClasses.inputGroupText).html(a.currency.value));return n.protected?l.prop("disabled",!0):l.focus(function(n){return z(t,e(n.target))}).blur(function(n){return j(t,e(n.target))}).change(function(n){return _(t,e(n.target))}).on("update",function(n,a,i,l){return C(t,e(n.target),!1,l)}),r}function V(t,n,a){let i=e("<div>").addClass(t.settings.styleClasses.inputGroup),l=null,r=m(t.data,a.name);return a.multiline?(l=e("<textarea>").addClass(t.settings.styleClasses.input),"height"in a&&l.css("height",a.height)):l=e("<input>").addClass(t.settings.styleClasses.input).attr("type",n),l.attr("name",a.name).attr("data-bind",a.name).data("def",a).val(r instanceof dataBinderValue?r.value:r),a.protected?l.prop("disabled",!0):l.focus(function(n){return z(t,e(n.target))}).blur(function(n){return j(t,e(n.target))}).change(function(n){return _(t,e(n.target))
}).on("update",function(n,a,i,l){return C(t,e(n.target),!1,l)}),"text"===n&&"validate"in a&&"maxlen"in a.validate&&l.attr("maxlength",a.validate.maxlen),"format"in a&&l.attr("type","text").inputmask(a.format),"placeholder"in a&&l.attr("placeholder",a.placeholder),a.prefix&&i.append(e("<div>").addClass(t.settings.styleClasses.inputGroupPrepend).html(e("<span>").addClass(t.settings.styleClasses.inputGroupText).html(h(t,a.prefix,null,!0,!0)))),i.append(l),a.suffix&&i.append(e("<div>").addClass(t.settings.styleClasses.inputGroupAppend).html(e("<span>").addClass(t.settings.styleClasses.inputGroupText).html(h(t,a.suffix,null,!0,!0)))),r&&r.value&&te(t,l),i}function U(e,t){if(Array.isArray(e)){for(let t in e)e[t]=U(e[t]);return e}if("fields"in e){for(let n in e.fields)e.fields[n]=U(e.fields[n],(t||e.name)+"."+n);return e}return{html:'<div data-bind="'+(t||e.name)+'">',weight:e.weight||1}}function J(t,n){let a=m(t.data,n.name),i=e('<div class="itemlist">').addClass(t.settings.styleClasses.group);if(!(a instanceof dataBinderArray))return i;"label"in n&&(e("<h4>").addClass(t.settings.styleClasses.label).html(h(t,n.label,null,!0,!0)).appendTo(i),n.nolabel=!0),"arrayOf"in n&&!("fields"in n)&&(n.fields={__list_value:e.extend(!0,{},{required:n.required,disabled:n.disabled},"object"==typeof n.arrayOf?n.arrayOf:{type:n.arrayOf})});let l=n.fields&&"label"in n.fields[Object.keys(n.fields)[0]],r=K(t,n.fields,n.layout),o=e('<div class="itemlist-item">');if(!0!==t.viewmode&&c(t,n.allow_remove,!0,a,n.name)&&o.append(e('<div class="itemlist-item-rm">').html([!0===n.allow_edit&&l?e("<label>").html("&nbsp;").addClass(t.settings.styleClasses.label):"",e('<button type="button" class="btn btn-danger btn-sm">').html(_hz_icon("minus"))])),!0!==t.viewmode&&c(t,n.allow_add,!0,a,n.name)){let o=Ce(ud,t),s=new dataBinder(ye(n.fields),n.name,null,n.name);o.settings=e.extend({},e.fn.hzForm.defaults,t.settings),o.validate=!1,o.data=s,o.def={fields:n.fields};let d=e('<button type="button" class="btn btn-success btn-sm">').html(_hz_icon("plus")),u=Q(o,{fields:r},!0,ud,ud,ud,!0).addClass("itemlist-newitem").attr("data-field",n.name);u.find("input,textarea,select").attr("data-bind-ns",n.name).keypress(function(t){13===t.which&&e(t.target).parent().parent().parent().children(".itemlist-newitem-add").children("button").click()}),u.find("select").each(function(t,n){let a=e(n),i=a.data("def");a.off("change").on("change",function(){return _(o,e(this))}).off("update").on("update",function(t,n,a,i){return C(o,e(this),!1,i)}),"options"in i&&F(o,i,a,s,function(e,t){$(o,t,e)})}),i.append(e('<div class="itemlist-newitems">').html([e('<div class="itemlist-newitem-add">').html([l?e("<label>").html("&nbsp;").addClass(t.settings.styleClasses.label):"",d]),u])),d.click(function(){let t=!0;u.find("input,select,textarea").each(function(n,a){if(!a.name)return;let i=e(a),l=null,r=i.data("def"),s=m(o.data,i.attr("data-bind"));if(l=i.is("[type=checkbox]")?i.is(":checked"):i.val(),s&&s.attrName in o.required&&!0===o.required[s.attrName]&&!l)return i.toggleClass("is-invalid",!0),void(t=!1);if(i.is("select"))l={__hz_value:l,__hz_label:i.children("option:selected").text()};else if("date"===r.type&&"format"in r){let e=i.datepicker("getDate");l=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()}let d=m(o.data,a.name,!1,l);d&&d.set(l,null,null,!1)}),!0===t&&(a.push(o.data.save()),o.data.empty())})}return!0!==t.viewmode&&!0===c(t,n.allow_edit,!1,a,n.name)||(r=U(r)),o.append(Q(t,{fields:r},!0,!1,!1,ud,!0)),a.watch(function(a){let i=a.attr("data-bind"),l=m(t.data,i);a.find("select,input").each(function(n,a){let i=e(a),r=i.data("def");if(i.is("select"))"options"in r&&F(t,r,i,l,function(e,n){$(t,n,e,!1,l)});else if("date"===r.type&&"format"in r){let e=l[r.name];i.data("datepicker",null),i.datepicker(r.__datepicker_options),e&&e.value&&i.datepicker("setDate",new Date(e.value))}}),e(a).find(".form-group,.form-section").each(function(n,a){let r=e(a),o=r.data("def");if(!o||!o.name)return;let s=m(l,o.name);s&&(r.data("name",i+"."+o.name).data("item",s.attrName),r.find("label").each(function(e,t){t.attributes.for.value=i.replace(/\[|\]/g,"_")+o.name}),"disabled"in o&&y(t,o,r),"required"in o&&g(t,o,r),"show"in o&&w(t,o,r))}),"disabled"in n&&y(t,n,e(a).parent().parent())}),i.append(e('<div class="itemlist-items" data-bind-template="o">').attr("data-bind",n.name).data("template",o)).data("def",n).data("item",a).on("click",".btn-danger",function(t){let n=Array.from(this.parentNode.parentNode.parentNode.children).indexOf(this.parentNode.parentNode),i=e(t.currentTarget.parentNode.parentNode.parentNode);a.unset(n),i.find("input,textarea,select").each(function(t,n){let a=e(n);a.parent().data("item",a.attr("data-bind"))})}),i}function R(t,n,a){if(n instanceof Object)t="name"in n?e.extend(R(t,n.name),n):n;else{let i=n.split(/[\.\[]/);for(let e in i){if(t&&"type"in t&&"money"===t.type&&"amt"===i[e])break;if("]"!==i[e].slice(-1)){if(!0!==a){if(!("fields"in t))return null;t=t.fields}if(!(i[e]in t))return null;t=t[i[e]]}}!0!==a&&(t=e.extend(!0,t,{name:n}))}return t}function H(e,t){let n=/\{\{(\w*)\}\}/g,a=function(t,n){return"{{"+e+"."+n+"}}"};if(Array.isArray(t.options))for(let n in t.options)H(e,t.options);else"object"==typeof t.options&&"url"in t.options?t.options.url=t.options.url.replace(n,a):"string"==typeof t.options&&(t.options=t.options.replace(n,a))}function K(t,n,a,i,l){a||(a=Array.isArray(n)?e.extend(!0,[],n):Object.keys(n));for(let r in a)if("string"==typeof a[r]&&(a[r]={name:a[r]}),"object"==typeof a[r])if(Array.isArray(a[r]))a[r]={fields:K(t,n,a[r],i,l)};else if("name"in a[r]){let o=a[r].name in n?n[a[r].name]:a[r].name in t.def.fields?t.def.fields[a[r].name]:null;if(!o||!0===o.hidden)continue;a[r]=e.extend(!0,{},o,a[r]),i&&(a[r].name=i+(l?"["+a[r].name+"]":"."+a[r].name),"options"in a[r]&&H(i,a[r]))}else"fields"in a[r]&&("layout"in a[r]||(a[r].layout=Array.isArray(a[r].fields)?e.extend(!0,[],a[r].fields):Object.keys(n)),a[r].fields=K(t,n,a[r].layout,i,l));return a}function Q(t,n,a,i,l,r,o){let s=null,d=null;if(n instanceof Array&&(n={fields:n}),s=R(t.def,n)){if(!r&&"name"in s&&s.name&&(r=m(t.data,s.name)),"name"in s&&"default"in s&&r instanceof dataBinderArray&&null===r.value&&(r.value=s.default),"horizontal"in s&&(a=s.horizontal),"render"in s){if(d=f(t,s.render,r,s.name),!d)return;!0!==o&&s.name&&t.pageFields.push(s.name)}else if("fields"in s&&"array"!==s.type){let u,f=K(t,s.fields,"layout"in s?e.extend(!0,[],s.layout):null,s.name),c=f.length,p=[];null==a&&(a=!t.settings.horizontal&&!("layout"in s&&s.layout));for(let e in f){let i=f[e];"string"==typeof i&&(i=R(t.def,i)),i&&(a&&!Array.isArray(i)&&("weight"in i||(i.weight=1),c+=i.weight-1),!0!==n.protected||"object"!=typeof i||Array.isArray(i)||(i.protected=!0),p.push(i))}u=12/c,d=e('<div class="form-section">').toggleClass("row",a).data("def",s),"label"in s&&d.append(e("<div>").toggleClass("col-md-12",a).html(e("<h5>").html(s.label)));for(let e in p){let n="name"in p[e]?r instanceof dataBinder?r[p[e].name]:void 0:r,s=u,f=Q(t,p[e],!a,i,l,n,o);p[e]instanceof Object&&"weight"in p[e]&&(s=Math.round(s*p[e].weight)),d.append(f.toggleClass("col-md-"+s,a)),a&&f.removeClass("row")}}else{var u;if(s.nolabel=!1,!0===t.viewmode)if(r instanceof dataBinderArray)u=J(t,s);else{if("button"===s.type)return;u=e("<span>").attr("data-bind",r?r.attrName:"").html(r?r.toString():"")}else if("options"in s)u="array"===s.type?B(t,s):L(t,s,i);else if("lookup"in s&&"array"!==s.type)"string"==typeof s.lookup&&(s.lookup={url:s.lookup}),u=I(t,s);else if(s.type)switch(s.type){case"button":u=A(t,s);break;case"array":u=J(t,s);break;case"boolean":u=M(t,s);break;case"int":case"integer":case"number":u=V(t,"number",s);break;case"date":case"datetime":u=E(t,s);break;case"file":u=G(t,s);break;case"money":u=P(t,s);break;case"text":case"string":default:u=V(t,s.type,s)}if(!0!==o&&s.name&&t.pageFields.push(s.name),d=e("<div>").addClass(t.settings.styleClasses.group).toggleClass("row",t.settings.horizontal).data("def",s),(s.title||!0!==s.nolabel&&s.label)&&d.append(e("<label>").addClass(t.settings.styleClasses.label).toggleClass("col-sm-"+t.settings.hz.left,t.settings.horizontal).attr("for","__hz_field_"+s.name).html(h(t,"title"in s?s.title:s.label,null,!0,!0))),u){let n=e('<div class="form-field">').html(u);t.settings.horizontal&&(s.label?n.addClass("col-sm-"+t.settings.hz.right):n.addClass("col-sm-12")),"hint"in s&&n.append(e('<small class="form-text text-muted">').html(h(t,s.hint,null,!0,!0))),"css"in s&&u.css(s.css),"cssClass"in s&&u.addClass(s.cssClass),d.append(n)}}if(d.data("def",s).data("item",r||null),"width"in s&&d.width(s.width),"html"in s){let n=s.html;"label"in s&&0===d.children().length&&d.append(e("<label>").addClass(t.settings.styleClasses.label).html(s.label)),d.append(e("<div>").html(h(t,n,null,!0,!0)))}if("show"in s&&!1!==l&&w(t,s,d),"watch"in s)for(let e in s.watch)t.data.watch(s.watch[e],function(e){C(t,e)});return!0===t.viewmode?d:("tip"in s&&d.children("label.control-label").append(_hz_icon("question-circle").addClass("form-tip").attr("data-title",s.tip).tooltip({placement:"auto",html:!0})).on("show.bs.tooltip",function(n){let a=e(this).children(".form-tip");a.attr("data-original-title",h(t,a.attr("data-title"),null,!0,!1)).tooltip("_fixTitle")}),"required"in s&&!1!==l&&g(t,s,d),"disabled"in s&&!1!==l&&y(t,s,d),"invalid"in s&&d.append(e('<div class="invalid-feedback">').html(s.invalid)),d)}}function Y(t,n,a){let i=e("<div>");if(Array.isArray(n)){let l=null;if(void 0===a&&(a=!0),a){i.addClass("row");let e=n.length;for(let t in n)"object"!=typeof n[t]||Array.isArray(n[t])||("weight"in n[t]||(n[t].weight=1),e+=n[t].weight-1);l=12/e}for(let r in n)i.append(e("<div>").toggleClass("col-md-"+Math.round((n[r].weight||1)*l),a).html(Y(t,n[r],!a)));return i}if("object"!=typeof n)return null;let l=e('<fieldset class="col col-12">').data("def",n).appendTo(i);n.label&&l.append(e("<legend>").html(h(t,n.label,null,!0,!0)));for(let e in n.fields)l.append(Q(t,n.fields[e]));return"show"in n&&w(t,n,l),i.addClass("row")}function W(t,n){if("object"!=typeof n)return null;let a=e("<div>").addClass(t.settings.styleClasses.page).data("def",n),i=[];n.label&&a.append(e("<h1>").html(h(t,n.label,null,!0,!0)));for(let e in n.sections)i.push(Y(t,n.sections[e]));if(t.events.show.length>0)for(let e in t.events.show)k(t,t.events.show[e]);return a.append(i)}function X(e,t){e.page=t,e.events={show:[],required:[],disabled:[],change:{}},e.eval_cache=null,e.pageFields=[],e.data.unwatchAll()}function Z(t,n){t.objects={loader:e('<div class="forms-loader-container">').html(e("<div>").addClass(t.settings.loaderClass)),container:e("<div>").addClass(t.settings.styleClasses.container).hide()},e(t).html([t.objects.loader,t.objects.container])}function ee(t,n,a,i){if(!0!==i&&n===t.page)return!1;let l=function(t,n){if(de(t),t.objects.container.empty(),t.settings.singlePage){X(t,0);for(let e in t.def.pages)t.objects.container.append(W(t,t.def.pages[e]))}else X(t,n),t.objects.container.append(W(t,t.def.pages[n])),e(t).trigger("nav",[t.page+1,t.def.pages.length]);t.data.resync(),ue(t),"function"==typeof a&&a()};if(null!==t.page&&n>t.page){let a=t.def.pages[t.page];if("validate"in a)return void se(t).done(function(i,r){!0===i?"save"in a&&c(t,a.save,!1)?fe(t,!1).done(function(){l(t,n)}):l(t,n):e(t).trigger("validate",[i,r])});if("save"in a&&c(t,a.save,!1))return void fe(t,!1).done(function(){l(t,n)})}return l(t,n)}function te(t,n,a){if(!n.is("input,select,textarea"))return n.children("input,select,textarea").each(function(n,i){te(t,e(i),a)});let i=n.attr("data-bind");return i?ie(t,i,{required:!1,disabled:!1}).done(function(l,r,o){!0!==r&&!0===a||(n.toggleClass("is-invalid",!0!==r).toggleClass("border-warning",!0===r&&null!==o&&"object"==typeof o&&!0===o.warning),e(t).trigger("validate_field",[i,!0===r,r]))}):void 0}function ne(t,n,a){let i={name:t,field:e.extend({},n),status:a};return i}function ae(e,t,n,a,i){if(!n||!a||!0!==e.validate)return!0;if("show"in a&&!c(e,a.show,!0,n,a.name))return!0;let l=n instanceof dataBinderArray?n.length>0?n:null:a.other&&!n.value?n.other:n.value;if(t in e.required||(e.required[t]=c(e,a.required,i.required,n,t)),i.required=e.required[t],i.required&&null===l)return ne(t,a,"required");if(null==l)return!0;if("format"in a&&l&&"date"!==a.type&&!Inputmask.isValid(String(l),a.format))return ne(t,a,"bad_format");if("validate"in a)for(let i in a.validate){let r=a.validate[i];switch(i){case"min":if(parseInt(l)<r)return ne(t,a,"too_small");break;case"max":if(parseInt(l)>r)return ne(t,a,"too_big");break;case"with":let o=new RegExp(r);if("string"!=typeof l||!l.match(o))return ne(t,a,"regex_failed");break;case"equals":if(l!==r)return ne(t,a,"not_equal");break;case"minlen":if(n instanceof dataBinderValue&&(!l||l.length<r)||!n||n.length<r)return ne(t,a,"too_short");break;case"maxlen":if(n instanceof dataBinderValue&&(!l||l.length>r)||!n||n.length>r)return ne(t,a,"too_long");break;case"custom":if(!c(e,r,!0))return ne(t,a,"custom")}}return!0}function ie(n,a,i,l){let r=[];return setTimeout(function(){let o="object"==typeof a?a:R(n.def,a);if(o){let a=m(n.data,o.name);a||(o.disabled=!0),o.name in n.disabled||(n.disabled[o.name]="disabled"in o&&c(n,o.disabled,i.disabled,a,o.name)),i.disabled=n.disabled[o.name];let s=!(!o.protected&&!i.disabled)||ae(n,o.name,a,o,i);if("fields"in o){let e="array"===o.type?a.save():[a];if(!0!==s||0===e.length)for(let e in r)r[e](o.name,s,l);else for(let t in e)for(let e in o.fields){"name"in o.fields[e]||(o.fields[e].name=e);let a="array"===o.type?o.name+"["+t+"]."+e:o.name+"."+e;n.queue.push(a),ie(n,a,{required:i.required,disabled:i.disabled},l).done(function(e,t){for(let n in r)r[n](e,t,l)})}}if(a&&a.value&&!0===s&&"validate"in o&&"url"in o.validate){let i=h(n,o.validate.url,{__input__:a.value},!0),l={target:[i,{name:o.name,value:a.value}]},s=JSON.stringify(l).hash(),d=function(e){s in n.apiCache||(n.apiCache[s]=e);let t=!0===e.ok||ne(o.name,o,e.reason||"api_failed("+o.validate.url+")");if(r.length>0)for(let n in r)r[n](o.name,t,e)};s in n.apiCache?d(n.apiCache[s]):!0===n.standalone?e.ajax({method:"POST",url:o.validate.url,contentType:"application/json",data:JSON.stringify(l.target[1])}).done(d).fail(t):ge(n,"api",l,!1).done(d).fail(t)}else if(r.length>0)for(let e in r)r[e](o.name,s,l);if(o.name in n.monitor)for(let e in n.monitor[o.name])n.monitor[o.name][e](s)}else for(let e in r)r[e](a,!0,l)}),{done:function(e){return"function"==typeof e&&r.push(e),this}}}function le(e,t){if(Array.isArray(e)){for(let n in e)if(le(e[n],t))return!0}else{let n="string"==typeof e?e:e.name;if(t.name===n)return!0}return!1}function re(e,t){for(let n in e.def.pages)for(let a in e.def.pages[n].sections)for(let i in e.def.pages[n].sections[a].fields)for(let l in t)if(le(e.def.pages[n].sections[a].fields[i],t[l])){let t=parseInt(n);return void(e.page!==t&&ee(e,t,function(){se(e)}))}}function oe(t,n){let a=[];return t.queue=[],t.required=[],setTimeout(function(){let i=[];if(void 0===n){if(!("def"in t&&"fields"in t.def))return;n=Object.keys(t.def.fields)}for(let l in n)t.queue.push(n[l]),ie(t,n[l],{required:!1,disabled:!1}).done(function(n,l,r){let o=t.queue.indexOf(n);o>=0&&t.queue.splice(o,1),Array.isArray(l)||(l=[{name:n,result:l}]);for(let t in l)!0!==l[t].result&&i.push(l[t].result),e('[data-bind="'+l[t].name+'"]').toggleClass("is-invalid",!0!==l[t].result).toggleClass("border-warning",!0===l[t].result&&null!==r&&"object"==typeof r&&!0===r.warning);if(0===t.queue.length)for(let e in a)a[e](0===i.length,i)})}),{done:function(e){"function"==typeof e&&a.push(e)}}}function se(e){return oe(e,e.pageFields)}function de(e){e.objects.container.hide(),e.objects.loader.show(),e.loading++}function ue(t){t.loading--,t.loading>0||null===t.page||(t.objects.loader.hide(),t.objects.container.show(),e(t).trigger("ready",[t.def]))}function fe(t,n,a){let i={done:null},l=function(t,n){let a=t.data.save(!0===t.standalone);for(let e in t.def.fields)!0===t.def.fields[e].protected&&delete a[e];let l=t.standalone?a:{params:n||{},form:a};"saveURL"in t.settings&&(l.url=t.settings.saveURL),e(t).trigger("saving",[a,l]),t.data.commit(),ge(t,"save",l,!1).done(function(n){if(!n.ok)return e(t).trigger("saverror",[{error:{str:n.reason||"An unknown error occurred while saving the form!"}},n.params]);t.posts={},t.uploads.length>0||t.deloads.length>0?(e(t).trigger("attachStart",[t.uploads,t.deloads]),he(t,function(a,l){e(t).trigger("attachDone",[l]),a?(e(t).trigger("save",[n.result,n.params]),i.done&&i.done()):e(t).trigger("saverror",[{error:{str:"File upload failed"}},n.params,l])})):(e(t).trigger("save",[n.result,n.params]),i.done&&i.done())}).fail(function(n){e(t).trigger("saverror",[n.responseJSON,l])})};return!0===n||void 0===n?oe(t).done(function(n,i){n?l(t,a):(e(t).trigger("saverror",[{error:{str:"Validation failed!"},validation:i}]),e(t).trigger("validate",[n,i]),t.settings.validateNav&&re(t,i))}):l(t,a),{done:function(e){"function"==typeof e&&(i.done=e)}}}function ce(t){e(t).on("submit",function(e){return e.preventDefault(),!1})}function pe(e){if(e instanceof File)e={lastModified:e.lastModified,lastModifiedDate:e.lastModifiedDate,name:e.name,size:e.size,type:e.type,url:URL.createObjectURL(e)};else if(Array.isArray(e))for(x in e)e[x]=pe(e[x]);else{let t=/[^\/]*$/.exec(e.url)[0];e.url=e.url.substr(0,e.url.length-t.length)+encodeURIComponent(t)}return e}function he(t,n){if(t.deloads.length>0){let a={name:t.settings.form,params:t.settings.params,remove:t.deloads};e.ajax({url:hazaar.url(t.settings.controller,"detach"),method:"POST",data:JSON.stringify(a),contentType:"application/json"}).done(function(e){"removed"in e&&(t.deloads=t.deloads.filter(function(t){return!1===e.removed.indexOf(t.file)})),0===t.uploads.length&&n(e.ok)})}if(t.uploads.length>0){let e={pending:[],working:[],attached:[],failed:[]};t.uploads.sort(function(e,t){return e.file.name===t.file.name?0:e.file.name<t.file.name?-1:1}),e.pending=Object.assign([],t.uploads),me(t,e,n)}}function me(t,n,a){for(;n.working.length<t.settings.concurrentUploads;){let i=new FormData,l=n.pending.shift();if(!l)break;n.working.push(l),i.append("name",t.settings.form),i.append("params",JSON.stringify(t.settings.params)),i.append("attachment[field]",l.field),i.append("attachment[file]",l.file),e(t).trigger("fileStart",[l]),e.ajax({type:"POST",data:i,processData:!1,contentType:!1,url:hazaar.url(t.settings.controller,"attach"),upload_file:l,xhr:function(){return xhr=new XMLHttpRequest,xhr.upload.onprogress=function(n){e(t).trigger("fileProgress",[this.file,n])},xhr.upload.file=this.upload_file,xhr}}).done(function(n){let a=this.upload_file;t.uploads=t.uploads.filter(function(e){return!(a.field===e.field&&a.file.name===e.file.name)}),e(t).trigger("fileDone",[a,n])}).fail(function(n){this.upload_file.failed=!0,this.upload_file.response=n.responseJSON,e(t).trigger("fileError",[this.upload_file,n])}).always(function(){let e=this.upload_file;n.working=n.working.filter(function(t){return!(e.field===t.field&&e.file.name===t.file.name)}),!0===e.failed?n.failed.push(e):n.attached.push(e),n.pending.length>0?me(t,n,a):0===n.working.length&&a(0===n.failed.length,n)})}}function ge(t,n,a,i,l){!0===i&&de(t);let r={},o="";if(!0===t.standalone){if(!(n in t.settings.endpoints))return e(t).trigger("error",["Host endpoint "+n+" is unknown!"]);o=t.settings.endpoints[n],r=a}else o=hazaar.url(t.settings.controller,"interact/"+n),r=e.extend(!0,{},{name:t.settings.form,params:t.settings.params},a);return e.ajax({method:"POST",url:o,async:!0!==l,contentType:"application/json",data:JSON.stringify(r)}).always(function(e){!0===i&&ue(t),"data"in e&&console.log(e.data)})}function be(t,n){if("string"==typeof n)return e.get(n).done(function(e){be(t,e)});e(t).find(".is-different").removeClass("is-different"),t.data.diff(n,function(e){e.find().addClass("is-different")})}function ye(e){if(!e)return;let t={};for(let n in e)"fields"in e[n]&&"array"!==e[n].type?t[n]=ye(e[n].fields):(e[n].default||"array"!==e[n].type&&"file"!==e[n].type||(e[n].default=[]),t[n]=e[n].default?e[n].default:null);return t}function ve(t,n,a){let l=["disabled","protected","change","focus","blur"];for(let r in n){let o=a?e.extend(!0,{},a):null;if("string"==typeof n[r]&&(n[r]={type:n[r],label:r}),"type"in n[r]||!("options"in n[r]||"lookup"in n[r]))if("type"in n[r]&&"types"in t.def&&n[r].type in t.def.types){let e=t.def.types[n[r].type];for(i in n[r]=jQuery.extend(!0,{},e,o,n[r]),n[r].type=e.type,n[r].horizontal=!1,o={},l)l[i]in n[r]&&(o[l[i]]=n[r][l[i]])}else"type"in n[r]&&"array"===n[r].type?("arrayOf"in n[r]&&"types"in t.def&&n[r].arrayOf in t.def.types&&(n[r].fields=t.def.types[n[r].arrayOf].fields,delete n[r].arrayOf),"default"in n[r]&&!Array.isArray(n[r].default)&&(n[r].default=[n[r].default])):o&&(n[r]=jQuery.extend(!0,{},o,n[r]));else n[r].type="text";"watch"in n[r]&&!Array.isArray(n[r].watch)&&(n[r].watch=[n[r].watch]),"fields"in n[r]&&ve(t,n[r].fields,o)}}function we(e,n){Array.isArray(n)||(n=[n]);for(let a in n)jQuery.ajax({url:hazaar.url(e.settings.controller,"script/"+n[a]),dataType:"script"}).fail(t)}function ke(n){return ge(n,"init").done(function(t){t.ok&&("form"in t&&(n.def=t.form),"tags"in t&&(n.tags=t.tags),"scripts"in n.def&&we(n,n.def.scripts),ve(n,n.def.fields),n.data=new dataBinder(ye(n.def.fields)),e(n).trigger("load",[n.def]))}).fail(t)}function _e(e){for(x in e)null===e[x]||"object"!=typeof e[x]||"__hz_value"in e[x]?"boolean"==typeof e[x]&&(e[x]={__hz_value:e[x],__hz_label:e[x]?"Yes":"No"}):_e(e[x]);return e}function xe(n){let a=function(t){t.ok&&("horizontal"in n.def&&(n.settings.horizontal=n.def.horizontal),n.data.extend(_e(t.form)),n.data.commit(),e(n).trigger("data",[n.data.save()]),ee(n,0))};!0==(n.standalone="def"in n.settings)?(n.def=n.settings.def,ve(n,n.def.fields),n.data=new dataBinder(ye(n.def.fields)),"load"in n.settings.endpoints?ge(n,"load").done(a).fail(t):"string"==typeof n.settings.data?e.get(n.settings.data).done(function(e){a({ok:!0,form:e})}).fail(t):a({ok:!0,form:n.settings.data}),delete n.settings.def,delete n.settings.data):ke(n).done(function(e){ge(n,"load").done(a).fail(t)})}function Ce(e,t){return void 0===e&&(e={}),e.data={},e.events={show:[],required:[],disabled:[],change:{}},e.posts={},e.viewmode=!1,e.page=null,e.working=!1,e.validate=!0,e.standalone=!1,e.pageFields=[],e.queue=[],e.loading=0,e.uploads=[],e.deloads=[],e.monitor={},e.apiCache={},e.required={},e.disabled={},e.parent=t,e}function ze(t,n){Ce(t),t.settings=e.extend({},e.fn.hzForm.defaults,n),t.viewmode=t.settings.viewmode,t.settings.concurrentUploads<1&&(t.settings.concurrentUploads=1),e(t).trigger("init"),ce(t),Z(t),xe(t),form=t}e.fn.hzForm=function(){let t=arguments,n=this.get(0);switch(t[0]){case"info":let e=n.data.save(),a={};for(let t in e)a[t]={label:n.def.fields[t].label,value:e[t]};return a;case"data":return n.data;case"def":return n.def}return this.each(function(n,a){if(a.settings)switch(t[0]){case"reload":if(!0===t[1])xe(a);else{let e=a.data.save();ke(a).done(function(){for(let t in e)a.data[t]=e[t];ee(a,a.page,null,!0)})}break;case"nav":case"navigate":case"page":ee(a,t[1]);break;case"prev":a.page>0&&ee(a,a.page-1);break;case"next":a.page<a.def.pages.length-1&&ee(a,a.page+1);break;case"save":fe(a,t[1],t[2]).done(function(){!0===a.settings.viewmode&&(a.viewmode=!0,ee(a,a.page,null,!0))});break;case"single":a.settings.singlePage=Boolean(t[1]),ee(a,0);break;case"validate":oe(a).done(function(n,i){e(a).trigger("validate",[n,i]),(void 0!==t[1]||!0!==a.settings.validateNav)&&!1===t[1]||n||re(a,i)});break;case"reset":a.data.reset();break;case"edit":a.viewmode=!1,ee(a,a.page,null,!0);break;case"view":a.viewmode=!0,ee(a,a.page,null,!0);break;case"toggleEdit":a.viewmode=!a.viewmode,ee(a,a.page,null,!0);break;case"monitor":"function"==typeof t[2]&&(a.monitor[t[1]]=[t[2]],ie(a,t[1],{required:!1,disabled:!1}));break;case"diff":be(a,t[1])}else ze(a,t[0])})},e.fn.hzForm.defaults={form:"default",controller:"index",endpoint:"interact",encode:!0,singlePage:!1,horizontal:!1,viewmode:!1,hz:{left:3,right:9},placeholder:"Please select...",loaderClass:"forms-loader",validateNav:!0,lookup:{delay:300,startlen:0,autocomplete:!1},concurrentUploads:2,styleClasses:{container:"forms-container",page:"form-page",group:"form-group",label:"control-label",input:"form-control",inputGroup:"input-group",inputGroupPrepend:"input-group-prepend",inputGroupText:"input-group-text",inputGroupAppend:"input-group-append",chkDiv:"custom-control custom-checkbox",chkInput:"custom-control-input",chkLabel:"custom-control-label",button:"btn",buttonGroup:"btn-group"},endpoints:{}}}(jQuery),$.fn.fileUpload=function(){let e=this.get(0);if(e.options){switch(arguments[0]){case"add":e._add(arguments[1]);break;case"remove":e._remove(arguments[1]);break;case"list":return e.files}return this}return e.files=[],e.options=$.extend({name:"file",multiple:!1,btnClass:"btn btn-default",maxSize:0,autoAdd:!0,autoRemove:!0},arguments[0]),e._isIE=function(){return!!navigator.userAgent.match(/Trident/g)||!!navigator.userAgent.match(/MSIE/g)},e._add=function(t){if(Array.isArray(t)){if(!0===e.options.multiple)for(let e in t)this._add(t[e])}else"object"!=typeof t&&(t={name:t,type:"text/text"}),"lastModifiedDate"in t||(t.lastModifiedDate=new Date(1e3*t.lastModified)),e.files.push(t),e.o.dzwords&&e.o.dzwords.hide(),e.o.list.append($('<div class="dz-item">').html([e._preview(t),$('<div class="dz-size">').html(humanFileSize(t.size)),$('<div class="dz-detail">').html($("<a>").attr("href",t.url).attr("target","_blank").html(t.name).attr("title",t.name)),$('<div class="dz-remove">').html(_hz_icon("times")).click(function(n){let a=$(this).parent();"function"==typeof e.options.remove&&e.options.remove(t),e.options.autoRemove&&e._remove(a.data("file")),n.stopPropagation()})]).data("file",t).click(function(e){e.stopPropagation()}))},e._remove=function(t){return this.files=this.files.filter(function(e){return e.name!==t.name}),e.o.list.children().each(function(e,n){let a=$(n),i=a.data("file");i&&i.name===t.name&&a.remove()}),0===this.files.length&&this.o.dzwords&&this.o.dzwords.show(),!0},e._preview=function(e){let t=$('<div class="dz-preview">');if(e.preview)t.append($("<img>").attr("src",e.preview));else if(e instanceof File&&"image"===e.type.substr(0,5)){let n=new FileReader;n.onload=function(e){t.append($("<img>").attr("src",e.target.result))},n.readAsDataURL(e)}else t.addClass("fileicon").attr("data-type",e.type.replace(/\./g,"_").replace(/\//g,"-"));return t},e._checkexists=function(t){for(let n in e.files)if(e.files[n].name===t.name)return!0;return!1},e._checksize=function(t){return 0===e.options.maxSize||t.size<e.options.maxSize},e._add_files=function(t){let n=[],a=[];if(e.options.multiple||!(e.files.length>0)){for(let i=0;i<t.length;i++){let l=t[i];if(e._checkexists(l))return;e._checksize(l)?(e.options.autoAdd&&e._add(l),n.push(l)):a.push(l)}if(e.o.input.val(null),n.length>0&&"function"==typeof e.options.select&&e.options.select(n),a.length>0){let t=$("<p>");for(let e in a)t.append($("<strong>").html(a[e].name));$("<div>").html([$("<p>").html("Failed to attach the following files:"),t,$("<p>").html("Files were too big as the maximum allowed file size is "+humanFileSize(e.options.maxSize)+".")]).popup({title:"Bad Attachment",icon:"danger",buttons:[{label:"OK",class:"btn btn-danger"}]})}}},e._registerEvents=function(){this.o.dropzone&&(this.o.dropzone.click(function(t){!e.options.multiple&&e.files.length>0||e.o.input.click()}),this.o.dropzone.on("dragenter",function(e){e.preventDefault(),e.stopPropagation()}),this.o.dropzone.on("dragover",function(t){e.o.dropzone.addClass("drag"),t.preventDefault(),t.stopPropagation()}),this.o.dropzone.on("dragleave",function(t){t.preventDefault(),t.stopPropagation(),e.o.dropzone.removeClass("drag")}),this.o.dropzone.on("drop",function(t){t.preventDefault(),t.stopPropagation(),e.o.dropzone.removeClass("drag"),!e.options.multiple&&e.files.length>0||e._add_files(t.originalEvent.dataTransfer.files)})),e._isIE()&&e.o.input.click(function(){setTimeout(function(){e.o.input.val().length>0&&e.o.input.change()},0)}),this.o.input.change(function(t){!e.options.multiple&&e.files.length>0||e._add_files(t.target.files)}),this.options.multiple||this.o.dzwords.click(function(){e.o.input.click()})},e._render=function(e){$(this).addClass("form-fileupload"),this.o={},this.o.input=$('<input type="file" class="form-control">').appendTo(e),e.options.accept&&this.o.input.attr("accept",e.options.accept),this.o.list=$('<div class="dz-items">'),e.options.multiple?(this.o.input.prop("multiple",!0),e.o.dzwords=$('<div class="form-dropzone-words">').html("Drop files here or click to upload."),this.o.dropzone=$('<div class="form-dropzone">').html([this.o.dzwords,this.o.list]).appendTo($(e).addClass("multiple")).toggleClass("single",!e.options.multiple),e.options.height&&this.o.dropzone.height(e.options.height)):(e.o.dzwords=$("<button>").addClass(e.options.btnClass).html(e.options.btnLabel).appendTo($(e)),this.o.list.appendTo($(e).addClass("single")))},e._render(e),e._registerEvents(),this},Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null===this)throw new TypeError('"this" is null or not defined');let t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");let a=arguments[1],i=0;for(;i<n;){let n=t[i];if(e.call(a,n,i,t))return n;i++}},configurable:!0,writable:!0}),Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(e){if(null===this)throw new TypeError('"this" is null or not defined');let t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");let a=arguments[1],i=0;for(;i<n;){let n=t[i];if(e.call(a,n,i,t))return i;i++}return-1},configurable:!0,writable:!0});